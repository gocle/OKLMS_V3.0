<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.gocle.oklms.la.log.service.impl.AdminLogMapper">

	<select id="selectLogList" parameterType="kr.co.gocle.oklms.la.log.vo.AdminLogVO" resultType="kr.co.gocle.oklms.la.log.vo.AdminLogVO">
		<include refid="kr.co.gocle.include.paging-start"/>
		    SELECT
		        CALL.LOG_SEQ,
		        CALL.MEM_SEQ,
		        FN_GETUSERID(CALL.MEM_SEQ) AS MEM_ID,
		        FN_GETUSERNAME(CALL.MEM_SEQ) AS MEM_NAME,
		        TO_CHAR(CALL.LOGIN_DATE, 'YYYY-MM-DD HH24:MI:SS') AS LOGIN_DATE,
		        CALL.CLIENT_IP,
		        CALL.CLIENT_OS,
		        CALL.CLIENT_BROWSER,
		        CALL.MENU_ID,
		        CALL.WORK_TYPE,
		        CALL.WORK_URL,
		        CALL.WORK_TEXT
		    FROM COM_ADM_LOGIN_LOG CALL
		    WHERE 1=1
		    <if test="searchClientIp != null  and searchClientIp != ''">
				AND CALL.CLIENT_IP = #{searchClientIp}
				</if>
				<if test="searchLogMemId != null  and searchLogMemId != ''">
				AND CALL.MEM_SEQ = (SELECT MEM_SEQ	FROM COM_MEMBER		WHERE MEM_ID = #{searchLogMemId})
				</if>
				<if test="startDate != null  and startDate != '' and finishDate != null  and finishDate != ''">
				AND ( TO_CHAR( CALL.LOGIN_DATE ,'YYYYMMDDHH24MISS') <![CDATA[>=]]> #{startDate} AND TO_CHAR( CALL.LOGIN_DATE ,'YYYYMMDDHH24MISS') <![CDATA[<=]]> #{finishDate}  )
				</if>
		    ORDER BY CALL.LOGIN_DATE DESC
		<include refid="kr.co.gocle.include.paging-end"/>
	</select>
	
	<insert id="insertAdminLog"    parameterType="kr.co.gocle.oklms.la.log.vo.AdminLogVO" >
	 		INSERT INTO COM_ADM_LOGIN_LOG( 
	 										LOG_SEQ,
	 										LOGIN_DATE ,
	 										MEM_SEQ,
	 										CLIENT_IP, 
	 										CLIENT_OS,
											CLIENT_BROWSER,
											MENU_ID,
	 										WORK_TYPE, 
	 										WORK_URL,
	 										WORK_TEXT
	 										)
   							VALUES
   							(
   							  COM_ADM_LOGIN_LOG_SEQ.NEXTVAL,
   							  SYSDATE,
   							 #{memSeq} ,
   							 #{clientIp},
   							 #{clientOs},
   							 #{clientBrowser},
   							 #{menuId},
   							 #{workType},
   							 #{workUrl} ,
   							 #{workText}
   							 )
	</insert>

</mapper>