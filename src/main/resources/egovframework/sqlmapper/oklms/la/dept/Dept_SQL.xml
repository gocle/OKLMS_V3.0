<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

 
<mapper namespace="kr.co.gocle.oklms.la.dept.service.impl.DeptMapper">

	<select id="listDeptStat" parameterType="kr.co.gocle.oklms.la.dept.vo.DeptVO" resultType="kr.co.gocle.oklms.la.dept.vo.DeptVO" >
	
	SELECT 
					CD.DEPT_CD,
					CD.DEPT_NAME,
					CD.MST_YN  ,
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='1' AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')) ) AS RUN_CNT1,
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='5' AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')) ) AS FAIL_CNT1,
					
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='1' AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-1) ) AS RUN_CNT2,
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='5' AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-1) ) AS FAIL_CNT2,
					
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='1' AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-2)) AS RUN_CNT3,
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='5' AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-2)) AS FAIL_CNT3,
					
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='1' AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-3) ) AS RUN_CNT4,
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='5' AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-3) ) AS FAIL_CNT4,
					
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='1' AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-4) ) AS RUN_CNT5,
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='5' AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-4) ) AS FAIL_CNT5,
					
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='1' AND CM.STD_TRANSFER_YN='Y' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-2) ) AS RUN_CNT32,
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='5' AND CM.STD_TRANSFER_YN='Y' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-2) ) AS FAIL_CNT32,
					
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='1' AND CM.STD_TRANSFER_YN='Y' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-3) ) AS RUN_CNT42,
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='5' AND CM.STD_TRANSFER_YN='Y' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-3)) AS FAIL_CNT42,
					
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='1' AND CM.STD_TRANSFER_YN='Y' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-4)) AS RUN_CNT52,
					(SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N' AND CM.STD_HAK_STATUS='5' AND CM.STD_TRANSFER_YN='Y' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-4)) AS FAIL_CNT52
					FROM COM_DEPT CD
				ORDER BY CD.MST_YN,CD.DEPT_CD
		 <!-- 
				
				SELECT 
				    CD.DEPT_CD,
				    CD.DEPT_NAME,
				    CD.MST_YN  ,
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '재학' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')) ) AS RUN_CNT1,
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '제적' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')) ) AS FAIL_CNT1,
									
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '재학' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-1) ) AS RUN_CNT2,
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '제적' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-1) ) AS FAIL_CNT2,
									
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '재학' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-2)) AS RUN_CNT3,
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '제적' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-2)) AS FAIL_CNT3,
									
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '재학' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-3) ) AS RUN_CNT4,
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '제적' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-3) ) AS FAIL_CNT4,
									
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '재학' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-4) ) AS RUN_CNT5,
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '제적' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='N' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-4) ) AS FAIL_CNT5,
									
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '재학' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='Y' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-2) ) AS RUN_CNT32,
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '제적' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='Y' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-2) ) AS FAIL_CNT32,
									
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '재학' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='Y' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-3) ) AS RUN_CNT42,
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '제적' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='Y' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-3)) AS FAIL_CNT42,
									
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '재학' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='Y' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-4)) AS RUN_CNT52,
				    (SELECT COUNT(CM.MEM_SEQ) FROM COM_MEMBER CM INNER JOIN KUT_MOB2.VH_OKLMS_TH_SKNRGS_M SK ON CM.MEM_ID = SK.STUDNO AND SK.SKNRGS_STTUS_NM = '제적' WHERE CD.DEPT_CD=CM.DEPT_NO AND CM.DELETE_YN='N'  AND CM.STD_TRANSFER_YN='Y' AND CM.LEC_TARGET_YEAR=(TO_CHAR(SYSDATE,'YYYY')-4)) AS FAIL_CNT52
				    FROM COM_DEPT CD
				ORDER BY CD.MST_YN,CD.DEPT_CD -->
				
	</select>
	
	<select id="listDept" parameterType="kr.co.gocle.oklms.la.dept.vo.DeptVO" resultType="kr.co.gocle.oklms.la.dept.vo.DeptVO" >
	
	SELECT 
					CD.DEPT_CD,
					CD.DEPT_NAME,
					CD.MST_YN  
					FROM COM_DEPT CD
				ORDER BY CD.MST_YN,CD.DEPT_CD
	</select>
	
	<select id="getDept" parameterType="kr.co.gocle.oklms.la.dept.vo.DeptVO" resultType="kr.co.gocle.oklms.la.dept.vo.DeptVO" >
	
		SELECT 
					CD.DEPT_CD,
					CD.DEPT_NAME,
					CD.MST_YN  
					FROM COM_DEPT CD
				WHERE DEPT_CD = #{deptCd}
	</select>
	
	<insert id="insertDept" parameterType="kr.co.gocle.oklms.la.dept.vo.DeptVO"  >
		INSERT INTO COM_DEPT (DEPT_CD, DEPT_NAME, MST_YN) VALUES ( #{deptCd} , #{deptName} , #{mstYn} )
	</insert>
	
	<update id="updateDept" parameterType="kr.co.gocle.oklms.la.dept.vo.DeptVO"  >
		UPDATE COM_DEPT SET DEPT_NAME = #{deptCd},  MST_YN = #{mstYn} WHERE DEPT_CD = #{deptCd}
	</update>
	
	<delete id="deleteDept" parameterType="kr.co.gocle.oklms.la.dept.vo.DeptVO"  >
		DELETE FROM  COM_DEPT WHERE DEPT_CD = #{deptCd}
	</delete>
	
</mapper>