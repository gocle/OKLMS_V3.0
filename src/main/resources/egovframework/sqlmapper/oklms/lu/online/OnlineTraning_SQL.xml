<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
  ~ *******************************************************************************
  ~  * COPYRIGHT(C) 2016 SMART INFORMATION TECHNOLOGY. ALL RIGHTS RESERVED.
  ~  * This software is the proprietary information of SMART INFORMATION TECHNOLOGY..
  ~  *
  ~  * Revision History
  ~  * Author   Date            Description
  ~  * ======   =========      ====================================
  ~  * 이진근    2017. 02. 17          First Draft.
  ~  *
  ~  ******************************************************************************* 
  -->

<mapper namespace="kr.co.gocle.oklms.lu.online.service.impl.OnlineTraningMapper">
	
	<!-- <sql id="listMember-where">
		<if test="searchKeyword != null and searchKeyword != ''">
			AND (TPS.TRANING_PROCESS_NAME LIKE '%${searchKeyword}'OR TPS.TRANING_PROCESS_NO LIKE '%${searchKeyword}%')
	    </if>
	</sql> -->

	<select id="listOnlineTraningSchedule" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOnlineTraningSchedule ====== */
		SELECT SUB.YYYY, 
			       SUB.TERM, 
			       SUB.SUBJECT_CODE, 
			       SUB.CLASS, 
			       WEK.WEEK_ID, 
			       WEK.WEEK_CNT,
			       TIM.TRANING_DATE,  
			       
			     <choose>
					<when test="cYyyy != null and cYyyy != '' and cTerm != null and cTerm != '' and cSubjectCode != null and cSubjectCode != '' and cSubjectClass != null and cSubjectClass != ''">
						(SELECT B.CONTENT_NAME 
				         FROM LMS_SUBJ_WEEK A 
				            INNER JOIN LMS_SUBJ_WEEK_CONTENT B 
				                ON B.WEEK_ID = A.WEEK_ID 
				              AND B.DELETE_YN = 'N' 
				        WHERE A.DELETE_YN = 'N' 
				              AND A.YYYY = #{cYyyy}
				              AND A.TERM = #{cTerm}
				              AND A.SUBJECT_CODE = #{cSubjectCode}
				              AND A.CLASS = #{cSubjectClass} 
				              AND A.WEEK_CNT = WEK.WEEK_CNT 
				       ) CONTENT_NAME,
					</when>
					<otherwise>
						   SWC.CONTENT_NAME, 
					</otherwise>
				</choose>
			      
			       <!-- CASE WHEN  SUB.ONLINE_TYPE IN ('104','105') 
			       /* 플립러닝 : 출석일(토요일) 기준 사전 2주(전주 월요일)로 학습시작일 세팅*/
			         THEN TO_CHAR(IF(NVL(SWC.WEEK_ST_DATE,'') = '', DATE_ADD(TIM.TRANING_DATE, INTERVAL-14 DAY), SWC.WEEK_ST_DATE),'YYYY.MM.DD')
				    WHEN SUB.ONLINE_TYPE = '101' 
			         /*슨수온라인 : 출석일(토요일) 해당주 월요일로  학습시작일 세팅*/
			       	  THEN TO_CHAR(IF(NVL(SWC.WEEK_ST_DATE,'') = '', DATE_ADD(TIM.TRANING_DATE, INTERVAL-5 DAY),  SWC.WEEK_ST_DATE),'YYYY.MM.DD')
					/* 블랜디드(102),보조활욜(103)은 출석기준일로 학습시작일 세팅*/
			          ELSE  TO_CHAR(IF(NVL(SWC.WEEK_ST_DATE,'') = '', DATE_ADD(TIM.TRANING_DATE, INTERVAL-5 DAY), SWC.WEEK_ST_DATE),'YYYY.MM.DD')     
				   END WEEK_ST_DATE,  
			       
			       CASE WHEN  SUB.ONLINE_TYPE IN ('104','105') 
			        /* 플립러닝 : 출석일(토요일) 기준 사전 2주(출석일 전날)로 학습종료일 세팅*/
			         THEN  TO_CHAR(IF(NVL(SWC.WEEK_ED_DATE,'') = '', DATE_ADD(TIM.TRANING_DATE, INTERVAL-1 DAY), SWC.WEEK_ED_DATE),'YYYY.MM.DD')
				    WHEN SUB.ONLINE_TYPE = '101' 
			       	  THEN TO_CHAR(IF(NVL(SWC.WEEK_ED_DATE,'') = '', DATE_ADD(TIM.TRANING_DATE, INTERVAL+8 DAY), SWC.WEEK_ED_DATE),'YYYY.MM.DD')
					/* 블랜디드(102),보조활욜(103)은 출석기준일로 학습종료일 세팅*/
			          ELSE  TO_CHAR(IF(NVL(SWC.WEEK_ED_DATE,'') = '', TIM.TRANING_DATE, SWC.WEEK_ED_DATE),'YYYY.MM.DD')    
				   END WEEK_ED_DATE,    -->
				   
				   DECODE(NVL(SWC.WEEK_ST_DATE,'') , '', TOE.WEEK_ST_DATE, SWC.WEEK_ST_DATE) WEEK_ST_DATE,
				   DECODE(NVL(SWC.WEEK_ED_DATE,'') , '', TOE.WEEK_ED_DATE, SWC.WEEK_ED_DATE) WEEK_ED_DATE,
			       SWC.WEEK_MIN 
			  FROM LMS_SUBJECT SUB 
			  
			     INNER JOIN LMS_SUBJ_WEEK WEK 
			         ON WEK.YYYY = SUB.YYYY 
			       AND WEK.TERM = SUB.TERM 
			       AND WEK.SUBJECT_CODE = SUB.SUBJECT_CODE 
			       AND WEK.CLASS = SUB.CLASS 
			       AND WEK.DELETE_YN = 'N' 
			       
			     INNER JOIN LMS_SUBJ_WEEK_TIME TIM 
			         ON TIM.YYYY = WEK.YYYY 
			       AND TIM.TERM = WEK.TERM 
			       AND TIM.SUBJECT_CODE = WEK.SUBJECT_CODE 
			       AND TIM.CLASS = WEK.CLASS 
			       AND TIM.WEEK_ID = WEK.WEEK_ID 
			       AND TIM.DELETE_YN = 'N'
			       
			     LEFT OUTER JOIN LMS_SUBJ_WEEK_CONTENT SWC 
			         ON WEK.WEEK_ID = SWC.WEEK_ID 
			       AND WEK.WEEK_CNT = SWC.WEEK_CNT 
			       AND SWC.DELETE_YN = 'N' 
			       
			    LEFT OUTER JOIN LMS_TERM_ON_WEEK TOE 
			         ON TOE.DELETE_YN = 'N' 
			       AND SUB.YYYY = TOE.YYYY 
			       AND SUB.TERM = TOE.TERM 
			       AND SUB.ONLINE_TYPE = DECODE(TOE.ONLINE_TYPE,'105','104',TOE.ONLINE_TYPE)        
			       AND WEK.WEEK_CNT = TOE.WEEK_CNT 
			       
			 WHERE SUB.YYYY = #{yyyy} 
			       AND SUB.TERM = #{term} 
			       AND SUB.SUBJECT_CODE = #{subjectCode}
			       AND SUB.CLASS = #{subClass}
			       AND SUB.DELETE_YN = 'N' 
			ORDER BY TO_NUMBER(WEK.WEEK_CNT)   
		
	</select>
	
	<select id="listOnlineTraningSubject" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOnlineTraningSubject ====== */
		SELECT YYYY, 
		       TERM, 
		       SUBJECT_CODE, 
		       SUBJECT_CLASS, 
		       SUBJECT_NAME,
		       SUBJECT_TRANING_TYPE, 
		       SUBJECT_TYPE, 
		       POINT, 
		       SUBJECT_GRADE 
		  FROM 
		       (SELECT SUB.YYYY, 
		              SUB.TERM, 
		              SUB.SUBJECT_CODE, 
		              SUB.SUBJECT_NAME, 
		              SUB.CLASS AS SUBJECT_CLASS, 
		              SUB.SUBJECT_TRANING_TYPE, 
		              SUB.SUBJECT_TYPE, 
		              SUB.POINT,
		              (SELECT 
		                     CASE WHEN SUBSTR(FN_GETUSERID(MAX(LES.MEM_SEQ)),1,2) != '20' 
		                     THEN TO_CHAR(SYSDATE,'YYYY')+1-SUBSTR('20'||FN_GETUSERID(MAX(LES.MEM_SEQ)),1,4) 
		                     ELSE TO_CHAR(SYSDATE,'YYYY')+1-SUBSTR(FN_GETUSERID(MAX(LES.MEM_SEQ)),1,4) 
		                     END SUBJECT_GRADE 
		                FROM LMS_LESSON LES 
		               WHERE DELETE_YN = 'N' 
		                     AND LES.YYYY = SUB.YYYY 
		                     AND LES.TERM = SUB.TERM 
		                     AND LES.SUBJECT_CODE = SUB.SUBJECT_CODE 
		                     AND LES.CLASS = SUB.CLASS 
		              ) AS SUBJECT_GRADE 
		         FROM LMS_SUBJECT SUB 
		            INNER JOIN LMS_SUBJ_WEEK WEK 
		                ON WEK.YYYY = SUB.YYYY 
		              AND WEK.TERM = SUB.TERM 
		              AND WEK.SUBJECT_CODE = SUB.SUBJECT_CODE 
		              AND WEK.CLASS = SUB.CLASS 
		              AND WEK.DELETE_YN = 'N' 
		            INNER JOIN LMS_SUBJ_ON_STAND STA 
		                ON SUB.YYYY = STA.YYYY 
		              AND SUB.TERM = STA.TERM 
		              AND SUB.SUBJECT_CODE = STA.SUBJECT_CODE 
		              AND SUB.CLASS = STA.CLASS 
		              AND SUB.DELETE_YN = 'N' 
		            INNER JOIN LMS_SUBJ_WEEK_CONTENT SWC 
		                ON WEK.WEEK_ID = SWC.WEEK_ID 
		              AND WEK.WEEK_CNT = SWC.WEEK_CNT 
		              AND SWC.DELETE_YN = 'N' 
		       ) AA  
		 WHERE 1=1  
		 <if test="yyyy != null and yyyy != ''">
		 	  AND yyyy = #{yyyy}
		 </if>
		 <if test="term != null and term != ''">
		 	  AND term = #{term}
		 </if>
		  <if test="subjectGrade != null and subjectGrade != ''">
		  	  AND SUBJECT_GRADE = #{subjectGrade}
		 </if>
		 <if test="point != null and point != ''">
		 	  AND point = #{point}
		 </if>
		 <if test="searchKeyword != null and searchKeyword != ''">
		       AND SUBJECT_NAME LIKE '%' || #{searchKeyword  } || '%' 
		  </if>
		   GROUP BY YYYY,
		       TERM,
		       SUBJECT_CODE,
		       SUBJECT_CLASS,
		        SUBJECT_NAME,
		       SUBJECT_TRANING_TYPE,
		       SUBJECT_TYPE,
		       POINT,
		       SUBJECT_GRADE 
		ORDER BY YYYY DESC
	</select>
	
	<select id="listOnlineTraningCdpSchedule" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOnlineTraningCdpSchedule ====== */
		SELECT SUB.YYYY, 
			       SUB.TERM, 
			       SUB.SUBJECT_CODE, 
			       SUB.CLASS, 
			       WEK.WEEK_ID, 
			       WEK.WEEK_CNT,
			       TIM.TRANING_DATE,  
			       TIM.LEAD_TIME,  
			       SWC.CONTENT_NAME, 
			       SWC.WEEK_ST_DATE,
				   SWC.WEEK_ED_DATE,   
			       SWC.WEEK_MIN,
			       
			       <!-- CASE WHEN TO_CHAR(TIM.TRANING_DATE,'YYYY.MM.DD') BETWEEN TO_CHAR(ADDDATE( CURDATE(), - WEEKDAY(CURDATE()) + 0 ),'YYYY.MM.DD') AND  TO_CHAR(ADDDATE( CURDATE(), - WEEKDAY(CURDATE()) + 6 ),'YYYY.MM.DD') -->
			       CASE WHEN TO_CHAR(TO_DATE(TIM.TRANING_DATE,'YYYY.MM.DD'),'YYYY.MM.DD') BETWEEN TO_CHAR(TRUNC(SYSDATE,'IW'),'YYYY.MM.DD') AND TO_CHAR(TRUNC(SYSDATE,'IW')+6,'YYYY.MM.DD')
				   THEN 'Y'
				   ELSE 'N'
				   END NOW_WEEK_YN
			        
			  FROM LMS_SUBJECT SUB 
			  
			     INNER JOIN LMS_SUBJ_WEEK WEK 
			         ON WEK.YYYY = SUB.YYYY 
			       AND WEK.TERM = SUB.TERM 
			       AND WEK.SUBJECT_CODE = SUB.SUBJECT_CODE 
			       AND WEK.CLASS = SUB.CLASS 
			       AND WEK.DELETE_YN = 'N' 
			       
			     INNER JOIN LMS_SUBJ_WEEK_TIME TIM 
			         ON TIM.YYYY = WEK.YYYY 
			       AND TIM.TERM = WEK.TERM 
			       AND TIM.SUBJECT_CODE = WEK.SUBJECT_CODE 
			       AND TIM.CLASS = WEK.CLASS 
			       AND TIM.WEEK_ID = WEK.WEEK_ID 
			       AND TIM.DELETE_YN = 'N'
			       
			     LEFT OUTER JOIN LMS_SUBJ_WEEK_CONTENT SWC 
			         ON WEK.WEEK_ID = SWC.WEEK_ID 
			       AND WEK.WEEK_CNT = SWC.WEEK_CNT 
			       AND SWC.DELETE_YN = 'N' 
			       
			 WHERE SUB.YYYY = #{yyyy} 
			       AND SUB.TERM = #{term} 
			       AND SUB.SUBJECT_CODE = #{subjectCode}
			       AND SUB.CLASS = #{subClass}
			       AND SUB.DELETE_YN = 'N' 
			ORDER BY TO_NUMBER(WEK.WEEK_CNT)   
		
	</select>
	
	<select id="listOfflineTraningCdpSchedule" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOfflineTraningCdpSchedule ====== */
		SELECT WEE.WEEK_CNT , 
				       WEE.WEEK_ID, 
				       WEE.YYYY, 
					   WEE.TERM, 
					   WEE.SUBJECT_CODE, 
					   WEE.CLASS AS SUBJECT_CLASS, 
				       TIM.TRANING_DATE,
				       TIM.TRANING_ST_HOUR, 
				       TIM.TRANING_ST_MIN, 
				       TIM.TRANING_ED_HOUR, 
				       TIM.TRANING_ED_MIN , 
				       TIM.LEAD_TIME , 
				       SUB.LCTRUM_CD,
				       SUB.LCTRUM_NM,
				       
				       (SELECT COUNT(*) 
				         FROM LMS_LESSON LES  
				        WHERE WEE.YYYY = LES.YYYY 
				              AND WEE.TERM = LES.TERM 
				              AND WEE.SUBJECT_CODE = LES.SUBJECT_CODE 
				              AND WEE.CLASS = LES.CLASS 
				              AND LES.DELETE_YN = 'N' 
				              AND LES.LEC_STATUS = 'A' 
				       ) LESSON_CNT,
				       
				       CASE WHEN TO_CHAR(TO_DATE(TIM.TRANING_DATE,'YYYY.MM.DD'),'YYYY.MM.DD') BETWEEN TO_CHAR(TRUNC(SYSDATE,'IW'),'YYYY.MM.DD') AND TO_CHAR(TRUNC(SYSDATE,'IW')+6,'YYYY.MM.DD')
					   THEN 'Y'
					   ELSE 'N'
					   END NOW_WEEK_YN,
				       
				       TO_CHAR(TO_DATE(TIM.TRANING_DATE,'YYYY.MM.DD'), 'dy', 'NLS_DATE_LANGUAGE=korean') DAY_WEEK,
					   TIM.TRANING_ST_HOUR ||':'|| TIM.TRANING_ST_MIN as TRANING_ST,
					   TIM.TRANING_ED_HOUR ||':'|| TIM.TRANING_ED_MIN as TRANING_ED,
					   
					   TIM.LEAD_TIME  AS TIME_HOUR,
					   MOD(TRIM(TIM.TRANING_ED_MIN), TRIM(TIM.TRANING_ST_MIN) ) AS TIME_MIN,
				    
				       (SELECT MAX(REPORT_ID) 
					    FROM LMS_REPORT REP 
					   WHERE REP.DELETE_YN = 'N' 
					         AND REP.YYYY = WEE.YYYY 
					         AND REP.TERM = WEE.TERM 
					         AND REP.SUBJECT_CODE = WEE.SUBJECT_CODE 
					         AND REP.CLASS = WEE.CLASS 
					         AND REP.WEEK_CNT = WEE.WEEK_CNT 
					       <!--   AND TO_CHAR(SYSDATE,'YYYY.MM.DD') BETWEEN REP.SUBMIT_START_DATE AND REP.SUBMIT_END_DATE  -->
					  ) AS REPORT_ID,
					  
					  (SELECT MAX(TEAM.TEAM_PROJECT_ID) 
					    FROM LMS_TEAM_PROJECT TEAM 
					   WHERE TEAM.DELETE_YN = 'N' 
					         AND TEAM.YYYY = WEE.YYYY 
					         AND TEAM.TERM = WEE.TERM 
					         AND TEAM.SUBJECT_CODE = WEE.SUBJECT_CODE 
					         AND TEAM.CLASS = WEE.CLASS 
					         AND TEAM.WEEK_CNT = WEE.WEEK_CNT 
					       <!--   AND TO_CHAR(SYSDATE,'YYYY.MM.DD') BETWEEN REP.SUBMIT_START_DATE AND REP.SUBMIT_END_DATE  -->
					  ) AS TEAM_PROJECT_ID,
					  
					  (SELECT MAX(DISCUSS_ID) 
					    FROM LMS_DISCUSS DIS 
					   WHERE DIS.DELETE_YN = 'N' 
					         AND DIS.YYYY = WEE.YYYY 
					         AND DIS.TERM = WEE.TERM 
					         AND DIS.SUBJECT_CODE = WEE.SUBJECT_CODE 
					         AND DIS.CLASS = WEE.CLASS 
					       <!--   AND TO_CHAR(SYSDATE,'YYYY.MM.DD') BETWEEN DIS.START_DATE AND DIS.END_DATE  -->
					         AND TO_CHAR(TO_DATE(TIM.TRANING_DATE,'YYYY.MM.DD'),'YYYY.MM.DD') BETWEEN DIS.START_DATE AND DIS.END_DATE
					  ) AS DISCUSS_ID,
					  
					  (SELECT COUNT(1)
				         FROM LMS_TRANING_NOTE_MASTER NOM 
				        WHERE NOM.DELETE_YN = 'N' 
				              AND NOM.YYYY = WEE.YYYY 
				              AND NOM.TERM = WEE.TERM 
				              AND NOM.SUBJECT_CODE = WEE.SUBJECT_CODE 
				              AND NOM.CLASS = WEE.CLASS 
				              AND NOM.WEEK_CNT = WEE.WEEK_CNT
				       ) AS TRA_NOTE_CNT,
				       
				       (SELECT COUNT(1)
				         FROM LMS_ACTIVITY_NOTE ACT 
				        WHERE ACT.DELETE_YN = 'N' 
				              AND ACT.YYYY = WEE.YYYY 
				              AND ACT.TERM = WEE.TERM 
				              AND ACT.SUBJECT_CODE = WEE.SUBJECT_CODE 
				              AND ACT.CLASS = WEE.CLASS 
				              AND ACT.WEEK_CNT = WEE.WEEK_CNT
				       ) AS ACT_NOTE_CNT,
				      
				       (SELECT COUNT(1) 
				         FROM LMS_SUBJ_WEEK_SCH SCH 
				        WHERE SCH.DELETE_YN = 'N' 
				              AND SCH.WEEK_ID = WEE.WEEK_ID 
				       ) WEEK_MAPPING_CNT , 
				        <!-- (SELECT GROUP_CONCAT(UNIT.NCS_UNIT_NAME,'<BR>',ELEM.NCS_ELEM_NAME) -->
				        <![CDATA[
				     	(SELECT UNIT.NCS_UNIT_NAME||'<BR>'||ELEM.NCS_ELEM_NAME
				         FROM LMS_SUBJ_NCS_UNIT UNIT 
				          INNER JOIN LMS_SUBJ_NCS_ELEM ELEM 
				              ON ELEM.NCS_UNIT_ID = UNIT.NCS_UNIT_ID 
				               AND ELEM.WEEK_ID = UNIT.WEEK_ID 
				              AND ELEM.DELETE_YN = 'N' 
				        WHERE UNIT.DELETE_YN = 'N' 
				              AND UNIT.WEEK_ID = WEE.WEEK_ID 
				              AND ROWNUM = 1
				       ) NCS_NAME 
				        ]]>	
				  FROM LMS_SUBJECT SUB 
				  
				  INNER JOIN LMS_SUBJ_WEEK WEE 
			         ON WEE.YYYY = SUB.YYYY 
			       AND WEE.TERM = SUB.TERM 
			       AND WEE.SUBJECT_CODE = SUB.SUBJECT_CODE 
			       AND WEE.CLASS = SUB.CLASS 
			       AND WEE.DELETE_YN = 'N' 
			     INNER JOIN LMS_SUBJ_WEEK_TIME TIM 
			         ON TIM.YYYY = WEE.YYYY 
			       AND TIM.TERM = WEE.TERM 
			       AND TIM.SUBJECT_CODE = WEE.SUBJECT_CODE 
			       AND TIM.CLASS = WEE.CLASS 
			       AND TIM.WEEK_ID = WEE.WEEK_ID 
			       AND TIM.DELETE_YN = 'N' 
			     LEFT OUTER JOIN LMS_SUBJ_WEEK_CONTENT SWC 
			         ON WEE.WEEK_ID = SWC.WEEK_ID 
			       AND WEE.WEEK_CNT = SWC.WEEK_CNT 
			       AND WEE.DELETE_YN = 'N'   
				       
				  WHERE SUB.YYYY = #{yyyy} 
			       AND SUB.TERM = #{term} 
			       AND SUB.SUBJECT_CODE = #{subjectCode}
			       AND SUB.CLASS = #{subClass}
			       AND SUB.DELETE_YN = 'N' 
			       
			       ORDER BY TO_NUMBER(WEE.WEEK_CNT)   
	</select>
	
	
	
	<select id="listOnlineTraningAllWeekSchedule" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOnlineTraningAllWeekSchedule ====== */
		SELECT SCH.SUBJ_SCH_ID, 
					SCH.WEEK_ID, 
			       SCH.WEEK_CNT, 
			       SCH.SUBJ_STEP, 
			       SCH.SUBJ_TITLE, 
			       SCH.START_DATE, 
			       SCH.END_DATE, 
			       SCH.STUDY_TIME, 
			       SCH.LINK_CONTENT_YN, 
			       SCH.CMS_COURSE_CONTENT_ID, 
			       SCH.CMS_LESSON_ID,
			       SCH.CMS_ID,
			       SCH.CONTENT_TYPE,
			       SCH.CONTENTS_DIR,
			       SCH.CONTENTS_IDX_FILE,
			       SCH.CONTENTS_REAL_FILE,
			       SCH.URL,
			       SCH.DEVICE_TYPE_CODE,
			       SCH.PAGE_COUNT,
			       CASE 
				           WHEN SCH.DEVICE_TYPE_CODE = '1' 
				           THEN 'PC+M' 
				           WHEN SCH.DEVICE_TYPE_CODE = '2' 
				           THEN 'PC+M' 
				           WHEN SCH.DEVICE_TYPE_CODE = '3' 
				           THEN 'PC+M' 
				           WHEN SCH.DEVICE_TYPE_CODE = '4' 
				           THEN 'PC'
				           WHEN SCH.DEVICE_TYPE_CODE = '5' 
				           THEN '모바일'
				           ELSE '기타' 
				       END DEVICE_TYPE_CODE_NAME 
			  FROM LMS_SUBJ_WEEK_SCH SCH 
			  WHERE 1=1
			  
			  <choose>
					<when test="cYyyy != null and cYyyy != '' and cTerm != null and cTerm != '' and cSubjectCode != null and cSubjectCode != '' and cSubjectClass != null and cSubjectClass != ''">
						  AND SCH.YYYY =  #{cYyyy}
					      AND SCH.TERM = #{cTerm}
					      AND SCH.SUBJECT_CODE = #{cSubjectCode}
					      AND SCH.CLASS =#{cSubjectClass}
					</when>
					<otherwise>
						  AND SCH.YYYY =  #{yyyy}
					      AND SCH.TERM = #{term}
					      AND SCH.SUBJECT_CODE = #{subjectCode}
					      AND SCH.CLASS =#{subClass}
					</otherwise>
				</choose>
			  
			       
			       AND SCH.DELETE_YN = 'N' 
			ORDER BY TO_NUMBER(SCH.WEEK_CNT), 
			       TO_NUMBER(SCH.SUBJ_STEP)  
	</select>
	
	<select id="listOnlineTraningStdOnlineSchedule" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOnlineTraningStdOnlineSchedule ====== */
		
		SELECT LSWS.SUBJ_SCH_ID, 
			       LSWS.WEEK_ID, 
			       LSWS.WEEK_CNT, 
			       LSWS.SUBJ_STEP, 
			       LSWS.SUBJ_TITLE, 
			       LSWS.START_DATE, 
			       LSWS.END_DATE, 
			       LSWS.STUDY_TIME, 
			       LSWS.LINK_CONTENT_YN, 
			       LSWS.CMS_COURSE_CONTENT_ID, 
			       LSWS.CMS_LESSON_ID, 
			       LSWS.CMS_ID, 
			       LSWS.CONTENT_TYPE, 
			       LSWS.CONTENTS_DIR, 
			       LSWS.CONTENTS_IDX_FILE, 
			       LSWS.CONTENTS_REAL_FILE, 
			       LSWS.URL, 
			       LSWS.DEVICE_TYPE_CODE, 
			       LSWS.PAGE_COUNT, 
			       CASE 
			           WHEN LSWS.DEVICE_TYPE_CODE = '1' 
			           THEN 'PC+M' 
			           WHEN LSWS.DEVICE_TYPE_CODE = '2' 
			           THEN 'PC+M' 
			           WHEN LSWS.DEVICE_TYPE_CODE = '3' 
			           THEN 'PC+M' 
			           WHEN LSWS.DEVICE_TYPE_CODE = '4' 
			           THEN 'PC' 
			           WHEN LSWS.DEVICE_TYPE_CODE = '5' 
			           THEN '모바일' 
			           ELSE '기타' 
			       END DEVICE_TYPE_CODE_NAME, 
			       NVL(PRO.SCH_PROGRESS_RATE,0) AS SCH_PROGRESS_RATE, 
			       NVL(PRO.SCH_STUDY_MINUTE,0) AS SCH_STUDY_MINUTE
			  FROM LMS_SUBJ_WEEK_SCH LSWS 
			   LEFT OUTER JOIN 
			       (SELECT ATT.WEEK_ID, 
			              ATT.SUBJ_SCH_ID, 
			              CASE 
			                  WHEN OST.PROGRESS_ATTEND_TYPE_CODE = 'H' 
			                  THEN FLOOR((SUM(ATT.TIME_PROGRESS_RATIO)+SUM(PAGE_PROGRESS_RATIO)) / (200 * SCH.PAGE_COUNT) * 100) 
			                  WHEN OST.PROGRESS_ATTEND_TYPE_CODE = 'I' 
			                  THEN FLOOR(SUM(ATT.TIME_PROGRESS_RATIO) / (100 * SCH.PAGE_COUNT) * 100) 
			                  WHEN OST.PROGRESS_ATTEND_TYPE_CODE = 'P' 
			                  THEN FLOOR(SUM(ATT.PAGE_PROGRESS_RATIO) / (100 * SCH.PAGE_COUNT) * 100) 
			              END SCH_PROGRESS_RATE, 
			              FLOOR(SUM(TIM.LESSON_TIME) / 60) AS SCH_STUDY_MINUTE 
			         FROM LMS_PROGRESS_ATTEND ATT 
			          INNER JOIN LMS_SUBJ_WEEK_SCH SCH 
			              ON SCH.WEEK_ID = ATT.WEEK_ID 
			              AND SCH.SUBJ_SCH_ID = ATT.SUBJ_SCH_ID 
			              AND SCH.DELETE_YN = 'N' 
			          INNER JOIN LMS_LESSON_TIME_MAX TIM 
			              ON ATT.PROGRESS_ATTEND_ID = TIM.PROGRESS_ATTEND_ID 
			          INNER JOIN LMS_SUBJ_ON_STAND OST 
			              ON OST.YYYY = SCH.YYYY 
			              AND OST.TERM = SCH.TERM 
			              AND OST.SUBJECT_CODE = SCH.SUBJECT_CODE 
			              AND OST.CLASS = SCH.CLASS 
			              AND OST.DELETE_YN = 'N' 
			          INNER JOIN LMS_LESSON LES 
			              ON LES.YYYY = SCH.YYYY 
			              AND LES.TERM = SCH.TERM 
			              AND LES.SUBJECT_CODE = SCH.SUBJECT_CODE 
			              AND LES.CLASS = SCH.CLASS 
			              AND LES.DELETE_YN = 'N' 
			              AND LES.LESSON_ID = ATT.LESSON_ID 
			              AND LES.MEM_SEQ = #{sessionMemSeq} 
			        GROUP BY LES.LESSON_ID, 
			              ATT.WEEK_ID, 
			              ATT.SUBJ_SCH_ID, 
			              SCH.PAGE_COUNT, 
			              PROGRESS_ATTEND_TYPE_CODE 
			       ) PRO 
			       ON PRO.WEEK_ID = LSWS.WEEK_ID 
			       AND PRO.SUBJ_SCH_ID = LSWS.SUBJ_SCH_ID 
			 WHERE 1=1 
			       AND LSWS.YYYY =  #{yyyy}
			       AND LSWS.TERM = #{term}
			       AND LSWS.SUBJECT_CODE = #{subjectCode}
			       AND LSWS.CLASS =#{subClass}
			       AND LSWS.DELETE_YN = 'N' 
			ORDER BY TO_NUMBER(LSWS.WEEK_CNT), 
			       TO_NUMBER(LSWS.SUBJ_STEP)  	       
		
	</select>
	
	
	<insert id="insertOnlineTraningStand" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.insertOnlineTraningStand ====== */
		INSERT 
			  INTO LMS_SUBJ_ON_STAND 
			       ( 
			         SUBJ_ON_STAND_SEQ,
			         YYYY, 
			         TERM, 
			         SUBJECT_CODE, 
			         CLASS, 
			         START_DATE, 
			         END_DATE, 
			         WEEK_STUDY_TYPE, 
			         WEEK_STUDY, 
			         CUT_PROGRESS, 
			         ATTEND_PROGRESS, 
			         ATTEND_REFLECT_TYPE, 
			         ATTEND_NEXT_DAY, 
			         SCHEDULE_TIME, 
			         PROGRESS_ATTEND_TYPE_CODE, 
			         INSERT_DATE, 
			         INSERT_USER 
			       ) 
			       VALUES 
			       (  
			         (SELECT NVL(MAX(SUBJ_ON_STAND_SEQ),0)+1 FROM LMS_SUBJ_ON_STAND),    
			         #{yyyy}, 
			         #{term}, 
			         #{subjectCode}, 
			         #{subjectClass}, 
			         #{startDate}, 
			         #{endDate}, 
			         #{weekStudyType}, 
			         #{weekStudy}, 
			         #{cutProgress}, 
			         #{attendProgress}, 
			         #{attendReflectType}, 
			         #{attendNextDay}, 
			         #{scheduleTime}, 
			         #{progressAttendTypeCode}, 
			         SYSDATE, 
			         #{insertUser} 
			       )
	</insert>
	
	
	<update id="updateOnlineTraningStand" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.updateOnlineTraningStand ====== */
		UPDATE LMS_SUBJ_ON_STAND 
			       SET UPDATE_DATE = SYSDATE
			       <if test="startDate != null and startDate != ''">,START_DATE = #{startDate} </if>
			       <if test="endDate != null and endDate != ''">, END_DATE = #{endDate} </if>
			       <if test="weekStudyType != null and weekStudyType != ''">,WEEK_STUDY_TYPE = #{weekStudyType} </if>
			       <if test="weekStudy != null and weekStudy != ''">,WEEK_STUDY = #{weekStudy}  </if>
			       <if test="cutProgress != null and cutProgress != ''">,CUT_PROGRESS = #{cutProgress} </if>
			       <if test="attendProgress != null and attendProgress != ''">,ATTEND_PROGRESS = #{attendProgress} </if>
			       <if test="attendReflectType != null and attendReflectType != ''">,ATTEND_REFLECT_TYPE = #{attendReflectType} </if>
			       <if test="attendNextDay != null and attendNextDay != ''">,ATTEND_NEXT_DAY = #{attendNextDay} </if>
			       <if test="scheduleTime != null and scheduleTime != ''"> ,SCHEDULE_TIME = #{scheduleTime} </if>
			       <if test="progressAttendTypeCode != null and progressAttendTypeCode != ''">,PROGRESS_ATTEND_TYPE_CODE = #{progressAttendTypeCode} </if>
			       <if test="updateUser != null and updateUser != ''">,UPDATE_USER = #{updateUser} </if>
			 WHERE DELETE_YN= 'N' 
			       AND YYYY = #{yyyy} 
			       AND TERM = #{term} 
			       AND SUBJECT_CODE = #{subjectCode} 
			       AND CLASS = #{subjectClass} 
			       AND SUBJ_ON_STAND_SEQ = #{subjOnStandSeq}
	</update>
	
	<select id="getOnlineTraningStand" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.getOnlineTraningStand ====== */
		SELECT STA.SUBJ_ON_STAND_SEQ, 
			       SUB.YYYY, 
			       SUB.TERM, 
			       SUB.SUBJECT_CODE, 
			       SUB.CLASS,  
			       DECODE(NVL(STA.WEEK_STUDY_TYPE,'') , '', TST.WEEK_STUDY_TYPE, STA.WEEK_STUDY_TYPE) WEEK_STUDY_TYPE, 
			       DECODE(NVL(STA.WEEK_STUDY,'') , '', TST.WEEK_STUDY, STA.WEEK_STUDY) WEEK_STUDY, 
			       DECODE(NVL(STA.CUT_PROGRESS,'') , '', TST.CUT_PROGRESS, STA.CUT_PROGRESS) CUT_PROGRESS, 
			       DECODE(NVL(STA.ATTEND_PROGRESS,'') , '', TST.ATTEND_PROGRESS, STA.ATTEND_PROGRESS) ATTEND_PROGRESS, 
			       DECODE(NVL(STA.ATTEND_REFLECT_TYPE,'') , '', TST.ATTEND_REFLECT_TYPE, STA.ATTEND_REFLECT_TYPE) ATTEND_REFLECT_TYPE, 
			       DECODE(NVL(STA.ATTEND_NEXT_DAY,'') , '', TST.ATTEND_NEXT_DAY, STA.ATTEND_NEXT_DAY) ATTEND_NEXT_DAY, 
			       DECODE(NVL(STA.SCHEDULE_TIME,'') , '', TST.SCHEDULE_TIME, STA.SCHEDULE_TIME) SCHEDULE_TIME, 
			       DECODE(NVL(STA.PROGRESS_ATTEND_TYPE_CODE,'') , '', TST.PROGRESS_ATTEND_TYPE_CODE, STA.PROGRESS_ATTEND_TYPE_CODE) PROGRESS_ATTEND_TYPE_CODE, 
			       STA.INSERT_DATE, 
			       STA.INSERT_USER,
			       NVL((SELECT 1 
			         FROM LMS_LESSON LES 
			            INNER JOIN LMS_PROGRESS_ATTEND ATT 
			                ON LES.LESSON_ID = ATT.LESSON_ID 
			        WHERE LES.DELETE_YN = 'N' 
			              AND LES.LEC_STATUS = 'A' 
			              AND LES.YYYY = SUB.YYYY 
			              AND LES.TERM = SUB.TERM 
			              AND LES.SUBJECT_CODE = SUB.SUBJECT_CODE 
			              AND LES.CLASS = SUB.CLASS 
			              AND ROWNUM = 1
			       ),0) ATT_CNT,
			      
			       <!-- CASE WHEN  SUB.ONLINE_TYPE IN ('104','105') 
			       /* 플립러닝 : 출석일(토요일) 기준 사전 2주(전주 월요일)로 학습시작일 세팅*/
			         THEN TO_CHAR(IF(NVL(STA.START_DATE,'') = '', DATE_ADD(TIM.TRANING_START_DATE, INTERVAL-14 DAY), STA.START_DATE),'YYYY.MM.DD')
				    WHEN SUB.ONLINE_TYPE = '101' 
			         /*슨수온라인 : 출석일(토요일) 해당주 월요일로  학습시작일 세팅*/
			       	  THEN TO_CHAR(IF(NVL(STA.START_DATE,'') = '', DATE_ADD(TIM.TRANING_START_DATE, INTERVAL-5 DAY), STA.START_DATE),'YYYY.MM.DD')
					/* 블랜디드(102),보조활욜(103)은 출석기준일로 학습시작일 세팅*/
			          ELSE  TO_CHAR(IF(NVL(STA.START_DATE,'') = '', DATE_ADD(TIM.TRANING_START_DATE, INTERVAL-5 DAY), STA.START_DATE),'YYYY.MM.DD')     
				   END START_DATE,  
			     
			       CASE WHEN  SUB.ONLINE_TYPE IN ('104','105') 
			        /* 플립러닝 : 출석일(토요일) 기준 사전 2주(출석일 전날)로 학습종료일 세팅*/
			         THEN  TO_CHAR(IF(NVL(STA.END_DATE,'') = '', DATE_ADD(TIM.TRANING_END_DATE, INTERVAL-1 DAY), STA.END_DATE),'YYYY.MM.DD')
				    WHEN SUB.ONLINE_TYPE = '101' 
			       	  THEN TO_CHAR(IF(NVL(STA.END_DATE,'') = '', DATE_ADD(TIM.TRANING_END_DATE, INTERVAL+8 DAY), STA.END_DATE),'YYYY.MM.DD')
					/* 블랜디드(102),보조활욜(103)은 출석기준일로 학습종료일 세팅*/
			          ELSE  TO_CHAR(IF(NVL(STA.END_DATE,'') = '',TIM.TRANING_END_DATE,STA.END_DATE),'YYYY.MM.DD')    
				   END END_DATE -->
				   DECODE(NVL(STA.START_DATE,'') , '', TST.START_DATE, STA.START_DATE) START_DATE,
				   DECODE(NVL(STA.END_DATE,'') , '', TST.END_DATE, STA.END_DATE) END_DATE 
			  FROM LMS_SUBJECT SUB 
			    
			   LEFT OUTER JOIN LMS_SUBJ_ON_STAND STA 
			         ON STA.DELETE_YN = 'N' 
			       AND SUB.YYYY = STA.YYYY 
			       AND SUB.TERM = STA.TERM 
			       AND SUB.SUBJECT_CODE = STA.SUBJECT_CODE 
			       AND SUB.CLASS = STA.CLASS 
			       
			   LEFT OUTER JOIN LMS_TERM_ON_STAND TST 
			         ON TST.DELETE_YN = 'N' 
			       AND SUB.YYYY = TST.YYYY 
			       AND SUB.TERM = TST.TERM 
			       AND SUB.ONLINE_TYPE = DECODE(TST.ONLINE_TYPE,'105','104',TST.ONLINE_TYPE)      
			     
			     LEFT OUTER JOIN 
			       (SELECT YYYY,
			              TERM,
			              SUBJECT_CODE,
			              CLASS,
			              MIN(TRANING_DATE) TRANING_START_DATE, 
			              MAX(TRANING_DATE) TRANING_END_DATE 
			         FROM LMS_SUBJ_WEEK_TIME 
			        WHERE DELETE_YN = 'N' 
			          GROUP BY YYYY, 
			              TERM, 
			              SUBJECT_CODE, 
			              CLASS 
			       ) TIM 
			         ON TIM.YYYY = SUB.YYYY 
			       AND TIM.TERM = SUB.TERM 
			       AND TIM.SUBJECT_CODE = SUB.SUBJECT_CODE 
			       AND TIM.CLASS = SUB.CLASS 
			       
			 WHERE SUB.DELETE_YN = 'N' 
			       AND SUB.YYYY = #{yyyy}
			       AND SUB.TERM = #{term}
			       AND SUB.SUBJECT_CODE = #{subjectCode} 
			       AND SUB.CLASS = #{subjectClass}       
			       
	</select>
	
	
	<insert id="insertOnlineTraningWeekContent" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningWeekVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.insertOnlineTraningWeekContent ====== */
		INSERT 
			  INTO LMS_SUBJ_WEEK_CONTENT
			       (
			         WEEK_ID,
			         WEEK_CNT, 
			         CONTENT_NAME,
			         WEEK_ST_DATE,
			         WEEK_ED_DATE,
			         WEEK_MIN,
			         ATCH_FILE_ID,
			         INSERT_DATE,
			         INSERT_USER
			       ) 
			       VALUES
			       (
			      	 #{weekId},
			      	 #{weekCnt}, 
			         #{contentName},
			         #{weekStDate},
			         #{weekEdDate},
			         #{weekMin},
			         #{atchFileId},
			         SYSDATE,
			         #{insertUser}
			       	
			       )
	</insert>
	
	<update id="updateOnlineTraningWeekContent" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningWeekVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.updateOnlineTraningWeekContent ====== */
			 UPDATE  LMS_SUBJ_WEEK_CONTENT
			 	SET 
			 		CONTENT_NAME = #{contentName}
			 		,WEEK_ST_DATE = #{weekStDate}
			 		,WEEK_ED_DATE = #{weekEdDate}
			 		,WEEK_MIN 		= #{weekMin}
			 WHERE WEEK_ID = #{weekId}
	</update>
	
	
	
	<delete id="deleteOnlineTraningWeekContent" parameterType="String">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.deleteOnlineTraningWeekContent ====== */
			 DELETE FROM  LMS_SUBJ_WEEK_CONTENT  WHERE WEEK_ID = #{weekId}
	</delete>
	
	
	<insert id="insertOnlineTraningWeekSchedule" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.insertOnlineTraningWeekSchedule ====== */
		INSERT 
			  INTO LMS_SUBJ_WEEK_SCH 
			       ( 
			         SUBJ_SCH_ID, 
			         WEEK_ID, 
			         YYYY, 
				     TERM, 
				     SUBJECT_CODE, 
				     CLASS, 
			         WEEK_CNT, 
			         SUBJ_STEP, 
			         SUBJ_TITLE, 
			         START_DATE, 
			         END_DATE, 
			         STUDY_TIME, 
			         LINK_CONTENT_YN, 
			         CMS_COURSE_CONTENT_ID, 
			         CMS_LESSON_ID, 
			         CMS_ID, 
			         CONTENT_TYPE, 
			         CONTENTS_DIR, 
			         CONTENTS_IDX_FILE, 
			         CONTENTS_REAL_FILE, 
			         URL, 
			         DEVICE_TYPE_CODE, 
			         PAGE_COUNT,
			         ATCH_FILE_ID, 
			         INSERT_DATE, 
			         INSERT_USER 
			       ) 
			       VALUES 
			       (  
			         #{subjSchId}, 
			         #{weekId}, 
			         #{yyyy}, 
			         #{term}, 
			         #{subjectCode}, 
			         #{subjectClass}, 
			         #{weekCnt}, 
			         #{subjStep}, 
			         #{subjTitle}, 
			         #{startDate}, 
			         #{endDate}, 
			         #{studyTime}, 
			         #{linkContentYn}, 
			         #{cmsCourseContentId}, 
			         #{cmsLessonId}, 
			         #{cmsId}, 
			         #{contentType}, 
			         #{contentsDir}, 
			         #{contentsIdxFile}, 
			         #{contentsRealFile}, 
			         #{url}, 
			         #{deviceTypeCode}, 
			         #{pageCount},
			         #{atchFileId}, 
			         SYSDATE, 
			         #{insertUser} 
			       )
	</insert>
	
	<update id="updateOnlineTraningWeekSchedule" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.updateOnlineTraningWeekSchedule ====== */
		UPDATE LMS_SUBJ_WEEK_SCH
		SET
			SUBJ_TITLE = #{subjTitle}
	 		,START_DATE = #{startDate} 
			,END_DATE = #{endDate}
			,STUDY_TIME = #{studyTime}
		WHERE SUBJ_SCH_ID = #{subjSchId}
			AND WEEK_ID = #{weekId}
	</update>
	
	
	
	
	<delete id="deleteOnlineTraningWeekSchedule" parameterType="String">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.deleteOnlineTraningWeekSchedule ====== */
			  DELETE FROM  LMS_SUBJ_WEEK_SCH WHERE WEEK_ID = #{weekId}
	</delete>
	
	<select id="getAllProgressRateLesson" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.getAllProgressRateLesson ====== */
			SELECT 
				LES.ON_PROGRESS_RATE AS onRealRrogressRate, 
				ATT.ON_REAL_PROGRESS_TIME AS onRealRrogressTime
				FROM LMS_LESSON LES 
				
				LEFT OUTER JOIN (
					SELECT 
					<!-- FLOOR(MOD(SUM(LESSON_TIME),3600)/60) AS ON_REAL_PROGRESS_TIME, -->
					   <!-- TIME_FORMAT(SEC_TO_TIME(SUM(LESSON_TIME)),'%H 시간 %i 분 %s 초')  AS ON_REAL_PROGRESS_TIME, -->
					   
					   (TRUNC(SUM(LESSON_TIME)/(60*60)))||' 시간'||
					 	LPad(TRUNC(Mod((SUM(LESSON_TIME)/60),60)),2,0)||' 분'||
					 	LPad(TRUNC(Mod(SUM(LESSON_TIME),60)),2,0)||' 초' AS ON_REAL_PROGRESS_TIME,
				       LESSON_ID 
				  FROM LMS_PROGRESS_ATTEND ATTD 
				     INNER JOIN LMS_LESSON_TIME_MAX TIME 
				         ON ATTD.PROGRESS_ATTEND_ID = TIME.PROGRESS_ATTEND_ID 
				   GROUP BY LESSON_ID
				) ATT 
				
				ON LES.LESSON_ID = ATT.LESSON_ID
				 WHERE LES.DELETE_YN = 'N' 
				       AND LES.YYYY = #{yyyy} 
				       AND LES.TERM = #{term} 
				       AND LES.SUBJECT_CODE = #{subjectCode} 
				       AND LES.CLASS = #{subjectClass}  
				       AND LES.LEC_STATUS = 'A' 
				       AND LES.MEM_SEQ = #{sessionMemSeq} 
	</select>
	
	<select id="listOnlineTraningStdSchedule" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOnlineTraningStdSchedule ====== */
		SELECT WEE.WEEK_CNT , 
				       WEE.WEEK_ID, 
				       WEE.YYYY, 
					   WEE.TERM, 
					   WEE.SUBJECT_CODE, 
					   WEE.CLASS AS SUBJECT_CLASS, 
				       LES.LESSON_ID, 
				       TIM.TRANING_DATE,
				       TIM.TRANING_ST_HOUR, 
				       TIM.TRANING_ST_MIN, 
				       TIM.TRANING_ED_HOUR, 
				       TIM.TRANING_ED_MIN , 
				       TIM.LEAD_TIME , 
				       TIM.LEAD_TIME  STUDY_TIME,
				       CON.CONTENT_NAME,
				       CON.WEEK_ST_DATE,
				       CON.WEEK_ED_DATE,
				       TO_CHAR(TO_DATE(TIM.TRANING_DATE,'YYYY.MM.DD'), 'dy', 'NLS_DATE_LANGUAGE=korean') DAY_WEEK,
				       WER.REINFC_TRANING_DATE,
				       TO_CHAR(TO_DATE(WER.REINFC_TRANING_DATE,'YYYY.MM.DD'), 'dy', 'NLS_DATE_LANGUAGE=korean') REINFC_DAY_WEEK,
				       
					   
					   TIM.TRANING_ST_HOUR ||':'|| TIM.TRANING_ST_MIN as TRANING_ST,
					   TIM.TRANING_ED_HOUR ||':'|| TIM.TRANING_ED_MIN as TRANING_ED,
					   
					   TIM.LEAD_TIME AS TIME_HOUR,
					   MOD(TRIM(TIM.TRANING_ED_MIN), TRIM(TIM.TRANING_ST_MIN) ) AS TIME_MIN,
					   
					   CASE WHEN TO_CHAR(TO_DATE(TIM.TRANING_DATE,'YYYY.MM.DD'),'YYYY.MM.DD') BETWEEN TO_CHAR(TRUNC(SYSDATE,'IW'),'YYYY.MM.DD') AND TO_CHAR(TRUNC(SYSDATE,'IW')+6,'YYYY.MM.DD')
					   THEN 'Y'
					   ELSE 'N'
					   END NOW_WEEK_YN,
					   <![CDATA[
					   CASE 
				           WHEN TO_CHAR(SYSDATE,'YYYY.MM.DD') BETWEEN TO_CHAR(TO_DATE(CON.WEEK_ST_DATE,'YYYY.MM.DD'),'YYYY.MM.DD') AND TO_CHAR(TO_DATE(CON.WEEK_ED_DATE,'YYYY.MM.DD'),'YYYY.MM.DD') 
				           THEN '학습' 
				           WHEN TO_CHAR(SYSDATE,'YYYY.MM.DD') > TO_CHAR(TO_DATE(CON.WEEK_ED_DATE,'YYYY.MM.DD'),'YYYY.MM.DD') 
				           THEN '복습' 
				           WHEN TO_CHAR(SYSDATE,'YYYY.MM.DD') < TO_CHAR(TO_DATE(CON.WEEK_ED_DATE,'YYYY.MM.DD'),'YYYY.MM.DD') 
				           THEN '예습' 
				           WHEN NVL(CON.WEEK_ED_DATE,'') = '' 
				           THEN '학습' 
				           ELSE '학습' 
				       END BTN_TEXT,  
					    ]]>	
					   
					   
				      (SELECT MAX(REP.REPORT_ID) 
				         FROM LMS_REPORT REP 
				        WHERE REP.DELETE_YN = 'N' 
				              AND REP.YYYY = WEE.YYYY 
				              AND REP.TERM = WEE.TERM 
				              AND REP.SUBJECT_CODE = WEE.SUBJECT_CODE
				              AND REP.CLASS = WEE.CLASS  
				              AND REP.WEEK_CNT = WEE.WEEK_CNT  
				              AND REP.REPORT_ID NOT IN 
				              (SELECT SMT.REPORT_ID 
				                FROM LMS_REPORT_SUBMIT SMT 
				               WHERE SMT.DELETE_YN = 'N' 
				                     AND SMT.INSERT_USER = LES.MEM_SEQ 
				              )  
				              AND TO_CHAR(SYSDATE,'YYYY.MM.DD') BETWEEN REP.SUBMIT_START_DATE AND REP.SUBMIT_END_DATE   
				       ) AS REPORT_ID,
					  
					  (SELECT MAX(DISCUSS_ID) 
					    FROM LMS_DISCUSS DIS 
					   WHERE DIS.DELETE_YN = 'N' 
					         AND DIS.YYYY = WEE.YYYY 
					         AND DIS.TERM = WEE.TERM 
					         AND DIS.SUBJECT_CODE = WEE.SUBJECT_CODE 
					         AND DIS.CLASS = WEE.CLASS 
					       <!--   AND TO_CHAR(SYSDATE,'YYYY.MM.DD') BETWEEN DIS.START_DATE AND DIS.END_DATE  -->
					         AND TO_CHAR(TO_DATE(TIM.TRANING_DATE,'YYYY.MM.DD'),'YYYY.MM.DD') BETWEEN DIS.START_DATE AND DIS.END_DATE
					  ) AS DISCUSS_ID,
					  
					  (SELECT COUNT(1)
				         FROM LMS_TRANING_NOTE_MASTER NOM 
				        WHERE NOM.DELETE_YN = 'N' 
				              AND NOM.YYYY = WEE.YYYY 
				              AND NOM.TERM = WEE.TERM 
				              AND NOM.SUBJECT_CODE = WEE.SUBJECT_CODE 
				              AND NOM.CLASS = WEE.CLASS 
				              AND NOM.WEEK_CNT = WEE.WEEK_CNT
				       ) AS TRA_NOTE_CNT,
				       
				       (SELECT COUNT(1)
				         FROM LMS_ACTIVITY_NOTE ACT 
				        WHERE ACT.DELETE_YN = 'N' 
				              AND ACT.YYYY = WEE.YYYY 
				              AND ACT.TERM = WEE.TERM 
				              AND ACT.SUBJECT_CODE = WEE.SUBJECT_CODE 
				              AND ACT.CLASS = WEE.CLASS 
				              AND ACT.WEEK_CNT = WEE.WEEK_CNT
				              AND ACT.INSERT_USER = #{sessionMemSeq} 
				       ) AS ACT_NOTE_CNT,
				       
				       
				       (SELECT COUNT(1) 
				         FROM LMS_SUBJ_WEEK_SCH SCH 
				        WHERE SCH.DELETE_YN = 'N' 
				              AND SCH.WEEK_ID = WEE.WEEK_ID 
				       ) WEEK_MAPPING_CNT , 
				       
				        (SELECT COUNT(1) 
				         FROM LMS_SUBJ_WEEK_FILE FI 
				        WHERE FI.DELETE_YN = 'N' 
				              AND FI.WEEK_ID = WEE.WEEK_ID 
				       ) WEEK_FILE_CNT , 
				       
				      (SELECT COUNT(1) 
				         FROM LMS_SUBJ_WEEK_SCH SCH  
				        WHERE SCH.DELETE_YN = 'N' 
				              AND SCH.WEEK_ID = WEE.WEEK_ID 
				              AND LINK_CONTENT_YN = 'Y' 
				              <![CDATA[
				              AND DEVICE_TYPE_CODE <> '1' 
				              ]]>
				       ) WEEK_MOBILE_NOT_CNT ,
				       
				        <!-- (SELECT GROUP_CONCAT(UNIT.NCS_UNIT_NAME,'<BR>',ELEM.NCS_ELEM_NAME) -->
				        <![CDATA[
				     	(SELECT UNIT.NCS_UNIT_NAME||'<BR>'||ELEM.NCS_ELEM_NAME
				         FROM LMS_SUBJ_NCS_UNIT UNIT 
				          INNER JOIN LMS_SUBJ_NCS_ELEM ELEM 
				              ON ELEM.NCS_UNIT_ID = UNIT.NCS_UNIT_ID 
				              AND ELEM.WEEK_ID = UNIT.WEEK_ID 
				              AND ELEM.DELETE_YN = 'N' 
				        WHERE UNIT.DELETE_YN = 'N' 
				              AND UNIT.WEEK_ID = WEE.WEEK_ID 
				              AND ROWNUM = 1
				       ) NCS_NAME ,
				        ]]>	
				        <!-- FN_WEEK_PROGRESS_RATE(WEE.YYYY,WEE.TERM,WEE.SUBJECT_CODE,WEE.CLASS,WEE.WEEK_ID,LES.LESSON_ID) AS WEEK_PROGRESS_RATE -->
				        NVL(OLES.WEEK_ON_PROGRESS_RATE,0) AS WEEK_PROGRESS_RATE,
				        
				         (SELECT CONTENT_NAME 
					         FROM LMS_SUBJ_WEEK_CONTENT 
					        WHERE DELETE_YN = 'N' 
					              AND WEEK_ID = WEE.WEEK_ID 
					              AND ROWNUM = 1
					       ) AS CONTENT_NAME  
					       
				  FROM LMS_SUBJ_WEEK WEE 
				  	INNER JOIN LMS_LESSON LES 
				       ON WEE.YYYY = LES.YYYY 
				       AND WEE.TERM = LES.TERM 
				       AND WEE.SUBJECT_CODE = LES.SUBJECT_CODE 
				       AND WEE.CLASS = LES.CLASS 
				       AND LES.DELETE_YN = 'N' 
				       AND LES.LEC_STATUS = 'A' 
				       AND LES.MEM_SEQ = #{sessionMemSeq} 
				       
				  LEFT OUTER JOIN LMS_WEEK_ON_LESSON OLES 
			         ON OLES.LESSON_ID = LES.LESSON_ID 
			       AND OLES.WEEK_ID = WEE.WEEK_ID     
				       
				   LEFT OUTER JOIN LMS_SUBJ_WEEK_TIME TIM 
				       ON WEE.WEEK_ID = TIM.WEEK_ID 
				       AND WEE.YYYY = TIM.YYYY 
				       AND WEE.TERM = TIM.TERM 
				       AND WEE.SUBJECT_CODE = TIM.SUBJECT_CODE 
				       AND WEE.CLASS = TIM.CLASS 
				       AND TIM.DELETE_YN = 'N' 
				       
				   LEFT OUTER JOIN LMS_SUBJ_WEEK_CONTENT CON 
				         ON WEE.WEEK_ID = CON.WEEK_ID 
				       AND CON.DELETE_YN = 'N'      
				   
				   LEFT OUTER JOIN LMS_TERM_WEEK_REINFC WER 
				         ON WER.YYYY = WEE.YYYY 
				         AND WER.TERM = WEE.TERM
				         AND WER.WEEK_CNT= TIM.WEEK_CNT
				      	 AND WER.DELETE_YN = 'N'       
				       
				 WHERE WEE.DELETE_YN = 'N' 
				       AND WEE.YYYY = #{yyyy} 
				       AND WEE.TERM = #{term} 
				       AND WEE.SUBJECT_CODE = #{subjectCode} 
				       AND WEE.CLASS = #{subjectClass}  
				       
				       ORDER BY TO_NUMBER(WEE.WEEK_CNT)
	</select>
	
	<select id="getOnlineWeekLessonSchedule" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.getOnlineWeekLessonSchedule ====== */
		SELECT WEE.WEEK_CNT , 
				       WEE.WEEK_ID, 
				       WEE.YYYY, 
					   WEE.TERM, 
					   WEE.SUBJECT_CODE, 
					   WEE.CLASS AS SUBJECT_CLASS, 
				       LES.LESSON_ID, 
				       CON.CONTENT_NAME,  
				       
				       (
				       SELECT WEEK_CNT FROM
				       LMS_SUBJ_WEEK_TIME TIM 
				       WHERE WEE.WEEK_ID = TIM.WEEK_ID 
				       AND WEE.YYYY = TIM.YYYY 
				       AND WEE.TERM = TIM.TERM 
				       AND WEE.SUBJECT_CODE = TIM.SUBJECT_CODE 
				       AND WEE.CLASS = TIM.CLASS 
				       AND TIM.DELETE_YN = 'N' 
				       AND ROWNUM = 1
				       ) WEK_CNT,
				       
				       NVL(OLES.WEEK_ON_PROGRESS_RATE,0) AS WEEK_PROGRESS_RATE 
				  FROM LMS_SUBJ_WEEK WEE 
				  	
				  	INNER JOIN LMS_LESSON LES 
				       ON WEE.YYYY = LES.YYYY 
				       AND WEE.TERM = LES.TERM 
				       AND WEE.SUBJECT_CODE = LES.SUBJECT_CODE 
				       AND WEE.CLASS = LES.CLASS 
				       AND LES.DELETE_YN = 'N' 
				       AND LES.LEC_STATUS = 'A' 
				       AND LES.MEM_SEQ = #{sessionMemSeq} 
				
				   INNER JOIN LMS_SUBJ_WEEK_CONTENT CON 
				         ON WEE.WEEK_ID = CON.WEEK_ID 
				       AND CON.DELETE_YN = 'N'      
				   
				   LEFT OUTER JOIN LMS_WEEK_ON_LESSON OLES 
	                     ON OLES.LESSON_ID = LES.LESSON_ID 
	                   AND OLES.WEEK_ID = WEE.WEEK_ID    
				       
				 WHERE WEE.DELETE_YN = 'N' 
				       AND WEE.YYYY = #{yyyy} 
				       AND WEE.TERM = #{term} 
				       AND WEE.SUBJECT_CODE = #{subjectCode} 
				       AND WEE.CLASS = #{subjectClass}  
				       AND WEE.WEEK_ID = #{weekId}
	</select>
	
	<select id="getOnlineWeekLessonSchedulePreview" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.getOnlineWeekLessonSchedulePreview ====== */
		SELECT WEE.WEEK_CNT , 
				       WEE.WEEK_ID, 
				       WEE.YYYY, 
					   WEE.TERM, 
					   WEE.SUBJECT_CODE, 
					   WEE.CLASS AS SUBJECT_CLASS, 
				       CON.CONTENT_NAME,
				       (
				       SELECT WEEK_CNT FROM
				       LMS_SUBJ_WEEK_TIME TIM 
				       WHERE WEE.WEEK_ID = TIM.WEEK_ID 
				       AND WEE.YYYY = TIM.YYYY 
				       AND WEE.TERM = TIM.TERM 
				       AND WEE.SUBJECT_CODE = TIM.SUBJECT_CODE 
				       AND WEE.CLASS = TIM.CLASS 
				       AND TIM.DELETE_YN = 'N' 
				       AND ROWNUM = 1
				       ) WEK_CNT
				       
				  FROM LMS_SUBJ_WEEK WEE 
				  
				  INNER JOIN LMS_SUBJ_INS_MAPPING INS 
				       ON WEE.YYYY = INS.YYYY 
				       AND WEE.TERM = INS.TERM 
				       AND WEE.SUBJECT_CODE = INS.SUBJECT_CODE 
				       AND WEE.CLASS = INS.CLASS 
				       AND INS.DELETE_YN = 'N' 
				       AND INS.MEM_SEQ = #{sessionMemSeq} 
				  
				   INNER JOIN LMS_SUBJ_WEEK_CONTENT CON 
				         ON WEE.WEEK_ID = CON.WEEK_ID 
				       AND CON.DELETE_YN = 'N'      
				 WHERE WEE.DELETE_YN = 'N' 
				       AND WEE.YYYY = #{yyyy} 
				       AND WEE.TERM = #{term} 
				       AND WEE.SUBJECT_CODE = #{subjectCode} 
				       AND WEE.CLASS = #{subjectClass}  
				       AND WEE.WEEK_ID = #{weekId}
	</select>
	
	<select id="listOjtTraningStdSchedule" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOjtTraningStdSchedule ====== */
			SELECT WEE.WEEK_CNT , 
				       WEE.WEEK_ID, 
				       WEE.YYYY, 
					   WEE.TERM, 
					   WEE.SUBJECT_CODE, 
					   WEE.CLASS AS SUBJECT_CLASS,
				       TIM.TRANING_DATE, 
				       TIM.TIME_ID, 
				       COUNT(*)OVER(PARTITION BY WEE.WEEK_ID) AS ROWSPAN_CNT,
       			  	   ROW_NUMBER() OVER(PARTITION BY WEE.WEEK_ID ORDER BY TIM.TIME_ID) AS ROW_NUM,
				       TO_CHAR(TO_DATE(TIM.TRANING_DATE,'YYYY.MM.DD'), 'dy', 'NLS_DATE_LANGUAGE=korean') DAY_WEEK,
					   
					   TIM.TRANING_ST_HOUR ||':'|| TIM.TRANING_ST_MIN as TRANING_ST,
					   TIM.TRANING_ED_HOUR ||':'|| TIM.TRANING_ED_MIN as TRANING_ED,
					   
					  <!--  MOD(TIM.TRANING_ED_HOUR,TIM.TRANING_ST_HOUR ) AS TIME_HOUR, -->
					  
					  (SELECT NVL(MAX(TO_NUMBER(WEEK.WEEK_CNT)),'1') AS WEEK_CNT 
				         FROM LMS_SUBJ_WEEK WEEK  
				            LEFT JOIN LMS_SUBJ_WEEK_TIME WEET 
				                ON WEEK.SUBJECT_CODE = WEET.SUBJECT_CODE 
				              AND WEET.DELETE_YN = 'N' 
				              AND WEET.WEEK_ID = WEEK.WEEK_ID  
				        WHERE WEEK.SUBJECT_CODE = WEE.SUBJECT_CODE 
				              AND WEEK.DELETE_YN ='N' 
				              AND WEEK.YYYY= WEE.YYYY  
				              AND WEEK.CLASS = WEE.CLASS   
				              <![CDATA[
				              AND WEET.TRANING_DATE <= TO_CHAR(SYSDATE,'YYYY.MM.DD')  
				              ]]>
				       ) NOW_WEEK_CNT ,
					  
					  (SELECT COUNT(1)
				         FROM LMS_TRANING_NOTE_MASTER NOM 
				        WHERE NOM.DELETE_YN = 'N' 
				              AND NOM.YYYY = WEE.YYYY 
				              AND NOM.TERM = WEE.TERM 
				              AND NOM.SUBJECT_CODE = WEE.SUBJECT_CODE 
				              AND NOM.CLASS = WEE.CLASS 
				              AND NOM.WEEK_CNT = WEE.WEEK_CNT
				       ) AS TRA_NOTE_CNT,
				       
				       (SELECT COUNT(1)
				         FROM LMS_ACTIVITY_NOTE ACT 
				        WHERE ACT.DELETE_YN = 'N' 
				              AND ACT.YYYY = WEE.YYYY 
				              AND ACT.TERM = WEE.TERM 
				              AND ACT.SUBJECT_CODE = WEE.SUBJECT_CODE 
				              AND ACT.CLASS = WEE.CLASS 
				              AND ACT.WEEK_CNT = WEE.WEEK_CNT
				              AND ACT.INSERT_USER = #{sessionMemSeq} 
				       ) AS ACT_NOTE_CNT,
					   
					   (SELECT SUM(LEAD_TIME) 
				         FROM LMS_SUBJ_WEEK_TIME 
				        WHERE DELETE_YN = 'N' 
				              AND WEEK_ID = WEE.WEEK_ID 
				       ) TIME_HOUR,
					   
					   MOD(TRIM(TIM.TRANING_ED_MIN), TRIM(TIM.TRANING_ST_MIN) ) AS TIME_MIN,
				       TIM.TRANING_ST_HOUR, 
				       TIM.TRANING_ST_MIN, 
				       TIM.TRANING_ED_HOUR, 
				       TIM.TRANING_ED_MIN , 
				       
				       TIM.NCS_UNIT_NAME,
				   	   TIM.NCS_ELEM_NAME,
				       <![CDATA[  
				     	(SELECT UNIT.NCS_UNIT_NAME||'<BR>'||ELEM.NCS_ELEM_NAME
				         FROM LMS_SUBJ_NCS_UNIT UNIT 
				          INNER JOIN LMS_SUBJ_NCS_ELEM ELEM 
				              ON ELEM.NCS_UNIT_ID = UNIT.NCS_UNIT_ID 
				              AND ELEM.DELETE_YN = 'N' 
				        WHERE UNIT.DELETE_YN = 'N' 
				              AND UNIT.WEEK_ID = WEE.WEEK_ID 
				              AND ROWNUM = 1
				       ) NCS_NAME
				       ]]>	
				  FROM LMS_SUBJ_WEEK WEE 
				  
				     INNER JOIN LMS_LESSON LES 
				       ON WEE.YYYY = LES.YYYY 
				       AND WEE.TERM = LES.TERM 
				       AND WEE.SUBJECT_CODE = LES.SUBJECT_CODE 
				       AND WEE.CLASS = LES.CLASS 
				       AND LES.DELETE_YN = 'N' 
				       AND LES.LEC_STATUS = 'A' 
				       AND LES.MEM_SEQ = #{sessionMemSeq} 
				       
				     LEFT OUTER JOIN LMS_SUBJ_WEEK_TIME TIM 
				         ON WEE.WEEK_ID = TIM.WEEK_ID
					       AND WEE.YYYY = TIM.YYYY 
					       AND WEE.TERM = TIM.TERM 
					       AND WEE.SUBJECT_CODE = TIM.SUBJECT_CODE 
					       AND WEE.CLASS = TIM.CLASS 
				       AND TIM.DELETE_YN = 'N' 
				          
				 WHERE WEE.DELETE_YN = 'N' 
				       AND WEE.YYYY = #{yyyy} 
				       AND WEE.TERM = #{term} 
				       AND WEE.SUBJECT_CODE = #{subjectCode} 
				       AND WEE.CLASS = #{subjectClass}  
				ORDER BY TO_NUMBER(WEE.WEEK_CNT), TIM.TIME_ID  
	</select>
	
	
	<select id="getTraningStatus" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.OnlineTraningMapper.service.impl.getTraningStatus  ====== */
	 		SELECT S.REAL_PROGRESS_RATE FROM (
				SELECT  CM.MEM_NAME 
					,LL.LESSON_ID
					,LL.MEM_SEQ		
					,CM.MEM_ID	  
					,LL.YYYY
					,LL.TERM
					,LL.CLASS AS CLASS_ID
					,LL.SUBJECT_CODE
					,CM.COMPANY_ID
					,FN_GETCOMPAYNAME(CM.COMPANY_ID) AS COMPANY_NAME				
	<![CDATA[  
					,COUNT(WEEK.WEEK_ID) AS TOTAL_TIME	 /* 전체출석일 */
					,SUM(
					
					CASE 
	                WHEN SWT.LEAD_TIME <= TND.STUDY_TIME
	                THEN 1
	                ELSE 0
	                END
					
					) AS ATTEND   /* 출석*/
					,SUM(
					
					CASE 
	                WHEN SWT.LEAD_TIME-1 = TND.STUDY_TIME
	                THEN 1
	                ELSE 0
	                END
					
					) AS LATENESS  /* 지각*/
					
					,MAX(TO_NUMBER(WEEK.WEEK_CNT)) AS ON_TOTAL_TIME	 /* 전체출석일 */
	]]>					
	<![CDATA[
	 				,SUM(
	 				
	 				CASE 
	                WHEN NVL(OLES.WEEK_ON_PROGRESS_RATE,0) >= LSOS.ATTEND_PROGRESS
	                THEN 1
	                ELSE 0
	                END
	 				
	 				) AS ON_ATTEND   /* 출석*/
					,SUM(
					
					CASE 
	                WHEN NVL(OLES.WEEK_ON_PROGRESS_RATE,0) < LSOS.ATTEND_PROGRESS AND NVL(OLES.WEEK_ON_PROGRESS_RATE,0) >= LSOS.CUT_PROGRESS
	                THEN 1
	                ELSE 0
	                END
					
					) AS ON_LATENESS  /* 지각*/
					,LL.ON_PROGRESS_RATE ON_REAL_PROGRESS_RATE
	]]>		
	<![CDATA[
			        ,
			        NVL(
					        FLOOR((
					  				SELECT SUM(TND.STUDY_TIME) AS STUDY_TIME
					  				FROM LMS_TRANING_NOTE_MASTER TNM,
					  					 LMS_TRANING_NOTE_DETAIL TND
					  				WHERE TNM.TRANINING_NOTE_MASTER_ID = TND.TRANINING_NOTE_MASTER_ID
					  				AND TNM.DELETE_YN='N' 
					  				AND TND.DELETE_YN='N' 
					  				AND TNM.SUBJECT_CODE= LL.SUBJECT_CODE
					  				AND TND.MEM_ID= CM.MEM_ID    
					  				AND TNM.YYYY=  LL.YYYY   
					  				AND TNM.CLASS  = LL.CLASS					
					  				)
					  				/
					          		(
					  				SELECT SUM( WEET.LEAD_TIME )
					  				FROM  LMS_SUBJ_WEEK_TIME WEET 
					  				WHERE 
					  					WEET.SUBJECT_CODE = LL.SUBJECT_CODE 
					  				AND WEET.YYYY =  LL.YYYY
					  				AND WEET.TERM =  LL.TERM
					  				AND WEET.CLASS =  LL.CLASS
					  				AND WEET.DELETE_YN = 'N'	
							  		) *100) ,0) AS REAL_PROGRESS_RATE
	]]>					
					
					FROM LMS_LESSON LL
	 
					INNER JOIN  LMS_SUBJ_WEEK  WEEK 
											ON WEEK.DELETE_YN='N'
											AND LL.YYYY=WEEK.YYYY  
											AND LL.TERM=WEEK.TERM   
											AND LL.SUBJECT_CODE=WEEK.SUBJECT_CODE  
											AND LL.CLASS =WEEK.CLASS
					INNER JOIN COM_MEMBER CM ON CM.MEM_SEQ=LL.MEM_SEQ AND CM.DELETE_YN='N'
	<![CDATA[ 
					INNER JOIN LMS_SUBJ_WEEK_TIME SWT ON SWT.DELETE_YN='N'
											AND LL.YYYY=SWT.YYYY  
											AND LL.TERM=SWT.TERM   
											AND LL.SUBJECT_CODE=SWT.SUBJECT_CODE  
											AND LL.CLASS =SWT.CLASS
											AND WEEK.WEEK_ID = SWT.WEEK_ID
											AND SWT.TRANING_DATE  <= TO_CHAR(SYSDATE,'YYYY.MM.DD')										
					LEFT OUTER JOIN LMS_TRANING_NOTE_DETAIL TND   
											ON  TND.SUBJECT_CODE= LL.SUBJECT_CODE
											AND TND.DELETE_YN='N'  
											AND TND.MEM_ID=CM.MEM_ID    
											AND TND.ADDYN = 'N'
											AND TND.YYYY=  LL.YYYY   
											AND TND.CLASS  = LL.CLASS	
											AND TND.TERM  = LL.TERM	
											AND TND.TIME_ID = SWT.TIME_ID
			        LEFT OUTER JOIN LMS_SUBJ_ON_STAND LSOS
											ON LSOS.CLASS = LL.CLASS
											AND LSOS.YYYY = LL.YYYY
											AND LSOS.TERM = LL.TERM
											AND LSOS.SUBJECT_CODE = LL.SUBJECT_CODE
											AND LSOS.DELETE_YN = 'N'
											
					LEFT OUTER JOIN LMS_WEEK_ON_LESSON OLES 
						                     ON OLES.LESSON_ID = LL.LESSON_ID 
						                   AND OLES.WEEK_ID = WEEK.WEEK_ID 																			
	]]>				 
					WHERE  LL.DELETE_YN='N'
						AND LL.LEC_STATUS='A'  
						AND LL.YYYY= #{yyyy}
						AND LL.TERM=#{term}
						AND LL.SUBJECT_CODE= #{subjectCode}	  
						AND LL.MEM_SEQ = #{sessionMemSeq} 
						AND LL.CLASS = #{subjectClass}
				 GROUP BY CM.MEM_NAME 
					,LL.LESSON_ID
					,LL.MEM_SEQ		
					,CM.MEM_ID	  
					,LL.YYYY
					,LL.TERM
					,LL.CLASS
					,LL.SUBJECT_CODE
					,CM.COMPANY_ID
				    ,LL.ON_PROGRESS_RATE 
				          ) S   
	         WHERE 1=1
	 
		   
		</select>
	
	<select id="listOnlineTraningInsSchedule" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOnlineTraningInsSchedule ====== */
		SELECT WEE.WEEK_CNT , 
				       WEE.WEEK_ID, 
				       WEE.YYYY, 
					   WEE.TERM, 
					   WEE.SUBJECT_CODE, 
					   WEE.CLASS AS SUBJECT_CLASS, 
				       TIM.TRANING_DATE,
				       TIM.TRANING_ST_HOUR, 
				       TIM.TRANING_ST_MIN, 
				       TIM.TRANING_ED_HOUR, 
				       TIM.TRANING_ED_MIN , 
				       TIM.LEAD_TIME , 
				       CON.CONTENT_NAME,
				       CON.WEEK_ST_DATE,
				       CON.WEEK_ED_DATE,
				       
				       CASE WHEN TO_CHAR(TO_DATE(TIM.TRANING_DATE,'YYYY.MM.DD'),'YYYY.MM.DD') BETWEEN TO_CHAR(TRUNC(SYSDATE,'IW'),'YYYY.MM.DD') AND TO_CHAR(TRUNC(SYSDATE,'IW')+6,'YYYY.MM.DD')
					   THEN 'Y'
					   ELSE 'N'
					   END NOW_WEEK_YN,
					   
					   (SELECT COUNT(*) 
				         FROM LMS_LESSON LES  
				        WHERE WEE.YYYY = LES.YYYY 
				              AND WEE.TERM = LES.TERM 
				              AND WEE.SUBJECT_CODE = LES.SUBJECT_CODE 
				              AND WEE.CLASS = LES.CLASS 
				              AND LES.DELETE_YN = 'N'   
				              AND LES.LEC_STATUS = 'A' 
				       ) LESSON_CNT,
				       
				       TO_CHAR(TO_DATE(TIM.TRANING_DATE,'YYYY.MM.DD'), 'dy', 'NLS_DATE_LANGUAGE=korean') DAY_WEEK,
				       WER.REINFC_TRANING_DATE,
				       TO_CHAR(TO_DATE(WER.REINFC_TRANING_DATE,'YYYY.MM.DD'), 'dy', 'NLS_DATE_LANGUAGE=korean') REINFC_DAY_WEEK,
				       TIM.TRANING_ST_HOUR||':'||TIM.TRANING_ST_MIN as TRANING_ST,
					   TIM.TRANING_ED_HOUR||':'||TIM.TRANING_ED_MIN as TRANING_ED,
					   TIM.LEAD_TIME AS TIME_HOUR,
					   MOD(TRIM(TIM.TRANING_ED_MIN), TRIM(TIM.TRANING_ST_MIN) ) AS TIME_MIN,
					   
					    <!-- 
				        OFF-JT 강+실 * 15 / 주차 
			          	SUBJ.LCTRE_TIME+SUBJ.TEST_EXEC_TIME * 15 / 촣 주차
				        -->
				        
				        
				       
				    
				       (SELECT MAX(REPORT_ID) 
					    FROM LMS_REPORT REP 
					   WHERE REP.DELETE_YN = 'N' 
					         AND REP.YYYY = WEE.YYYY 
					         AND REP.TERM = WEE.TERM 
					         AND REP.SUBJECT_CODE = WEE.SUBJECT_CODE 
					         AND REP.CLASS = WEE.CLASS 
					         AND REP.WEEK_CNT = WEE.WEEK_CNT 
					       <!--   AND TO_CHAR(SYSDATE,'YYYY.MM.DD') BETWEEN REP.SUBMIT_START_DATE AND REP.SUBMIT_END_DATE  -->
					  ) AS REPORT_ID,
					  
					  (SELECT MAX(DISCUSS_ID) 
					    FROM LMS_DISCUSS DIS 
					   WHERE DIS.DELETE_YN = 'N' 
					         AND DIS.YYYY = WEE.YYYY 
					         AND DIS.TERM = WEE.TERM 
					         AND DIS.SUBJECT_CODE = WEE.SUBJECT_CODE 
					         AND DIS.CLASS = WEE.CLASS 
					       <!--   AND TO_CHAR(SYSDATE,'YYYY.MM.DD') BETWEEN DIS.START_DATE AND DIS.END_DATE  -->
					         AND TO_CHAR(TO_DATE(TIM.TRANING_DATE,'YYYY.MM.DD'),'YYYY.MM.DD') BETWEEN DIS.START_DATE AND DIS.END_DATE
					  ) AS DISCUSS_ID,
					  
					  (SELECT COUNT(1)
				         FROM LMS_TRANING_NOTE_MASTER NOM 
				        WHERE NOM.DELETE_YN = 'N' 
				              AND NOM.YYYY = WEE.YYYY 
				              AND NOM.TERM = WEE.TERM 
				              AND NOM.SUBJECT_CODE = WEE.SUBJECT_CODE 
				              AND NOM.CLASS = WEE.CLASS 
				              AND NOM.WEEK_CNT = WEE.WEEK_CNT
				       ) AS TRA_NOTE_CNT,
				       
				       (SELECT COUNT(1)
				         FROM LMS_ACTIVITY_NOTE ACT 
				        WHERE ACT.DELETE_YN = 'N' 
				              AND ACT.YYYY = WEE.YYYY 
				              AND ACT.TERM = WEE.TERM 
				              AND ACT.SUBJECT_CODE = WEE.SUBJECT_CODE 
				              AND ACT.CLASS = WEE.CLASS 
				              AND ACT.WEEK_CNT = WEE.WEEK_CNT
				       ) AS ACT_NOTE_CNT,
				      
				       (SELECT COUNT(1) 
				         FROM LMS_SUBJ_WEEK_SCH SCH 
				        WHERE SCH.DELETE_YN = 'N' 
				              AND SCH.WEEK_ID = WEE.WEEK_ID 
				       ) WEEK_MAPPING_CNT , 
				       
				       (SELECT COUNT(1) 
				         FROM LMS_SUBJ_WEEK_SCH SCH  
				        WHERE SCH.DELETE_YN = 'N' 
				              AND SCH.WEEK_ID = WEE.WEEK_ID 
				              AND LINK_CONTENT_YN = 'Y' 
				              <![CDATA[
				              AND DEVICE_TYPE_CODE <> '1' 
				              ]]>	
				       ) WEEK_MOBILE_NOT_CNT ,
				       
				        <!-- (SELECT GROUP_CONCAT(UNIT.NCS_UNIT_NAME,'<BR>',ELEM.NCS_ELEM_NAME) -->
				        <![CDATA[
				     	(SELECT UNIT.NCS_UNIT_NAME||'<BR>'||ELEM.NCS_ELEM_NAME
				         FROM LMS_SUBJ_NCS_UNIT UNIT 
				          INNER JOIN LMS_SUBJ_NCS_ELEM ELEM 
				              ON ELEM.NCS_UNIT_ID = UNIT.NCS_UNIT_ID 
				              AND ELEM.DELETE_YN = 'N' 
				              AND ELEM.WEEK_ID = UNIT.WEEK_ID 
				        WHERE UNIT.DELETE_YN = 'N' 
				              AND UNIT.WEEK_ID = WEE.WEEK_ID 
				              AND ROWNUM = 1
				       ) NCS_NAME 
				        ]]>	
				  FROM LMS_SUBJ_WEEK WEE 
				  
				  	INNER JOIN LMS_SUBJ_INS_MAPPING INS 
				       ON WEE.YYYY = INS.YYYY 
				       AND WEE.TERM = INS.TERM 
				       AND WEE.SUBJECT_CODE = INS.SUBJECT_CODE 
				       AND WEE.CLASS = INS.CLASS 
				       AND INS.DELETE_YN = 'N' 
				       AND INS.MEM_SEQ = #{sessionMemSeq} 
				       
				   LEFT OUTER JOIN LMS_SUBJ_WEEK_TIME TIM 
				       ON WEE.WEEK_ID = TIM.WEEK_ID 
				       AND WEE.YYYY = TIM.YYYY 
				       AND WEE.TERM = TIM.TERM 
				       AND WEE.SUBJECT_CODE = TIM.SUBJECT_CODE 
				       AND WEE.CLASS = TIM.CLASS 
				       AND TIM.DELETE_YN = 'N' 
				       
				   LEFT OUTER JOIN LMS_SUBJ_WEEK_CONTENT CON 
				         ON WEE.WEEK_ID = CON.WEEK_ID 
				       AND CON.DELETE_YN = 'N'  
				       
				   LEFT OUTER JOIN LMS_TERM_WEEK_REINFC WER 
				         ON WER.YYYY = WEE.YYYY 
				         AND WER.TERM = WEE.TERM
				         AND WER.WEEK_CNT= TIM.WEEK_CNT
				      	 AND WER.DELETE_YN = 'N'          
				       
				 WHERE WEE.DELETE_YN = 'N' 
				       AND WEE.YYYY = #{yyyy} 
				       AND WEE.TERM = #{term} 
				       AND WEE.SUBJECT_CODE = #{subjectCode} 
				       AND WEE.CLASS = #{subjectClass}  
				       
				       ORDER BY TO_NUMBER(WEE.WEEK_CNT)
	</select>
	
	<select id="listOjtTraningInsSchedule" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOjtTraningInsSchedule ====== */
		
		SELECT WEE.WEEK_CNT , 
			       WEE.WEEK_ID, 
			       TIM.TRANING_DATE, 
			       TIM.TIME_ID, 
			       COUNT(*)OVER(PARTITION BY WEE.WEEK_ID) AS ROWSPAN_CNT,
       			   ROW_NUMBER() OVER(PARTITION BY WEE.WEEK_ID ORDER BY TIM.TIME_ID) AS ROW_NUM,
			       TO_CHAR(TO_DATE(TIM.TRANING_DATE,'YYYY.MM.DD'), 'dy', 'NLS_DATE_LANGUAGE=korean') DAY_WEEK,
				   
				   TIM.TRANING_ST_HOUR ||':'|| TIM.TRANING_ST_MIN as TRANING_ST,
				   TIM.TRANING_ED_HOUR ||':'|| TIM.TRANING_ED_MIN as TRANING_ED,
				   
				  <!--  MOD(TIM.TRANING_ED_HOUR,TIM.TRANING_ST_HOUR ) AS TIME_HOUR, -->
				  
				  (SELECT COUNT(*) 
			         FROM LMS_LESSON LES  
			        WHERE WEE.YYYY = LES.YYYY 
			              AND WEE.TERM = LES.TERM 
			              AND WEE.SUBJECT_CODE = LES.SUBJECT_CODE
			              AND WEE.CLASS = LES.CLASS 
			              AND LES.DELETE_YN = 'N' 
			              AND LES.LEC_STATUS = 'A' 
			       ) LESSON_CNT,
				  
				  (SELECT NVL(MAX(TO_NUMBER(WEEK.WEEK_CNT)),'1') AS WEEK_CNT 
			         FROM LMS_SUBJ_WEEK WEEK  
			            LEFT JOIN LMS_SUBJ_WEEK_TIME WEET 
			                ON WEEK.SUBJECT_CODE = WEET.SUBJECT_CODE 
			              AND WEET.DELETE_YN = 'N' 
			              AND WEET.WEEK_ID = WEEK.WEEK_ID  
			        <!-- WHERE WEEK.SUBJECT_CODE = WEE.SUBJECT_CODE 
			              AND WEEK.DELETE_YN ='N' 
			              AND WEEK.YYYY= WEE.YYYY  
			              AND WEEK.CLASS = WEE.CLASS   -->
			             WHERE WEEK.DELETE_YN ='N' 
				              AND WEEK.YYYY= #{yyyy}
				              AND WEEK.TERM = #{term} 
				              AND WEEK.SUBJECT_CODE = #{subjectCode} 
				              AND WEEK.CLASS = #{subjectClass}   
			             <![CDATA[
			              AND WEET.TRANING_DATE <= TO_CHAR(SYSDATE,'YYYY.MM.DD')  
			              ]]>
			       ) NOW_WEEK_CNT ,
				  
				  (SELECT MAX(STATUS)
			         FROM LMS_TRANING_NOTE_MASTER NOM 
			        WHERE NOM.DELETE_YN = 'N' 
			              AND NOM.YYYY = WEE.YYYY 
			              AND NOM.TERM = WEE.TERM 
			              AND NOM.SUBJECT_CODE = WEE.SUBJECT_CODE 
			              AND NOM.CLASS = WEE.CLASS
			              AND NOM.WEEK_CNT = WEE.WEEK_CNT
			              AND NOM.TIME_ID = TIM.TIME_ID
			       ) AS TRA_NOTE_STATUS,
				  
				  <!--  
				  (SELECT COUNT(1)
			         FROM LMS_TRANING_NOTE_MASTER NOM 
			        WHERE NOM.DELETE_YN = 'N' 
			              AND NOM.YYYY = WEE.YYYY 
			              AND NOM.TERM = WEE.TERM 
			              AND NOM.SUBJECT_CODE = WEE.SUBJECT_CODE 
			              AND NOM.CLASS = WEE.CLASS
			              AND NOM.WEEK_CNT = WEE.WEEK_CNT
			       ) AS TRA_NOTE_CNT,
			       
			       
			       (SELECT COUNT(1)
			         FROM LMS_TRANING_NOTE_MASTER NOM 
			        WHERE NOM.DELETE_YN = 'N' 
			              AND NOM.YYYY = WEE.YYYY 
			              AND NOM.TERM = WEE.TERM 
			              AND NOM.SUBJECT_CODE = WEE.SUBJECT_CODE 
			              AND NOM.CLASS = WEE.CLASS
			              AND NOM.WEEK_CNT = WEE.WEEK_CNT
			              AND NOM.STATUS = '2'
			       ) AS TRA_NOTE_APPROVAL_CNT,
			       
			       (SELECT COUNT(1)
			         FROM LMS_ACTIVITY_NOTE ACT 
			        WHERE ACT.DELETE_YN = 'N' 
			              AND ACT.YYYY = WEE.YYYY 
			              AND ACT.TERM = WEE.TERM 
			              AND ACT.SUBJECT_CODE = WEE.SUBJECT_CODE 
			              AND ACT.CLASS = WEE.CLASS 
			              AND ACT.WEEK_CNT = WEE.WEEK_CNT
			              AND ACT.TIME_ID = TIM.TIME_ID
			       ) AS ACT_NOTE_CNT,
			       -->
			       (SELECT COUNT(1)
			         FROM LMS_ACTIVITY_NOTE ACT
			       INNER JOIN LMS_SUBJ_WEEK_TIME TME
			       ON TME.TIME_ID = ACT.TIME_ID
			       AND TME.DELETE_YN = 'N'
			        WHERE ACT.DELETE_YN = 'N'
			              AND ACT.YYYY = WEE.YYYY
			              AND ACT.TERM = WEE.TERM
			              AND ACT.SUBJECT_CODE = WEE.SUBJECT_CODE
			              AND ACT.CLASS = WEE.CLASS
			              AND ACT.WEEK_CNT = WEE.WEEK_CNT
			              AND ACT.TIME_ID = TIM.TIME_ID
			       ) AS ACT_NOTE_CNT,
			       
			        (SELECT COUNT(1)
			         FROM LMS_ACTIVITY_NOTE ACT
			       INNER JOIN LMS_SUBJ_WEEK_TIME TME
			       ON TME.TIME_ID = ACT.TIME_ID
			       AND TME.DELETE_YN = 'N'
			        WHERE ACT.DELETE_YN = 'N'
			              AND ACT.YYYY = WEE.YYYY
			              AND ACT.TERM = WEE.TERM
			              AND ACT.SUBJECT_CODE = WEE.SUBJECT_CODE
			              AND ACT.CLASS = WEE.CLASS
			              AND ACT.WEEK_CNT = WEE.WEEK_CNT
			              AND ACT.STATUS = '2'
			              AND ACT.TIME_ID = TIM.TIME_ID
			       ) AS ACT_NOTE_APPROVAL_CNT,
				   
				   
			       TIM.LEAD_TIME AS TIME_HOUR,
				   
				   MOD(TRIM(TIM.TRANING_ED_MIN), TRIM(TIM.TRANING_ST_MIN) ) AS TIME_MIN,
			       TIM.TRANING_ST_HOUR, 
			       TIM.TRANING_ST_MIN, 
			       TIM.TRANING_ED_HOUR, 
			       TIM.TRANING_ED_MIN , 
			       TIM.NCS_UNIT_NAME,
				   TIM.NCS_ELEM_NAME
			   
			  FROM LMS_SUBJ_WEEK WEE 
			  
			     INNER JOIN LMS_SUBJ_INS_MAPPING INS 
			         ON WEE.YYYY = INS.YYYY 
			       AND WEE.TERM = INS.TERM 
			       AND WEE.SUBJECT_CODE = INS.SUBJECT_CODE 
			       AND WEE.CLASS = INS.CLASS 
			       AND INS.DELETE_YN = 'N' 
			       AND INS.MEM_SEQ = #{sessionMemSeq} 
			       
			     LEFT OUTER JOIN LMS_SUBJ_WEEK_TIME TIM 
			         ON WEE.WEEK_ID = TIM.WEEK_ID
				       AND WEE.YYYY = TIM.YYYY 
				       AND WEE.TERM = TIM.TERM 
				       AND WEE.SUBJECT_CODE = TIM.SUBJECT_CODE 
				       AND WEE.CLASS = TIM.CLASS 
			       AND TIM.DELETE_YN = 'N' 
			       
			         
			 WHERE WEE.DELETE_YN = 'N' 
			       AND WEE.YYYY = #{yyyy} 
			       AND WEE.TERM = #{term} 
			       AND WEE.SUBJECT_CODE = #{subjectCode} 
			       AND WEE.CLASS = #{subjectClass}  
			ORDER BY TO_NUMBER(WEE.WEEK_CNT), TIM.TIME_ID
	</select>
	
	
	<select id="listOjtTraningCotSchedule" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOjtTraningCotSchedule ====== */
		
		SELECT WEE.WEEK_CNT , 
			       WEE.WEEK_ID, 
			       TIM.TRANING_DATE, 
			       TIM.TIME_ID, 
			       COUNT(*)OVER(PARTITION BY WEE.WEEK_ID) AS ROWSPAN_CNT,
       			   ROW_NUMBER() OVER(PARTITION BY WEE.WEEK_ID ORDER BY TIM.TIME_ID) AS ROW_NUM,
			       TO_CHAR(TO_DATE(TIM.TRANING_DATE,'YYYY.MM.DD'), 'dy', 'NLS_DATE_LANGUAGE=korean') DAY_WEEK,
				   
				   TIM.TRANING_ST_HOUR ||':'|| TIM.TRANING_ST_MIN as TRANING_ST,
				   TIM.TRANING_ED_HOUR ||':'|| TIM.TRANING_ED_MIN as TRANING_ED,
				   
				  <!--  MOD(TIM.TRANING_ED_HOUR,TIM.TRANING_ST_HOUR ) AS TIME_HOUR, -->
				  
				  (SELECT COUNT(*) 
			         FROM LMS_LESSON LES  
			        WHERE WEE.YYYY = LES.YYYY 
			              AND WEE.TERM = LES.TERM 
			              AND WEE.SUBJECT_CODE = LES.SUBJECT_CODE 
			              AND WEE.CLASS = LES.CLASS 
			              AND LES.DELETE_YN = 'N' 
			              AND LES.LEC_STATUS = 'A' 
			       ) LESSON_CNT,
				  
				  (SELECT NVL(MAX(TO_NUMBER(WEEK.WEEK_CNT)),'1') AS WEEK_CNT 
			         FROM LMS_SUBJ_WEEK WEEK  
			            LEFT JOIN LMS_SUBJ_WEEK_TIME WEET 
			                 ON WEET.DELETE_YN = 'N' 
              				AND WEET.WEEK_ID = WEEK.WEEK_ID  
			        WHERE WEEK.SUBJECT_CODE = WEE.SUBJECT_CODE 
			              AND WEEK.DELETE_YN ='N' 
			              AND WEEK.YYYY= WEE.YYYY 
			              AND WEEK.TERM = WEE.TERM 
			              AND WEEK.SUBJECT_CODE= WEE.SUBJECT_CODE 
			              AND WEEK.CLASS = WEE.CLASS   
			              <![CDATA[
			              AND WEET.TRANING_DATE <= TO_CHAR(SYSDATE,'YYYY.MM.DD')  
			              ]]>
			       ) NOW_WEEK_CNT ,
				  
				  (SELECT COUNT(1)
			         FROM LMS_TRANING_NOTE_MASTER NOM 
			        WHERE NOM.DELETE_YN = 'N' 
			              AND NOM.YYYY = WEE.YYYY 
			              AND NOM.TERM = WEE.TERM 
			              AND NOM.SUBJECT_CODE = WEE.SUBJECT_CODE 
			              AND NOM.CLASS = WEE.CLASS 
			              AND NOM.WEEK_CNT = WEE.WEEK_CNT
			       ) AS TRA_NOTE_CNT,
			       
			       <!--  
			       (SELECT COUNT(1)
			         FROM LMS_ACTIVITY_NOTE ACT 
			        WHERE ACT.DELETE_YN = 'N' 
			              AND ACT.YYYY = WEE.YYYY 
			              AND ACT.TERM = WEE.TERM 
			              AND ACT.SUBJECT_CODE = WEE.SUBJECT_CODE 
			              AND ACT.CLASS = WEE.CLASS 
			              AND ACT.WEEK_CNT = WEE.WEEK_CNT
			              AND ACT.TIME_ID = TIM.TIME_ID
			       ) AS ACT_NOTE_CNT,
			       -->
			       (SELECT COUNT(1)
			         FROM LMS_ACTIVITY_NOTE ACT
			       INNER JOIN LMS_SUBJ_WEEK_TIME TME
			       ON TME.TIME_ID = ACT.TIME_ID
			       AND TME.DELETE_YN = 'N'
			        WHERE ACT.DELETE_YN = 'N'
			              AND ACT.YYYY = WEE.YYYY
			              AND ACT.TERM = WEE.TERM
			              AND ACT.SUBJECT_CODE = WEE.SUBJECT_CODE
			              AND ACT.CLASS = WEE.CLASS
			               AND ACT.WEEK_CNT = WEE.WEEK_CNT
			       ) AS ACT_NOTE_CNT,
				   
			       TIM.LEAD_TIME AS TIME_HOUR,
				   
				   MOD(TRIM(TIM.TRANING_ED_MIN), TRIM(TIM.TRANING_ST_MIN) ) AS TIME_MIN,
			       TIM.TRANING_ST_HOUR, 
			       TIM.TRANING_ST_MIN, 
			       TIM.TRANING_ED_HOUR, 
			       TIM.TRANING_ED_MIN , 
			       TIM.NCS_UNIT_NAME,
				   TIM.NCS_ELEM_NAME
			  FROM LMS_SUBJ_WEEK WEE 
			  
			     INNER JOIN LMS_SUBJ_TUT_MAPPING TUT 
			         ON WEE.YYYY = TUT.YYYY 
			       AND WEE.TERM = TUT.TERM 
			       AND WEE.SUBJECT_CODE = TUT.SUBJECT_CODE 
			       AND WEE.CLASS = TUT.CLASS 
			       AND TUT.DELETE_YN = 'N' 
			       AND TUT.MEM_SEQ = #{sessionMemSeq} 
			       
			     LEFT OUTER JOIN LMS_SUBJ_WEEK_TIME TIM 
			         ON WEE.WEEK_ID = TIM.WEEK_ID
				       AND WEE.YYYY = TIM.YYYY 
				       AND WEE.TERM = TIM.TERM 
				       AND WEE.SUBJECT_CODE = TIM.SUBJECT_CODE 
				       AND WEE.CLASS = TIM.CLASS 
			       AND TIM.DELETE_YN = 'N' 
			       
			      
			 WHERE WEE.DELETE_YN = 'N' 
			       AND WEE.YYYY = #{yyyy} 
			       AND WEE.TERM = #{term} 
			       AND WEE.SUBJECT_CODE = #{subjectCode} 
			       AND WEE.CLASS = #{subjectClass}  
			ORDER BY TO_NUMBER(WEE.WEEK_CNT), TIM.TIME_ID
	</select>
	
	
	<select id="listOnlineTraningWeekSchedule" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOnlineTraningWeekSchedule ====== */
			SELECT SUBJ_SCH_ID,
				       WEEK_ID,
				       YYYY,
				       TERM,
				       SUBJECT_CODE,
				       CLASS,
				       WEEK_CNT,
				       SUBJ_STEP,
				       SUBJ_TITLE, 
				       START_DATE,
				       END_DATE,
				       STUDY_TIME,
				       LINK_CONTENT_YN,
				       CMS_COURSE_CONTENT_ID,
				       CMS_LESSON_ID,
				       CMS_ID,
				       CONTENT_TYPE,
				       CONTENTS_DIR,
				       CONTENTS_IDX_FILE,
				       CONTENTS_REAL_FILE,
				       URL, 
				       DEVICE_TYPE_CODE,
				       ATCH_FILE_ID,
				       CASE 
				           WHEN DEVICE_TYPE_CODE = '1' 
				           THEN 'PC+M' 
				           WHEN DEVICE_TYPE_CODE = '2' 
				           THEN 'PC+M' 
				           WHEN DEVICE_TYPE_CODE = '3' 
				           THEN 'PC+M' 
				           WHEN DEVICE_TYPE_CODE = '4' 
				           THEN 'PC'
				           WHEN DEVICE_TYPE_CODE = '5' 
				           THEN '모바일'
				           ELSE '기타' 
				       END DEVICE_TYPE_CODE_NAME 
				  FROM LMS_SUBJ_WEEK_SCH 
				 WHERE DELETE_YN = 'N' 
				       AND WEEK_ID = #{weekId}  
				       ORDER BY SUBJ_SCH_ID 
	</select>
	
	<select id="listOnlineTraningWeekSch" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOnlineTraningWeekSch ====== */
			SELECT SUBJ_SCH_ID,
				       WEEK_ID,
				       YYYY,
				       TERM,
				       SUBJECT_CODE,
				       CLASS,
				       WEEK_CNT,
				       SUBJ_STEP,
				       SUBJ_TITLE, 
				       START_DATE,
				       END_DATE,
				       STUDY_TIME,
				       LINK_CONTENT_YN,
				       CMS_COURSE_CONTENT_ID,
				       CMS_LESSON_ID,
				       CMS_ID,
				       CONTENT_TYPE,
				       CONTENTS_DIR,
				       CONTENTS_IDX_FILE,
				       CONTENTS_REAL_FILE,
				       URL, 
				       DEVICE_TYPE_CODE,
				       ATCH_FILE_ID,
				       CASE 
				           WHEN DEVICE_TYPE_CODE = '1' 
				           THEN 'PC+M' 
				           WHEN DEVICE_TYPE_CODE = '2' 
				           THEN 'PC+M' 
				           WHEN DEVICE_TYPE_CODE = '3' 
				           THEN 'PC+M' 
				           WHEN DEVICE_TYPE_CODE = '4' 
				           THEN 'PC'
				           WHEN DEVICE_TYPE_CODE = '5' 
				           THEN '모바일'
				           ELSE '기타' 
				       END DEVICE_TYPE_CODE_NAME 
				  FROM LMS_SUBJ_WEEK_SCH 
				 WHERE DELETE_YN = 'N' 
				       AND WEEK_ID = #{weekId}  
				       AND SUBJ_SCH_ID = #{subjSchId}
				       ORDER BY SUBJ_SCH_ID 
	</select>
	
	
	
	
	<select id="listOnlineTraningWeekSchElem" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchElemVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchElemVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOnlineTraningWeekSchElem ====== */
			SELECT SCH.SUBJ_SCH_ID, 
				       SCH.SUBJ_TITLE , 
				       SCH.SUBJ_STEP, 
				       SCH.LINK_CONTENT_YN,
				       SCH.CONTENT_TYPE,
				       SCH.CONTENTS_DIR,
				       SCH.CONTENTS_IDX_FILE,
				       SCH.CONTENTS_REAL_FILE,URL,
				       SCH.DEVICE_TYPE_CODE,
				       ELE.ELEM_ID, 
				       ELE.DISPLAY_ORDER , 
				       ELE.TITLE, 
				       ELE.CONTENT_URL, 
				       ELE.WIDTH, 
				       ELE.HEIGHT, 
				       ELE.LESSSON_ID,
				       
				       ELE.LESSON_ITEM_ID as lesson_item_id,
				       ELE.LESSON_SUB_ITEM_ID as lesson_sub_item,
				       
				       ELE.LESSON_ITEM_ID as lessonItemId,
				       ELE.LESSON_SUB_ITEM_ID as lessonSubItemId,
				       
				       ELE.LEARNING_SECONDS
				  FROM LMS_SUBJ_WEEK_SCH SCH 
				   INNER JOIN LMS_SUBJ_WEEK_SCH_ELEM ELE 
				       ON ELE.SUBJ_SCH_ID = SCH.SUBJ_SCH_ID 
				 WHERE SCH.SUBJ_SCH_ID = #{subjSchId}
				ORDER BY ELE.ELEM_ID, 
				       ELE.DISPLAY_ORDER 
	</select>
	
	
	<select id="listOnlineTraningWeekScheduleElemLesson" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchElemVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchElemVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOnlineTraningWeekScheduleElem ====== */
			SELECT SCH.SUBJ_SCH_ID, 
				       SCH.SUBJ_TITLE , 
				       SCH.SUBJ_STEP, 
				       SCH.LINK_CONTENT_YN,
				       ELE.ELEM_ID, 
				       ELE.DISPLAY_ORDER, 
				       ELE.TITLE, 
				       ELE.CONTENT_URL, 
				       ELE.WIDTH, 
				       ELE.HEIGHT, 
				       ELE.LESSSON_ID,
				       ELE.LESSON_ITEM_ID,
				       ELE.LESSON_SUB_ITEM_ID,
				       ELE.LEARNING_SECONDS,
				       PRO.SCH_PROGRESS_RATE 
				  FROM LMS_SUBJ_WEEK_SCH SCH 
				   INNER JOIN LMS_SUBJ_WEEK_SCH_ELEM ELE 
				       ON ELE.SUBJ_SCH_ID = SCH.SUBJ_SCH_ID 
				   LEFT OUTER JOIN 
				       (SELECT 
				              CASE 
				                  WHEN OST.PROGRESS_ATTEND_TYPE_CODE = 'H' 
				                  THEN FLOOR((SUM(ATT.TIME_PROGRESS_RATIO)+SUM(PAGE_PROGRESS_RATIO)) / (200 * SCH.PAGE_COUNT) * 100) 
				                  WHEN OST.PROGRESS_ATTEND_TYPE_CODE = 'I' 
				                  THEN FLOOR(SUM(ATT.TIME_PROGRESS_RATIO) / (100 * SCH.PAGE_COUNT) * 100) 
				                  WHEN OST.PROGRESS_ATTEND_TYPE_CODE = 'P' 
				                  THEN FLOOR(SUM(ATT.PAGE_PROGRESS_RATIO) / (100 * SCH.PAGE_COUNT) * 100) 
				              END SCH_PROGRESS_RATE , 
				              ATT.SUBJ_SCH_ID 
				         FROM LMS_PROGRESS_ATTEND ATT 
				          INNER JOIN LMS_SUBJ_WEEK_SCH SCH 
				              ON SCH.WEEK_ID = ATT.WEEK_ID 
				              AND SCH.SUBJ_SCH_ID = ATT.SUBJ_SCH_ID 
				              AND SCH.DELETE_YN = 'N' 
				          INNER JOIN LMS_SUBJ_ON_STAND OST 
				              ON OST.YYYY = SCH.YYYY 
				              AND OST.TERM = SCH.TERM 
				              AND OST.SUBJECT_CODE = SCH.SUBJECT_CODE 
				              AND OST.CLASS = SCH.CLASS 
				              AND OST.DELETE_YN = 'N' 
				          INNER JOIN LMS_LESSON LES 
				              ON LES.YYYY = SCH.YYYY 
				              AND LES.TERM = SCH.TERM 
				              AND LES.SUBJECT_CODE = SCH.SUBJECT_CODE 
				              AND LES.CLASS = SCH.CLASS 
				              AND LES.DELETE_YN = 'N' 
				              AND LES.LESSON_ID = ATT.LESSON_ID 
				              AND LES.MEM_SEQ = #{sessionMemSeq}
				        WHERE ATT.WEEK_ID = #{weekId} 
				              AND ATT.SUBJ_SCH_ID = #{subjSchId}
				        GROUP BY LES.LESSON_ID, 
				              ATT.WEEK_ID, 
				              ATT.SUBJ_SCH_ID, 
				              SCH.PAGE_COUNT, 
				              PROGRESS_ATTEND_TYPE_CODE 
				       ) PRO 
				       ON PRO.SUBJ_SCH_ID = SCH.SUBJ_SCH_ID 
				 WHERE SCH.SUBJ_SCH_ID = #{subjSchId}
				ORDER BY ELE.ELEM_ID, 
				       ELE.DISPLAY_ORDER 
	</select>
	
	<select id="getOnlineTraningWeekProgressYn" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="String">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.getOnlineTraningWeekProgressYn ====== */
			 SELECT 
			 <![CDATA[
					   CASE WHEN TO_CHAR(SYSDATE,'YYYY.MM.DD') BETWEEN TO_CHAR(TO_DATE(CON.WEEK_ST_DATE,'YYYY.MM.DD'),'YYYY.MM.DD') AND TO_CHAR(TO_DATE(CON.WEEK_ED_DATE,'YYYY.MM.DD'),'YYYY.MM.DD')
				       THEN 'Y'
				       WHEN TO_CHAR(SYSDATE,'YYYY.MM.DD') > TO_CHAR(TO_DATE(CON.WEEK_ED_DATE,'YYYY.MM.DD'),'YYYY.MM.DD')
				       THEN 'N'
				       WHEN TO_CHAR(SYSDATE,'YYYY.MM.DD') < TO_CHAR(TO_DATE(CON.WEEK_ED_DATE,'YYYY.MM.DD'),'YYYY.MM.DD')
				       THEN 'N'
				       WHEN NVL(CON.WEEK_ED_DATE,'') = ''
				       THEN 'Y'
				       ELSE 'Y'
				       END WEEK_PROGRESS_YN
					    ]]>	
			 FROM LMS_SUBJ_WEEK_CONTENT CON
			 WHERE CON.WEEK_ID = #{weekId}
			 AND CON.DELETE_YN = 'N'		    
	</select>
	
	<select id="getOnlineTraningWeekScheduleProgressYn" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="String">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.getOnlineTraningWeekScheduleProgressYn ====== */
			 SELECT 
			 <![CDATA[
					   CASE WHEN TO_CHAR(SYSDATE,'YYYY.MM.DD') BETWEEN TO_CHAR(TO_DATE(SCH.START_DATE,'YYYY.MM.DD'),'YYYY.MM.DD') AND TO_CHAR(TO_DATE(SCH.END_DATE,'YYYY.MM.DD'),'YYYY.MM.DD')
				       THEN 'Y'
				       WHEN TO_CHAR(SYSDATE,'YYYY.MM.DD') > TO_CHAR(TO_DATE(SCH.END_DATE,'YYYY.MM.DD'),'YYYY.MM.DD')
				       THEN 'N'
				       WHEN TO_CHAR(SYSDATE,'YYYY.MM.DD') < TO_CHAR(TO_DATE(SCH.END_DATE,'YYYY.MM.DD'),'YYYY.MM.DD')
				       THEN 'N'
				       WHEN NVL(SCH.END_DATE,'') = ''
				       THEN 'Y'
				       ELSE 'Y'
				       END WEEK_PROGRESS_YN
					    ]]>	
			 FROM LMS_SUBJ_WEEK_SCH SCH
			 WHERE SCH.SUBJ_SCH_ID = #{subjSchId}
			 AND SCH.DELETE_YN = 'N'		    
	</select>
	
	
	<select id="listOnlineTraningWeekScheduleElem" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchElemVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOnlineTraningWeekScheduleElem ====== */
			SELECT ELEM_ID, 
				       WEEK_ID, 
				       SUBJ_SCH_ID, 
				       LESSSON_ID lessonId, 
				       LESSON_ITEM_ID lessonItemId, 
				       LESSON_SUB_ITEM_ID lessonSubItemId, 
				       LEARNING_SECONDS  requiredLearningTimeInSeconds,
				       CONTENT_URL,
			           WIDTH,
			           HEIGHT,
			           TITLE,
			           DISPLAY_ORDER
				  FROM LMS_SUBJ_WEEK_SCH_ELEM 
				 WHERE DELETE_YN = 'N' 
				       AND WEEK_ID = #{weekId}
				       AND SUBJ_SCH_ID = #{subjSchId}
				ORDER BY ELEM_ID  
	</select>
	
	<delete id="deleteOnlineTraningWeekScheduleElem" parameterType="String">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.deleteOnlineTraningWeekScheduleElem ====== */
			  DELETE FROM  LMS_SUBJ_WEEK_SCH_ELEM WHERE WEEK_ID = #{weekId}
	</delete>
	
	<insert id="insertOnlineTraningWeekScheduleElem" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchElemVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.insertOnlineTraningWeekScheduleElem ====== */
			  INSERT 
				  INTO LMS_SUBJ_WEEK_SCH_ELEM 
				       ( 
				       	 ELEM_ID,
				       	 WEEK_ID, 
				         SUBJ_SCH_ID, 
					     WEEK_CNT, 
					     SUBJ_STEP, 
					     LESSSON_ID, 
				         LESSON_ITEM_ID, 
				         LESSON_SUB_ITEM_ID, 
				         LEARNING_SECONDS,
				         CONTENT_URL,
				         WIDTH,
				         HEIGHT,
				         TITLE,
				         DISPLAY_ORDER,
				         INSERT_DATE,
				         INSERT_USER
				       ) 
				       VALUES 
				       (  
				         #{elemId}, 
				         #{weekId}, 
				         #{subjSchId}, 
				         #{weekCnt}, 
				         #{subjStep}, 
				         #{lesson_id}, 
				         #{lesson_item_id}, 
				         #{lesson_sub_item_id}, 
				         #{required_learning_time_in_seconds}, 
				         #{contentUrl}, 
				         #{width}, 
				         #{height}, 
				         #{title}, 
				         #{displayOrder}, 
				         SYSDATE, 
				         #{insertUser} 
				       )
	</insert>
	
	<select id="listOnlineTraningFile" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningWeekFileVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningWeekFileVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOnlineTraningFile ====== */
			select a.week_id,a.atch_file_id,b.org_file_name,b.file_sn from LMS_SUBJ_WEEK_FILE a
				inner join ATCH_FILE b
				on a.atch_file_id = b.atch_file_id
				where a.delete_yn = 'N'
				and a.week_id = #{weekId}
				order by a.atch_file_id 
	</select>
	
	<insert id="insertOnlineTraningFile" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningWeekFileVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.insertOnlineTraningFile ====== */
			  INSERT 
				  INTO LMS_SUBJ_WEEK_FILE 
				       ( 
				       	 ATCH_FILE_ID,WEEK_ID,
				         INSERT_USER,INSERT_DATE
				       ) 
				       VALUES 
				       (  
				         #{atchFileId},#{weekId}, 
				         #{sessionMemSeq},SYSDATE 
				       )
	</insert>
	
	<update id="updateOnlineTraningFile" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningWeekFileVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.updateOnlineTraningFile ====== */
			  UPDATE  LMS_SUBJ_WEEK_FILE SET DELETE_YN = 'Y' 
			  	WHERE ATCH_FILE_ID = #{atchFileId}
			  	AND WEEK_ID = #{weekId}	
	</update>
	
	<insert id="insertOnlineTraningWeekFile" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningWeekFileVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.insertOnlineTraningWeekFile ====== */
			  INSERT 
				  INTO LMS_SUBJ_WEEK_FILE 
				       ( 
				       	 WEEK_ID,
				       	 FILE_SAVE_PATH, 
				         SAVE_FILE_NAME, 
					     ORG_FILE_NAME, 
				         INSERT_DATE,
				         INSERT_USER
				       ) 
				       VALUES 
				       (  
				         #{weekId}, 
				         #{fileSavePath}, 
				         #{saveFileName}, 
				         #{orgFileName}, 
				         SYSDATE, 
				         #{sessionMemSeq} 
				       )
	</insert>
	
	<update id="deleteOnlineTraningWeekFile" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningWeekFileVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.deleteOnlineTraningWeekFile ====== */
			 UPDATE LMS_SUBJ_WEEK_FILE
			 SET DELETE_YN = 'N'
			 , UPDATE_DATE = SYSDATE
			 , UPDATE_USER = #{sessionMemSeq}
			 WHERE FILE_SEQ =  #{fileSeq}
			 AND WEEK_ID = #{weekId}
	</update>
	
	<select id="getOnlineTraningWeekFileSeq" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningWeekFileVO" resultType="String">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.getOnlineTraningWeekFileSeq ====== */
			  SELECT MAX(FILE_SEQ) FROM LMS_SUBJ_WEEK_FILE
			  WHERE DELETE_YN = 'N'
			   AND WEEK_ID = #{weekId}
	</select>
	
	<select id="listOnlineTraningWeekFile" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningWeekFileVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningWeekFileVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listOnlineTraningWeekFile ====== */
			  SELECT * FROM LMS_SUBJ_WEEK_FILE
			  WHERE DELETE_YN = 'N'
			   AND WEEK_ID = #{weekId}
	</select>
	
	
	<insert id="insertTermOnStand" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.insertTermOnStand ====== */
		INSERT 
			  INTO LMS_TERM_ON_STAND 
			       ( 
			         YYYY, 
			         TERM, 
			         ONLINE_TYPE,
			         START_DATE, 
			         END_DATE, 
			         WEEK_STUDY_TYPE, 
			         WEEK_STUDY, 
			         CUT_PROGRESS, 
			         ATTEND_PROGRESS, 
			         ATTEND_REFLECT_TYPE, 
			         ATTEND_NEXT_DAY, 
			         SCHEDULE_TIME, 
			         PROGRESS_ATTEND_TYPE_CODE, 
			         INSERT_DATE, 
			         INSERT_USER 
			       ) 
			       VALUES 
			       (  
			         #{yyyy}, 
			         #{term}, 
			         #{onlineType}, 
			         #{startDate}, 
			         #{endDate}, 
			         #{weekStudyType}, 
			         #{weekStudy}, 
			         #{cutProgress}, 
			         #{attendProgress}, 
			         #{attendReflectType}, 
			         #{attendNextDay}, 
			         #{scheduleTime}, 
			         #{progressAttendTypeCode}, 
			         SYSDATE, 
			         #{insertUser} 
			       )
	</insert>
	
	
	<delete id="deleteTermOnStand" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.deleteTermOnStand ====== */
		DELETE FROM LMS_TERM_ON_STAND   
			 WHERE DELETE_YN= 'N' 
			       AND YYYY = #{yyyy} 
			       AND TERM = #{term} 
			       AND ONLINE_TYPE = #{onlineType} 
	</delete>
	
	<select id="getTermOnStand" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.getTermOnStand ====== */
		SELECT STA.YYYY, 
			       STA.TERM, 
			       STA.ONLINE_TYPE, 
			       STA.START_DATE, 
			       STA.END_DATE, 
			       STA.WEEK_STUDY_TYPE, 
			       STA.WEEK_STUDY, 
			       STA.CUT_PROGRESS, 
			       STA.ATTEND_PROGRESS, 
			       STA.ATTEND_REFLECT_TYPE, 
			       STA.ATTEND_NEXT_DAY, 
			       STA.SCHEDULE_TIME, 
			       STA.PROGRESS_ATTEND_TYPE_CODE, 
			       STA.INSERT_DATE, 
			       STA.INSERT_USER
			  FROM LMS_TERM_ON_STAND STA 
			 WHERE STA.DELETE_YN = 'N' 
			       AND STA.YYYY = #{yyyy}
			       AND STA.TERM = #{term}
			       AND STA.ONLINE_TYPE = #{onlineType} 
	</select>
	
	
	<insert id="insertTermOnWeek" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningWeekVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.insertTermOnWeek ====== */
		INSERT 
			  INTO LMS_TERM_ON_WEEK
			       (
			  		 YYYY,
			  		 TERM,
			  		 ONLINE_TYPE,
			         WEEK_CNT, 
			         WEEK_ST_DATE,
			         WEEK_ED_DATE,
			         INSERT_DATE,
			         INSERT_USER
			       ) 
			       VALUES
			       (
			       	 #{yyyy}, 
			       	 #{term}, 
			       	 #{onlineType}, 
			      	 #{weekCnt}, 
			         #{weekStDate},
			         #{weekEdDate},
			         SYSDATE,
			         #{sessionMemSeq}
			       )
	</insert>
	
	<delete id="deleteTermOnWeek" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningWeekVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.deleteTermOnWeek ====== */
		DELETE FROM LMS_TERM_ON_WEEK 
			WHERE YYYY = #{yyyy} 
		 		AND TERM = #{term} 
			    AND ONLINE_TYPE = #{onlineType}
			    AND DELETE_YN = 'N'
	</delete>
	
	<select id="listTermOnWeek" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningWeekVO" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningWeekVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listTermOnWeek ====== */
			  SELECT * FROM LMS_TERM_ON_WEEK
			  WHERE YYYY = #{yyyy} 
		 		AND TERM = #{term} 
			    AND ONLINE_TYPE = #{onlineType}
			    AND DELETE_YN = 'N'
	</select>
	
	
	<select id="listContentUrl" resultType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchElemVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.listContentUrl ====== */
		SELECT 
		lessson_id as lesson_id ,lesson_item_id as lesson_item_id,lesson_sub_item_id as lesson_sub_item_id
			
		 FROM LMS_SUBJ_WEEK_SCH_ELEM 
		 
		  GROUP BY LESSSON_ID,LESSON_ITEM_ID,LESSON_SUB_ITEM_ID
	</select>
	
	<update id="updateContentUrl" parameterType="kr.co.gocle.oklms.lu.online.vo.OnlineTraningSchElemVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.OnlineTraningMapper.updateContentUrl ====== */
		UPDATE LMS_SUBJ_WEEK_SCH_ELEM 
			SET 
			DISPLAY_ORDER = #{displayOrder},
			TITLE = #{title},
			CONTENT_URL = #{contentUrl},
			WIDTH = #{width},
			HEIGHT = #{height}
		WHERE LESSSON_ID = #{lessonId}
			AND LESSON_ITEM_ID = #{lessonItemId}
			AND LESSON_SUB_ITEM_ID = #{lessonSubItemId}
	</update>

</mapper>
