<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
  ~ *******************************************************************************
  ~  * COPYRIGHT(C) 2016 SMART INFORMATION TECHNOLOGY. ALL RIGHTS RESERVED.
  ~  * This software is the proprietary information of SMART INFORMATION TECHNOLOGY..
  ~  *
  ~  * Revision History
  ~  * Author   Date            Description
  ~  * ======   =========      ====================================
  ~  * 이진근    2017. 02. 17          First Draft.
  ~  *
  ~  *******************************************************************************
  -->

<mapper namespace="kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper">

	<sql id="list-where">
		<if test="searchKeyword != null and searchKeyword != ''">
			AND (TPS.TRANING_PROCESS_NAME LIKE '%' || #{searchKeyword  } || '%'  OR TPS.TRANING_PROCESS_NO LIKE  '%' || #{searchKeyword  } || '%'  )
	    </if>
	</sql>

	<select id="listTraningProcessManage" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningProcessManage ====== */
		<include refid="kr.co.gocle.include.paging-start"/>
			SELECT  TPS.TRANING_PROCESS_ID
					,TPS.TRANING_PROCESS_NAME
					,TPS.TRANING_PROCESS_NO
					,TPS.DELETE_YN AS deleteYn
					,TPS.INSERT_DATE AS insertDate
					,TPS.INSERT_USER AS insertUser
					,TPS.UPDATE_DATE AS updateDate
					,TPS.UPDATE_USER AS updateUser
				 FROM lms_traning_process_search TPS
			 	WHERE 1=1
			 	AND TPS.DELETE_YN = 'N'
			 	<include refid="list-where"/>
			ORDER BY TPS.TRANING_PROCESS_ID ASC
			<include refid="kr.co.gocle.include.paging-end"/>
	</select>

	<select id="listOffJtSubjectInfo" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listOjtSubjectInfo ====== */
			select
				 tpm.TRANING_PROCESS_MAPPING_ID as traningProcessMappingId,
			     tpm.COMPANY_ID as companyId,
			     tpm.TRANING_PROCESS_ID as traningProcessId,
			     tpm.YYYY as yyyy,
			     tpm.TERM as term,
			     tpm.SUBJECT_CODE as subjectCode,
			     tpm.CLASS as subClass,
			     sub.SUBJECT_NAME as subjectName
			from lms_traning_process_mapping tpm,
			     lms_subject sub
			where 1 = 1
			and tpm.YYYY = sub.YYYY
			and tpm.TERM = sub.TERM
			and tpm.SUBJECT_CODE = sub.SUBJECT_CODE
			and tpm.CLASS = sub.CLASS
			and tpm.COMPANY_ID = #{companyId}
			and tpm.TRANING_PROCESS_ID = #{traningProcessId}
			and tpm.DELETE_YN = 'N'
			and sub.SUBJECT_TRANING_TYPE = 'OFF'
	</select>

	<select id="listOjtSubjectInfo" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listOjtSubjectInfo ====== */
			select
				 tpm.TRANING_PROCESS_MAPPING_ID as traningProcessMappingId,
			     tpm.COMPANY_ID as companyId,
			     tpm.TRANING_PROCESS_ID as traningProcessId,
			     tpm.YYYY as yyyy,
			     tpm.TERM as term,
			     tpm.SUBJECT_CODE as subjectCode,
			     tpm.CLASS as subClass,
			     sub.SUBJECT_NAME as subjectName
			from lms_traning_process_mapping tpm,
			     lms_subject sub
			where 1 = 1
			and tpm.YYYY = sub.YYYY
			and tpm.TERM = sub.TERM
			and tpm.SUBJECT_CODE = sub.SUBJECT_CODE
			and tpm.CLASS = sub.CLASS
			and tpm.COMPANY_ID = #{companyId}
			and tpm.TRANING_PROCESS_ID = #{traningProcessId}
			and tpm.DELETE_YN = 'N'
			and sub.SUBJECT_TRANING_TYPE = 'OJT'
	</select>

	<select id="listTraningProcessInfo" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningProcessInfo ====== */
			select
			     tp.COMPANY_ID as companyId,
			     tp.TRANING_PROCESS_ID as traningProcessId,
				 tp.HRD_TRANING_NO as hrdTraningNo,
				 tp.HRD_TRANING_NAME as hrdTraningName
			from lms_traning_process tp
			where 1 = 1
			and tp.COMPANY_ID = #{companyId}
			<if test="traningProcessId != null and traningProcessId != ''">
				and tp.TRANING_PROCESS_ID = #{traningProcessId}
			</if>
			and tp.DELETE_YN = 'N'
	</select>
	
	<select id="getTraningProcessInfo" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningProcessInfo ====== */
			select
			     *
			from lms_traning_process 
			WHERE TRANING_PROCESS_MANAGE_ID = #{traningProcessManageId}
	</select>

	<select id="listTraningProcess" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningProcess ====== */
			select
			     tp.COMPANY_ID as companyId,
			     tp.TRANING_PROCESS_ID as traningProcessId,
			     tp.TRANING_PROCESS_MANAGE_ID as traningProcessManageId,
				 tp.HRD_TRANING_NO as hrdTraningNo,
				 tp.HRD_TRANING_NAME as hrdTraningName,
				 ps.TRANING_PROCESS_PERIOD as traningProcessPeriod
			from lms_traning_process tp
			inner join LMS_TRANING_PROCESS_SEARCH ps
			on ps.TRANING_PROCESS_ID = tp.TRANING_PROCESS_ID
			where 1 = 1
			and tp.COMPANY_ID = #{companyId}
			and tp.DELETE_YN = 'N'
	</select>

	<select id="listTraningScheduleExcelDownload" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningScheduleExcelDownload ====== */
			select a.COMPANY_ID,
			       a.TRANING_PROCESS_ID,
			       FN_GETCOMPAYNAME(a.COMPANY_ID) company_name,
			       FN_GETTRANING_PROCESS_NAME(a.TRANING_PROCESS_ID) HRD_TRANING_NAME,
			       a.YYYY,
			       a.TERM,
			       a.SUBJECT_CODE,
			       a.CLASS as subClass,
			       c.SUBJECT_NAME,
			       e.mem_seq,
			       e.mem_id,
			       e.mem_name,
			       e.mem_type
			  from lms_traning_process_mapping a
			  inner join lms_subject c
			  on c.YYYY = a.YYYY
			  and c.TERM = a.TERM
			  and c.SUBJECT_CODE = a.SUBJECT_CODE
			  and c.CLASS = a.CLASS
			  and c.SUBJECT_TRANING_TYPE = 'OJT'
			  and c.DELETE_YN = 'N'
			  left outer join lms_subj_tut_mapping d
			  on d.YYYY = c.YYYY
			  and d.TERM = c.TERM
			  and d.SUBJECT_CODE = c.SUBJECT_CODE
			  and d.CLASS = c.CLASS
			  and d.DELETE_YN = 'N'
			  left outer join com_member e
			  on e.mem_seq = d.mem_seq
			  where 1 = 1
			  and a.DELETE_YN = 'N'
			  and a.COMPANY_ID = #{companyId}
			  and a.TRANING_PROCESS_ID = #{traningProcessId}
			  and a.yyyy = #{yyyy}
			  and a.TERM = #{term}
			  and a.CLASS = #{subClass}
			  and a.SUBJECT_CODE = #{subjectCode}
	</select>

	<select id="listTraningScheduleView" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningScheduleView ====== */
			select
			    tsw.WEEK_CNT,
			    tswt.TRANING_DATE,
			    tswt.TRANING_ST_HOUR,
			    tswt.TRANING_ST_MIN,
			    tswt.TRANING_ED_HOUR,
			    tswt.TRANING_ED_MIN,
			    tswt.NCS_UNIT_NAME,
			    tswt.NCS_ELEM_NAME,
			    tswt.LEAD_TIME,
			    FN_GETSUBJECT_NAME(tswt.YYYY, tswt.TERM, tswt.SUBJECT_CODE, tswt.CLASS) SUBJECT_NAME,
			    (SELECT FN_GETUSERNAME(tut.MEM_SEQ)
		         FROM lms_subj_tut_mapping tut
		        WHERE 1 = 1
		              AND tut.YYYY = tswt.YYYY
		              AND tut.TERM = tswt.TERM
		              AND tut.SUBJECT_CODE = tswt.SUBJECT_CODE
		              AND tut.CLASS = tswt.CLASS
		              AND ROWNUM = 1
		     	ORDER BY UPDATE_DATE desc 
		       ) MEM_NAME,
			    tsw.TRAIN_PLACE,
			    TO_CHAR(TO_DATE(tswt.TRANING_DATE,'YYYY.MM.DD'), 'dy', 'NLS_DATE_LANGUAGE=korean') AS DAY_OF_WEEK
			from lms_traning_subj_week_time_sch tswt
			LEFT OUTER JOIN lms_traning_subj_week_sch tsw
			ON tsw.WEEK_ID = tswt.WEEK_ID
			AND tsw.YYYY = tswt.YYYY
			AND tsw.TERM = tswt.TERM
			AND tsw.SUBJECT_CODE = tswt.SUBJECT_CODE
			AND tsw.CLASS = tswt.CLASS
			AND tsw.DELETE_YN='N'
			WHERE 1 = 1
			AND tswt.YYYY = #{yyyy}
			AND tswt.TERM = #{term}
			AND tswt.SUBJECT_CODE = #{subjectCode}
			AND tswt.CLASS = #{subClass}
			AND tswt.DELETE_YN = 'N'
	</select>

	<select id="listTraningScheduleModifyView" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningScheduleModifyView ====== */
			select aa.INSERT_DATE,
			       aa.MEM_NAME,
			       aa.ATCH_FILE_ID,
			       FN_GETFILENAME(aa.ATCH_FILE_ID) as orgFileName,
			       aa.RETUN_REASON,
			       aa.STATUS,
			       aa.IP_ADDRESS
			from(
			select
				TO_CHAR (tsw.INSERT_DATE, 'YYYY.MM.DD') as INSERT_DATE,
			    FN_GETUSERNAME(tsw.INSERT_USER) MEM_NAME,
			    tsw.ATCH_FILE_ID,
			    '신규등록' as RETUN_REASON,
			    tsw.STATUS,
			    tsw.IP_ADDRESS
			from lms_traning_subj_week_sch tsw
			WHERE 1 = 1
			AND tsw.YYYY = #{yyyy}
			AND tsw.TERM = #{term}
			AND tsw.SUBJECT_CODE = #{subjectCode}
			AND tsw.CLASS = #{subClass}
			AND tsw.WEEK_CNT = '1'
			AND (tsw.INSERT_DATE is not null AND tsw.UPDATE_DATE is null)
			AND tsw.DELETE_YN = 'N'
			union all
			select
				TO_CHAR (tsw.UPDATE_DATE, 'YYYY.MM.DD') as INSERT_DATE,
			    FN_GETUSERNAME(tsw.INSERT_USER) MEM_NAME,
			    tsw.ATCH_FILE_ID,
			    tsw.RETUN_REASON,
			    tsw.STATUS,
			    tsw.IP_ADDRESS
			from lms_traning_subj_week_sch tsw
			WHERE 1 = 1
			AND tsw.YYYY = #{yyyy}
			AND tsw.TERM = #{term}
			AND tsw.SUBJECT_CODE = #{subjectCode}
			AND tsw.CLASS = #{subClass}
			AND tsw.WEEK_CNT = '1'
			AND (tsw.INSERT_DATE is not null AND tsw.UPDATE_DATE is not null)
			AND tsw.DELETE_YN = 'N'
			)aa
			order by aa.INSERT_DATE desc
	</select>

	<select id="listTraningSubjWeek" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
	/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningSubjWeek ====== */
			select
				WEEK_ID,
				YYYY,
				TERM,
				SUBJECT_CODE,
				CLASS,
			    WEEK_CNT
			from LMS_TRANING_SUBJ_WEEK_SCH
			WHERE 1 = 1
			AND YYYY = #{searchYyyy}
			AND TERM = #{searchTerm}
			AND SUBJECT_CODE = #{searchSubjectCode}
			AND CLASS = #{searchSubClass}
			AND DELETE_YN = 'N'
			ORDER BY WEEK_ID ASC
	</select>

	<select id="listTraningSubjWeekTime" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
	/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningSubjWeekTime ====== */
			select
				WEEK_ID,
				TIME_ID,
				YYYY,
				TERM,
				SUBJECT_CODE,
				CLASS,
				TRANING_DATE,
				TRANING_ST_HOUR,
				TRANING_ST_MIN,
				TRANING_ED_HOUR,
				TRANING_ED_MIN,
				NCS_UNIT_NAME,
				NCS_ELEM_NAME,
				LEAD_TIME
			from lms_traning_subj_week_time_sch
			WHERE 1 = 1
			AND WEEK_ID = #{oldWeekId}
			AND YYYY = #{searchYyyy}
			AND TERM = #{searchTerm}
			AND SUBJECT_CODE = #{searchSubjectCode}
			AND CLASS = #{searchSubClass}
			AND DELETE_YN = 'N'
			ORDER BY WEEK_ID ASC
	</select>

	<select id="listTraningSubjNcsUnit" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
	/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningSubjNcsUnit ====== */
			select
				WEEK_ID,
				NCS_UNIT_ID,
				YYYY,
				TERM,
				SUBJECT_CODE,
				CLASS,
				NCS_UNIT_NAME
			from lms_traning_subj_ncs_unit_sch
			WHERE 1 = 1
			AND WEEK_ID = #{oldWeekId}
			AND DELETE_YN = 'N'
			ORDER BY WEEK_ID ASC
	</select>

	<select id="listTraningSubjNcsElem" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
	/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningSubjNcsElem ====== */
			select
				WEEK_ID,
				NCS_UNIT_ID,
				NCS_ELEM_ID,
				YYYY,
				TERM,
				SUBJECT_CODE,
				CLASS,
				NCS_ELEM_NAME
			from lms_traning_subj_ncs_elem_sch
			WHERE 1 = 1
			AND WEEK_ID = #{oldWeekId}
			AND NCS_UNIT_ID = #{oldNcsUnitId}
			AND DELETE_YN = 'N'
			ORDER BY WEEK_ID ASC
	</select>

	<select id="getOffJtSubjectInfo" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO">
	/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getOffJtSubjectInfo ====== */
			select
				 tpm.TRANING_PROCESS_MAPPING_ID as traningProcessMappingId,
			     tpm.COMPANY_ID as companyId,
			     FN_GETCOMPAYNAME(tpm.company_id) as companyName,
			     tpm.TRANING_PROCESS_ID as traningProcessId,
			     tpm.YYYY as yyyy,
			     tpm.TERM as term,
			     tpm.SUBJECT_CODE as subjectCode,
			     tpm.CLASS as subClass,
			     sub.SUBJECT_NAME as subjectName,
			     FN_GETTRANING_PROCESS_NO(tpm.TRANING_PROCESS_ID) as hrdTraningNo,
                 FN_GETTRANING_PROCESS_NAME(tpm.TRANING_PROCESS_ID) as hrdTraningName
			from lms_traning_process_mapping tpm,
			     lms_subject sub
			where 1 = 1
			and tpm.YYYY = sub.YYYY
			and tpm.TERM = sub.TERM
			and tpm.SUBJECT_CODE = sub.SUBJECT_CODE
			and tpm.CLASS = sub.CLASS
			and tpm.COMPANY_ID = #{companyId}
			and tpm.TRANING_PROCESS_ID = #{traningProcessId}
			and tpm.DELETE_YN = 'N'
			and sub.SUBJECT_TRANING_TYPE = 'OFF'
			AND ROWNUM = 1
	</select>

	<select id="getTraningSubjWeekInfo" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
	/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningSubjWeekInfo ====== */
			<!-- select
				WEEK_ID,
				YYYY,
				TERM,
				SUBJECT_CODE,
				CLASS,
			    WEEK_CNT,
			    SUBJCT_TITLE,
			    ATCH_FILE_ID,
			    DELETE_YN,
			    STATUS,
			    CHANGE_STATUS,
			    RETUN_REASON,
				CHANGE_REASON,
			    INSERT_DATE,
				INSERT_USER,
				UPDATE_DATE,
				UPDATE_USER,
				FN_GETUSERNAME(UPDATE_USER) AS MEM_NAME
			from LMS_TRANING_SUBJ_WEEK_SCH
			WHERE 1 = 1
			AND YYYY = #{searchYyyy}
			AND TERM = #{searchTerm}
			AND SUBJECT_CODE = #{searchSubjectCode}
			AND CLASS = #{searchSubClass}
			AND WEEK_CNT = '1'
			AND DELETE_YN = 'N' 
			1주차가 없을경우가 있어 주석처리 후 쿼리수정 2018.10.16
			-->
			
			select
				WEEK_ID,
				YYYY,
				TERM,
				SUBJECT_CODE,
				CLASS,
			    WEEK_CNT,
			    SUBJCT_TITLE,
			    ATCH_FILE_ID,
			    DELETE_YN,
			    STATUS,
			    CHANGE_STATUS,
			    RETUN_REASON,
				CHANGE_REASON,
			    INSERT_DATE,
				INSERT_USER,
				UPDATE_DATE,
				UPDATE_USER,
				FN_GETUSERNAME(UPDATE_USER) AS MEM_NAME
			from LMS_TRANING_SUBJ_WEEK_SCH
			WHERE 1 = 1
			AND YYYY = #{searchYyyy}
			AND TERM = #{searchTerm}
			AND SUBJECT_CODE = #{searchSubjectCode}
			AND CLASS = #{searchSubClass}
			<!-- AND WEEK_CNT = '1' -->
			AND DELETE_YN = 'N'
			AND ROWNUM = 1
			ORDER BY WEEK_ID
	</select>

	<select id="getTraningSubjWeekTimeSum" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
	/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningSubjWeekTimeSum ====== */
			select
				SUM(LEAD_TIME) LEAD_TIME_SUM
			from lms_traning_subj_week_time_sch
			WHERE 1 = 1
			AND YYYY = #{yyyy}
			AND TERM = #{term}
			AND SUBJECT_CODE = #{subjectCode}
			AND CLASS = #{subClass}
			AND DELETE_YN = 'N'
	</select>

	<select id="getTdOffJtTotalCnt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningVO" resultType="java.lang.Integer">
	    /* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTdOffJtTotalCnt ====== */
	        select
				 count(1) as tdOjtTotalCnt
			from lms_traning_process_mapping tpm,
			     lms_subject sub
			where 1 = 1
			and tpm.YYYY = sub.YYYY
			and tpm.TERM = sub.TERM
			and tpm.SUBJECT_CODE = sub.SUBJECT_CODE
			and tpm.CLASS = sub.CLASS
			and tpm.COMPANY_ID = #{companyId}
			and tpm.TRANING_PROCESS_ID = #{traningProcessId}
			and tpm.DELETE_YN = 'N'
			and sub.SUBJECT_TRANING_TYPE = 'OFF'

	</select>
	
	<update id="saveTraningProcessManage" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningVO">
	    /* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.saveTraningProcessManage ====== */
	       UPDATE LMS_TRANING_PROCESS
	       		   SET OJT_CLASS = #{ojtClass} 
			       <!-- 
			       ,NOTE_MONTH = #{noteMonth}, 
			       ACT_MONTH = #{actMonth}, 
			       PROCESS_STATUS = #{processStatus}, 
			       OJT_MONTH_BIYONG = #{ojtMonthBiyong}, 
			       OFF_MONTH_BIYONG = #{offMonthBiyong}, 
			       CCN_MONTH = #{ccnMonth}, 
			       CCN_GRADE = #{ccnGrade}, 
			       CCN_BIGO = #{ccnBigo}
			        --> 
			 WHERE TRANING_PROCESS_MANAGE_ID = #{traningProcessManageId} 
			       AND DELETE_YN = 'N'

	</update>


	<select id="getTdOjtTotalCnt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningVO" resultType="java.lang.Integer">
	    /* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTdOjtTotalCnt ====== */
	        select
				 count(1) as tdOjtTotalCnt
			from lms_traning_process_mapping tpm,
			     lms_subject sub
			where 1 = 1
			and tpm.YYYY = sub.YYYY
			and tpm.TERM = sub.TERM
			and tpm.SUBJECT_CODE = sub.SUBJECT_CODE
			and tpm.CLASS = sub.CLASS
			and tpm.COMPANY_ID = #{companyId}
			and tpm.TRANING_PROCESS_ID = #{traningProcessId}
			and tpm.DELETE_YN = 'N'
			and sub.SUBJECT_TRANING_TYPE = 'OJT'

	</select>

	<select id="getTraningProcessCnt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO" resultType="java.lang.Integer">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningProcessCnt ====== */
			select
			     count(1) as cnt
			from lms_traning_process tp
			where 1 = 1
			and tp.COMPANY_ID = #{companyId}
			and tp.TRANING_PROCESS_ID = #{traningProcessId}
			and tp.DELETE_YN = 'N'
	</select>

	<select id="getTraningProcessMappingCnt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO" resultType="java.lang.Integer">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningProcessMappingCnt ====== */
			select
			     count(1) as cnt
			from lms_traning_process_mapping tp
			where 1 = 1
			and tp.COMPANY_ID = #{companyId}
			and tp.TRANING_PROCESS_ID = #{traningProcessId}
			and tp.YYYY = #{yyyy}
			and tp.TERM = #{term}
			and tp.SUBJECT_CODE = #{subjectCode}
			and tp.CLASS = #{subClass}
			and tp.DELETE_YN = 'N'
	</select>

	<insert id="insertTraningProcessInfoList" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.insertTraningProcessInfoList ====== */
		]]>
			INSERT INTO LMS_TRANING_PROCESS (
						 TRANING_PROCESS_MANAGE_ID
						,COMPANY_ID
						,TRANING_PROCESS_ID
						,HRD_TRANING_NO
						,HRD_TRANING_NAME
						,INSERT_DATE
						,INSERT_USER
					)
					VALUES
					(
						 #{traningProcessManageId}
						,#{companyId}
						,#{traningProcessId}
						,#{hrdTraningNo}
						,#{hrdTraningName}
						,SYSDATE
						,#{sessionMemSeq}
					)

	</insert>

	<insert id="insertTraningProcessMappingInfoList" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.insertTraningProcessMappingInfoList ====== */
		]]>
			INSERT INTO LMS_TRANING_PROCESS_MAPPING (
						COMPANY_ID
						,TRANING_PROCESS_ID
						,TRANING_PROCESS_MAPPING_ID
						,YYYY
						,TERM
						,SUBJECT_CODE
						,CLASS
						,INSERT_DATE
						,INSERT_USER
					)
					VALUES
					(
						 #{companyId}
						,#{traningProcessId}
						,#{traningProcessMappingId}
						,#{yyyy}
						,#{term}
						,#{subjectCode}
						,#{subClass}
						,SYSDATE
						,#{sessionMemSeq}
					)
	</insert>
	
		<insert id="insertTraningProcessMappingInfoListUpdate" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.insertTraningProcessMappingInfoList ====== */
		]]>
			INSERT INTO LMS_TRANING_PROCESS_MAPPING (
						COMPANY_ID
						,TRANING_PROCESS_ID
						,TRANING_PROCESS_MAPPING_ID
						,YYYY
						,TERM
						,SUBJECT_CODE
						,CLASS
						,INSERT_DATE
						,INSERT_USER
						,UPDATE_DATE
						,UPDATE_USER
					)
					VALUES
					(
						 #{companyId}
						,#{traningProcessId}
						,#{traningProcessMappingId}
						,#{yyyy}
						,#{term}
						,#{subjectCode}
						,#{subClass}
						,SYSDATE
						,#{sessionMemSeq}
						,SYSDATE
						,#{sessionMemSeq}
					)
	</insert>

	<select id="getSubjectTraningType" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO" resultType="String">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getSubjectTraningType ====== */
		]]>
		SELECT SUBJECT_TRANING_TYPE FROM LMS_SUBJECT
		WHERE YYYY = #{yyyy}
			AND TERM = #{term}
			AND SUBJECT_CODE =	#{subjectCode}
			AND CLASS = #{subClass}
	</select>

	<update id="updateMemberCompanyId" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.updateMemberCompanyId ====== */
		]]>
			UPDATE COM_MEMBER SET COMPANY_ID = #{companyId}
			WHERE MEM_SEQ IN (
				SELECT MEM_SEQ FROM LMS_LESSON
				WHERE YYYY = #{yyyy}
					AND TERM = #{term}
					AND SUBJECT_CODE =	#{subjectCode}
					AND CLASS = #{subClass}
			)
			<![CDATA[
			AND NVL(COMPANY_ID,'') <> ''
			]]>
	</update>

	<insert id="insertTraningSubjWeekSchExcel" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.insertTraningSubjWeekSchExcel ====== */
		]]>
			INSERT INTO LMS_TRANING_SUBJ_WEEK_SCH (
						WEEK_ID
						,YYYY
						,TERM
						,SUBJECT_CODE
						,CLASS
						,WEEK_CNT
						,SUBJCT_TITLE
						,TRAIN_PLACE
						,IP_ADDRESS
						,RETUN_REASON
						,ATCH_FILE_ID
						,INSERT_DATE
						,INSERT_USER
					)
					VALUES
					(
						 #{weekId}
						,#{yyyy}
						,#{term}
						,#{subjectCode}
						,#{subClass}
						,#{weekCnt}
						,#{subjctTitle}
						,#{trainPlace}
						,#{ipAddress}
						,#{retunReason}
						,#{atchFileId}
						,SYSDATE
						,#{sessionMemSeq}
					)
	</insert>

	<insert id="insertTraningSubjWeekTimeSchExcel" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.insertTraningSubjWeekTimeSchExcel ====== */
		]]>
			INSERT INTO LMS_TRANING_SUBJ_WEEK_TIME_SCH (
						WEEK_ID
						,TIME_ID
						,YYYY
						,TERM
						,SUBJECT_CODE
						,CLASS
						,TRANING_DATE
						,TRANING_ST_HOUR
						,TRANING_ST_MIN
						,TRANING_ED_HOUR
						,TRANING_ED_MIN
						,LEAD_TIME
						,NCS_UNIT_NAME
						,NCS_ELEM_NAME
						,INSERT_DATE
						,INSERT_USER
					)
					VALUES
					(
						 #{weekId}
						,#{timeId}
						,#{yyyy}
						,#{term}
						,#{subjectCode}
						,#{subClass}
						,#{traningDate}
						,#{traningStHour}
						,#{traningStMin}
						,#{traningEdHour}
						,#{traningEdMin}
						,#{leadTime}
						,#{ncsUnitName}
						,#{ncsElemName}
						,SYSDATE
						,#{sessionMemSeq}
					)
	</insert>

	<insert id="insertTraningSubjWeekNcsUnitSchExcel" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.insertTraningSubjWeekNcsUnitSchExcel ====== */
		]]>
			INSERT INTO LMS_TRANING_SUBJ_NCS_UNIT_SCH (
						 WEEK_ID
						,TIME_ID
						,NCS_UNIT_ID
						,YYYY
						,TERM
						,SUBJECT_CODE
						,CLASS
						,NCS_UNIT_NAME
						,INSERT_DATE
						,INSERT_USER
					)
					VALUES
					(
						 #{weekId}
						,#{timeId}
						,#{ncsUnitId}
						,#{yyyy}
						,#{term}
						,#{subjectCode}
						,#{subClass}
						,#{ncsUnitName}
						,SYSDATE
						,#{sessionMemSeq}
					)
	</insert>

	<insert id="insertTraningSubjWeekNcsElemSchExcel" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.insertTraningSubjWeekNcsElemSchExcel ====== */
		]]>
			INSERT INTO LMS_TRANING_SUBJ_NCS_ELEM_SCH (
						 WEEK_ID
						,TIME_ID
						,NCS_UNIT_ID
						,NCS_ELEM_ID
						,YYYY
						,TERM
						,SUBJECT_CODE
						,CLASS
						,NCS_ELEM_NAME
						,INSERT_DATE
						,INSERT_USER
					)
					VALUES
					(
						 #{weekId}
						,#{timeId}
						,#{ncsUnitId}
						,#{ncsElemId}
						,#{yyyy}
						,#{term}
						,#{subjectCode}
						,#{subClass}
						,#{ncsElemName}
						,SYSDATE
						,#{sessionMemSeq}
					)
	</insert>

	<insert id="insertSubjWeek" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.insertSubjWeek ====== */
		]]>
			INSERT INTO LMS_SUBJ_WEEK (
						WEEK_ID
						,YYYY
						,TERM
						,SUBJECT_CODE
						,CLASS
						,WEEK_CNT
						,INSERT_DATE
						,INSERT_USER
					)
					VALUES
					(
						 #{weekId}
						,#{yyyy}
						,#{term}
						,#{subjectCode}
						,#{subClass}
						,#{weekCnt}
						,SYSDATE
						,#{sessionMemSeq}
					)
	</insert>

	<insert id="insertSubjWeekTime" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.insertSubjWeekTime ====== */
		]]>
			INSERT INTO LMS_SUBJ_WEEK_TIME (
						WEEK_ID
						,TIME_ID
						,YYYY
						,TERM
						,SUBJECT_CODE
						,CLASS
						,TRANING_DATE
						,TRANING_ST_HOUR
						,TRANING_ST_MIN
						,TRANING_ED_HOUR
						,TRANING_ED_MIN
						,LEAD_TIME
						,NCS_UNIT_NAME
						,NCS_ELEM_NAME
						,INSERT_DATE
						,INSERT_USER
					)
					VALUES
					(
						 #{weekId}
						,#{timeId}
						,#{yyyy}
						,#{term}
						,#{subjectCode}
						,#{subClass}
						,#{traningDate}
						,#{traningStHour}
						,#{traningStMin}
						,#{traningEdHour}
						,#{traningEdMin}
						,#{leadTime}
						,#{ncsUnitName}
						,#{ncsElemName}
						,SYSDATE
						,#{sessionMemSeq}
					)
	</insert>
	
	<insert id="insertSubjWeekBatch" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.insertSubjWeekBatch ====== */
		]]>
			INSERT INTO LMS_SUBJ_WEEK (
						WEEK_ID
						,YYYY
						,TERM
						,SUBJECT_CODE
						,CLASS
						,WEEK_CNT
						,INSERT_DATE
						,INSERT_USER
					)
					VALUES
					(
						 #{newWeekId}
						,#{yyyy}
						,#{term}
						,#{subjectCode}
						,#{subClass}
						,#{weekCnt}
						,SYSDATE
						,#{sessionMemSeq}
					)
	</insert>

	<insert id="insertSubjWeekTimeBatch" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.insertSubjWeekTimeBatch ====== */
		]]>
			INSERT INTO LMS_SUBJ_WEEK_TIME (
						WEEK_ID
						,TIME_ID
						,YYYY
						,TERM
						,SUBJECT_CODE
						,CLASS
						,TRANING_DATE
						,TRANING_ST_HOUR
						,TRANING_ST_MIN
						,TRANING_ED_HOUR
						,TRANING_ED_MIN
						,LEAD_TIME
						,NCS_UNIT_NAME
						,NCS_ELEM_NAME
						,INSERT_DATE
						,INSERT_USER
					)
					VALUES
					(
						 #{newWeekId}
						,#{newTimeId}
						,#{yyyy}
						,#{term}
						,#{subjectCode}
						,#{subClass}
						,#{traningDate}
						,#{traningStHour}
						,#{traningStMin}
						,#{traningEdHour}
						,#{traningEdMin}
						,#{leadTime}
						,#{ncsUnitName}
						,#{ncsElemName}
						,SYSDATE
						,#{sessionMemSeq}
					)
	</insert>

	<insert id="insertSubjWeekNcsUnit" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.insertSubjWeekNcsUnit ====== */
		]]>
			INSERT INTO LMS_SUBJ_NCS_UNIT (
						WEEK_ID
						,NCS_UNIT_ID
						,YYYY
						,TERM
						,SUBJECT_CODE
						,CLASS
						,NCS_UNIT_NAME
						,INSERT_DATE
						,INSERT_USER
					)
					VALUES
					(
						 #{weekId}
						,#{ncsUnitId}
						,#{yyyy}
						,#{term}
						,#{subjectCode}
						,#{subClass}
						,#{ncsUnitName}
						,SYSDATE
						,#{sessionMemSeq}
					)
	</insert>

	<insert id="insertSubjWeekNcsElem" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.insertSubjWeekNcsElem ====== */
		]]>
			INSERT INTO LMS_TRANING_PROCESS_MAPPING (
						COMPANY_ID
						,TRANING_PROCESS_ID
						,TRANING_PROCESS_MAPPING_ID
						,YYYY
						,TERM
						,SUBJECT_CODE
						,CLASS
						,INSERT_DATE
						,INSERT_USER
            )
            VALUES
            (
                 #{companyId}
                ,#{traningProcessId}
                ,#{traningProcessMappingId}
                ,#{yyyy}
                ,#{term}
                ,#{subjectCode}
                ,#{subClass}
                ,SYSDATE
                ,#{sessionMemSeq}
            )
	</insert>

	<update id="updateTraningProcessMappingInfoList" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.updateTraningProcessMappingInfoList ====== */
			UPDATE LMS_TRANING_PROCESS_MAPPING
			SET UPDATE_DATE = SYSDATE
			   ,UPDATE_USER = #{sessionMemSeq}
			   ,YYYY = #{yyyy}
			   ,TERM = #{term}
			   ,SUBJECT_CODE = #{subjectCode}
			   ,CLASS = #{subClass}
			WHERE 1=1
			AND COMPANY_ID = #{companyId}
			AND TRANING_PROCESS_ID = #{traningProcessId}
			AND YYYY = #{yyyy}
			AND TERM = #{term}
			AND SUBJECT_CODE = #{subjectCode}
			AND CLASS = #{subClass}
	</update>

	<update id="updateTraningSubjWeekSchFileId" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.updateTraningSubjWeekSchFileId ====== */
			UPDATE LMS_TRANING_SUBJ_WEEK_SCH
			SET ATCH_FILE_ID = #{atchFileId}
			WHERE 1=1
			AND YYYY = #{yyyy}
			AND TERM = #{term}
			AND SUBJECT_CODE = #{subjectCode}
			AND CLASS = #{subClass}
	</update>

	<update id="updateTraningSubjWeekSchStatus" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.updateTraningSubjWeekSchStatus ====== */
			UPDATE LMS_TRANING_SUBJ_WEEK_SCH
			SET STATUS = '2'
			WHERE 1=1
			AND YYYY = #{yyyy}
			AND TERM = #{term}
			AND SUBJECT_CODE = #{subjectCode}
			AND CLASS = #{subClass}
	</update>

	<delete id="deleteTraningProcessInfoList" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.deleteTraningProcessInfoList ====== */
			UPDATE LMS_TRANING_PROCESS
			SET UPDATE_DATE = SYSDATE
			   ,UPDATE_USER = #{sessionMemSeq}
			   ,DELETE_YN = 'Y'
			WHERE 1=1
			AND COMPANY_ID = #{companyId}
			AND TRANING_PROCESS_ID = #{traningProcessId}

	</delete>

	<delete id="deleteTraningProcessMappingInfoList" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.deleteTraningProcessMappingInfoList ====== */
			UPDATE LMS_TRANING_PROCESS_MAPPING
			SET UPDATE_DATE = SYSDATE
			   ,UPDATE_USER = #{sessionMemSeq}
			   ,DELETE_YN = 'Y'
			WHERE 1=1
			AND COMPANY_ID = #{companyId}
			AND TRANING_PROCESS_ID = #{traningProcessId}

	</delete>
	
	<delete id="deleteTraningProcessMappingInfoSubjList" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningProcessMappingVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.deleteTraningProcessMappingInfoSubjList ====== */
			UPDATE LMS_TRANING_PROCESS_MAPPING
			SET UPDATE_DATE = SYSDATE
			   ,UPDATE_USER = #{sessionMemSeq}
			   ,DELETE_YN = 'Y'
			WHERE 1=1
			AND COMPANY_ID = #{companyId}
			AND TRANING_PROCESS_ID = #{traningProcessId}
			AND YYYY = #{yyyy}
			AND TERM = #{term}
			AND SUBJECT_CODE = #{subjectCode}
			AND CLASS = #{subClass}

	</delete>
	
	<select id="getTraningScheduleStatus" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="String">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningScheduleStatus ====== */
		]]>
			SELECT STATUS
			  FROM LMS_TRANING_SUBJ_WEEK_SCH 
			 WHERE DELETE_YN = 'N' 
			     AND YYYY = #{yyyy}
				 AND TERM = #{term}
				 AND SUBJECT_CODE = #{subjectCode}
				 AND CLASS = #{subClass}
			   GROUP BY YYYY,
			       TERM,
			       SUBJECT_CODE,
			       CLASS,
       			   STATUS
	</select>
	
	
	<select id="getTraningScheduleUseCnt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="java.lang.Integer">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningScheduleUseCnt ====== */
		]]>
			SELECT 
		       (SELECT COUNT(1) 
		         FROM LMS_ACTIVITY_NOTE 
		       WHERE DELETE_YN = 'N' 
				     AND YYYY = #{yyyy}
					 AND TERM = #{term}
					 AND SUBJECT_CODE = #{subjectCode}
					 AND CLASS = #{subClass}
		       ) + 
		       (SELECT COUNT(1) 
		         FROM LMS_TRANING_NOTE_MASTER 
		       WHERE DELETE_YN = 'N' 
				     AND YYYY = #{yyyy}
					 AND TERM = #{term}
					 AND SUBJECT_CODE = #{subjectCode}
					 AND CLASS = #{subClass} 
		       ) AS USE_CNT 
		  FROM DUAL
	</select>
	
	<update id="deletetTraningSchedule" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.deletetTraningSchedule ====== */
			UPDATE LMS_TRANING_SUBJ_WEEK_SCH
			SET UPDATE_DATE = SYSDATE
			   ,UPDATE_USER = #{sessionMemSeq}
			   ,DELETE_YN = 'Y'
			WHERE DELETE_YN = 'N' 
			     AND YYYY = #{yyyy}
				 AND TERM = #{term}
				 AND SUBJECT_CODE = #{subjectCode}
				 AND CLASS = #{subClass}
	</update>
	
	<update id="deletetTraningScheduleWeek" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.deletetTraningScheduleWeek ====== */
			UPDATE LMS_SUBJ_WEEK
			SET UPDATE_DATE = SYSDATE
			   ,UPDATE_USER = #{sessionMemSeq}
			   ,DELETE_YN = 'Y'
			WHERE DELETE_YN = 'N' 
			     AND YYYY = #{yyyy}
				 AND TERM = #{term}
				 AND SUBJECT_CODE = #{subjectCode}
				 AND CLASS = #{subClass}
	</update>
	
	<update id="deletetTraningWeekTimeSchedule" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.deletetTraningWeekTimeSchedule ====== */
			UPDATE LMS_TRANING_SUBJ_WEEK_TIME_SCH
			SET UPDATE_DATE = SYSDATE
			   ,UPDATE_USER = #{sessionMemSeq}
			   ,DELETE_YN = 'Y'
			WHERE DELETE_YN = 'N' 
			     AND YYYY = #{yyyy}
				 AND TERM = #{term}
				 AND SUBJECT_CODE = #{subjectCode}
				 AND CLASS = #{subClass}
	</update>
	
	<update id="deletetTraningScheduleWeekTime" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.deletetTraningScheduleWeekTime ====== */
			UPDATE LMS_SUBJ_WEEK_TIME
			SET UPDATE_DATE = SYSDATE
			   ,UPDATE_USER = #{sessionMemSeq}
			   ,DELETE_YN = 'Y'
			WHERE DELETE_YN = 'N' 
			     AND YYYY = #{yyyy}
				 AND TERM = #{term}
				 AND SUBJECT_CODE = #{subjectCode}
				 AND CLASS = #{subClass}
	</update>
	
	<select id="getTraningScheduleCnt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="java.lang.Integer">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningScheduleCnt ====== */
		]]>
			SELECT  
			       (SELECT COUNT(1) 
			         FROM LMS_SUBJ_WEEK WEEK 
			        WHERE WEEK.DELETE_YN = 'N' 
			              AND WEEK.YYYY = SUBJ.YYYY 
			              AND WEEK.TERM = SUBJ.TERM 
			              AND WEEK.SUBJECT_CODE = SUBJ.SUBJECT_CODE 
			              AND WEEK.CLASS = SUBJ.CLASS  
			       ) AS CNT  
			  FROM LMS_SUBJECT SUBJ 
			 WHERE SUBJ.DELETE_YN = 'N' 
			       AND SUBJ.YYYY = #{yyyy}
				   AND SUBJ.TERM = #{term}
			       AND SUBJ.SUBJECT_TRANING_TYPE = 'OJT'
	</select>
	
	<!-- <select id="getTraningSubjectScheduleCnt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="java.lang.Integer">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningSubjectScheduleCnt ====== */
		]]>
			SELECT  
			       (SELECT COUNT(1) 
			         FROM LMS_SUBJ_WEEK WEEK 
			        WHERE WEEK.DELETE_YN = 'N' 
			              AND WEEK.YYYY = SUBJ.YYYY 
			              AND WEEK.TERM = SUBJ.TERM 
			              AND WEEK.SUBJECT_CODE = SUBJ.SUBJECT_CODE 
			              AND WEEK.CLASS = SUBJ.CLASS  
			       ) AS CNT  
			  FROM LMS_SUBJECT SUBJ 
			 WHERE SUBJ.DELETE_YN = 'N' 
			       AND SUBJ.YYYY = #{yyyy}
				   AND SUBJ.TERM = #{term}
				   AND SUBJ.SUBJECT_CODE = #{subjectCode}
				   AND SUBJ.CLASS = #{subClass}
			       AND SUBJ.SUBJECT_TRANING_TYPE = 'OJT'
	</select> -->
	
	
	<select id="getTraningSubjectScheduleCnt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="java.lang.Integer">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningSubjectScheduleCnt ====== */
		]]>
			SELECT  
			       COUNT(1)
			  FROM LMS_TRANING_SUBJ_WEEK_SCH WEEK 
			 WHERE WEEK.DELETE_YN = 'N' 
			       AND WEEK.YYYY = #{yyyy}
				   AND WEEK.TERM = #{term}
				   AND WEEK.SUBJECT_CODE = #{subjectCode}
				   AND WEEK.CLASS = #{subClass}
				   AND WEEK.WEEK_CNT = #{weekCnt}
	</select>
	
	<select id="getTraningSubjectScheduleWeekId" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="String">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningSubjectScheduleCnt ====== */
		]]>
			SELECT  
			       MAX(WEEK.WEEK_ID)
			  FROM LMS_TRANING_SUBJ_WEEK_SCH WEEK 
			 WHERE WEEK.DELETE_YN = 'N' 
			       AND WEEK.YYYY = #{yyyy}
				   AND WEEK.TERM = #{term}
				   AND WEEK.SUBJECT_CODE = #{subjectCode}
				   AND WEEK.CLASS = #{subClass}
				   AND WEEK.WEEK_CNT = #{weekCnt}
	</select>
	
	<select id="getTraningSubjectWeekId" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="String">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningSubjectWeekId ====== */
		]]>
			SELECT  
			       MAX(WEEK.WEEK_ID)
			  FROM LMS_SUBJ_WEEK WEEK 
			 WHERE WEEK.DELETE_YN = 'N' 
			       AND WEEK.YYYY = #{yyyy}
				   AND WEEK.TERM = #{term}
				   AND WEEK.SUBJECT_CODE = #{subjectCode}
				   AND WEEK.CLASS = #{subClass}
				   AND WEEK.WEEK_CNT = #{weekCnt}
	</select>
	
	<select id="getTraningSubjectCnt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningScheduleVO" resultType="java.lang.Integer">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningSubjectCnt ====== */
		]]>
			SELECT  
			       COUNT(1)
			  FROM LMS_SUBJECT SUBJ
			 WHERE SUBJ.DELETE_YN = 'N' 
			       AND SUBJ.YYYY = #{yyyy}
				   AND SUBJ.TERM = #{term}
				   AND SUBJ.SUBJECT_CODE = #{subjectCode}
				   AND SUBJ.CLASS = #{subClass}
	</select>
	
	<select id="listTraningPrt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningPrt ====== */
			SELECT * FROM (
				SELECT C.TRANING_PROCESS_NAME , 
					       E.COMPANY_NAME, 
					       A.TRANING_PROCESS_MANAGE_ID, 
					       A.COMPANY_ID, 
					       C.TRANING_PROCESS_ID, 
					       A.PRT_GRADE,
					       A.PRT_BIGO,
					       A.CCN_GRADE,
					       A.CCN_BIGO,
					       C.START_DATE, 
					       C.END_DATE 
					  FROM LMS_TRANING_PROCESS A , 
					       LMS_TRANING_PROCESS_MAPPING B, 
					       LMS_TRANING_PROCESS_SEARCH C, 
					       LMS_SUBJ_INS_MAPPING D, 
					       LMS_COMPANY E 
					 WHERE 1 = 1 
					       AND A.COMPANY_ID = B.COMPANY_ID 
					       AND A.TRANING_PROCESS_ID = B.TRANING_PROCESS_ID 
					       AND A.DELETE_YN = 'N' 
					       AND B.DELETE_YN = 'N' 
					       AND C.TRANING_PROCESS_ID = A.TRANING_PROCESS_ID 
					       AND C.DELETE_YN = 'N' 
					       AND D.YYYY = B.YYYY 
					       AND D.TERM = B.TERM 
					       AND D.SUBJECT_CODE = B.SUBJECT_CODE 
					       AND D.CLASS = B.CLASS 
					       AND A.COMPANY_ID = E.COMPANY_ID 
					       AND D.MEM_SEQ = #{sessionMemSeq}
					       
					       <if test="yyyy != null and yyyy != ''"> AND D.YYYY = #{yyyy}</if>
					       <if test="term != null and term != ''"> AND D.TERM = #{term}</if>
					       <if test="subjectCode != null and subjectCode != ''"> AND D.SUBJECT_CODE = #{subjectCode}</if>
					       <if test="subClass != null and subClass != ''"> AND D.CLASS = #{subClass}</if>
					       
					 GROUP BY C.TRANING_PROCESS_NAME, 
					       E.COMPANY_NAME, 
					       A.TRANING_PROCESS_MANAGE_ID, 
					       A.COMPANY_ID, 
					       C.TRANING_PROCESS_ID, 
					       A.PRT_GRADE,
					       A.PRT_BIGO,
					       A.CCN_GRADE,
					       A.CCN_BIGO,
					       C.START_DATE, 
					       C.END_DATE 
					ORDER BY C.TRANING_PROCESS_ID DESC
				) AA
				WHERE 1=1
				
			<choose>
	            <when test="searchName != null and searchName != ''">
	                	<if test="searchName eq 'TRANING_PROCESS_NAME'">
	                		<if test="searchWord != null and searchWord != ''">
	                			AND AA.TRANING_PROCESS_NAME LIKE '%' || #{searchWord  } || '%'
	                		</if>
	                	</if>
	                	<if test="searchName eq 'COMPANY_NAME'">
	                		<if test="searchWord != null and searchWord != ''">
	                			AND AA.COMPANY_NAME LIKE '%' || #{searchWord  } || '%'
	                		</if>
	                	</if>
	            </when>
	            <otherwise>
	            	<if test="searchWord != null and searchWord != ''">
	            		AND (  AA.TRANING_PROCESS_NAME LIKE '%' || #{searchWord  } || '%' OR AA.COMPANY_NAME LIKE '%' || #{searchWord  } || '%' )
	            	</if>
	            </otherwise>
	        </choose>
				
	</select>
	
	<select id="listTraningCcn" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningCcn ====== */
			SELECT * FROM (
				SELECT C.TRANING_PROCESS_NAME , 
					       E.COMPANY_NAME, 
					       A.TRANING_PROCESS_MANAGE_ID, 
					       A.COMPANY_ID, 
					       C.TRANING_PROCESS_ID, 
					       A.CCN_GRADE,
					       A.CCN_BIGO,
					       A.PRT_GRADE,
					       A.PRT_BIGO,
					       C.START_DATE, 
					       C.END_DATE ,
					       C.YEAR
					  FROM LMS_TRANING_PROCESS A , 
					       LMS_TRANING_PROCESS_MAPPING B, 
					       LMS_TRANING_PROCESS_SEARCH C, 
					       LMS_COMPANY E 
					 WHERE 1 = 1 
					       AND A.COMPANY_ID = B.COMPANY_ID 
					       AND A.TRANING_PROCESS_ID = B.TRANING_PROCESS_ID 
					       AND A.DELETE_YN = 'N' 
					       AND B.DELETE_YN = 'N' 
					       AND C.TRANING_PROCESS_ID = A.TRANING_PROCESS_ID 
					       AND C.DELETE_YN = 'N' 
					       AND A.COMPANY_ID = E.COMPANY_ID 
						   
						   AND A.COMPANY_ID IN (
					       		SELECT CCN.COMPANY_ID 
					                FROM LMS_COMP_CCN_MAPPING CCN 
					               WHERE CCN.DELETE_YN = 'N' 
					                     AND CCN.MEM_SEQ = #{sessionMemSeq}
					       )	
												       
					       <if test="yyyy != null and yyyy != ''"> AND D.YYYY = #{yyyy}</if>
					       <if test="term != null and term != ''"> AND D.TERM = #{term}</if>
					       <if test="subjectCode != null and subjectCode != ''"> AND D.SUBJECT_CODE = #{subjectCode}</if>
					       <if test="subClass != null and subClass != ''"> AND D.CLASS = #{subClass}</if>
					       
					 GROUP BY C.TRANING_PROCESS_NAME, 
					       E.COMPANY_NAME, 
					       A.TRANING_PROCESS_MANAGE_ID, 
					       A.COMPANY_ID, 
					       C.TRANING_PROCESS_ID, 
					       A.CCN_GRADE,
					       A.CCN_BIGO,
					       A.PRT_GRADE,
					       A.PRT_BIGO,
					       C.START_DATE, 
					       C.END_DATE,
					       C.YEAR 
					ORDER BY C.TRANING_PROCESS_ID DESC
				) AA
				WHERE 1=1
				
			<choose>
	            <when test="searchName != null and searchName != ''">
	                	<if test="searchName eq 'TRANING_PROCESS_NAME'">
	                		<if test="searchWord != null and searchWord != ''">
	                			AND AA.TRANING_PROCESS_NAME LIKE '%' || #{searchWord  } || '%'
	                		</if>
	                	</if>
	                	<if test="searchName eq 'COMPANY_NAME'">
	                		<if test="searchWord != null and searchWord != ''">
	                			AND AA.COMPANY_NAME LIKE '%' || #{searchWord  } || '%'
	                		</if>
	                	</if>
	            </when>
	            <otherwise>
	            	<if test="searchWord != null and searchWord != ''">
	            		AND (  AA.TRANING_PROCESS_NAME LIKE '%' || #{searchWord  } || '%' OR AA.COMPANY_NAME LIKE '%' || #{searchWord  } || '%' )
	            	</if>
	            </otherwise>
	        </choose>
				
	</select>
	
	<select id="listTraningSubjectPrt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningSubjectPrt ====== */
			SELECT * FROM (
				SELECT C.TRANING_PROCESS_NAME , 
					       E.COMPANY_NAME, 
					       A.TRANING_PROCESS_MANAGE_ID, 
					       A.COMPANY_ID, 
					       C.TRANING_PROCESS_ID, 
					       A.PRT_GRADE,
					       A.PRT_BIGO,
					       C.START_DATE, 
					       C.END_DATE 
					  FROM LMS_TRANING_PROCESS A , 
					       LMS_TRANING_PROCESS_MAPPING B, 
					       LMS_TRANING_PROCESS_SEARCH C, 
					       LMS_SUBJ_INS_MAPPING D, 
					       LMS_COMPANY E 
					 WHERE 1 = 1 
					       AND A.COMPANY_ID = B.COMPANY_ID 
					       AND A.TRANING_PROCESS_ID = B.TRANING_PROCESS_ID 
					       AND A.DELETE_YN = 'N' 
					       AND B.DELETE_YN = 'N' 
					       AND C.TRANING_PROCESS_ID = A.TRANING_PROCESS_ID 
					       AND C.DELETE_YN = 'N' 
					       AND E.DELETE_YN = 'N' 
					       AND D.YYYY = B.YYYY 
					       AND D.TERM = B.TERM 
					       AND D.SUBJECT_CODE = B.SUBJECT_CODE 
					       AND D.CLASS = B.CLASS 
					       AND A.COMPANY_ID = E.COMPANY_ID 
					       AND D.MEM_SEQ = #{sessionMemSeq}
					       
					       AND D.YYYY = #{yyyy}
					       AND D.TERM = #{term}
					       AND D.SUBJECT_CODE = #{subjectCode}
					       AND D.CLASS = #{subClass}
					       
					 GROUP BY C.TRANING_PROCESS_NAME, 
					       E.COMPANY_NAME, 
					       A.TRANING_PROCESS_MANAGE_ID, 
					       A.COMPANY_ID, 
					       C.TRANING_PROCESS_ID, 
					       A.PRT_GRADE,
					       A.PRT_BIGO,
					       C.START_DATE, 
					       C.END_DATE 
					ORDER BY C.TRANING_PROCESS_ID DESC
				) AA
				WHERE 1=1
				
			<choose>
	            <when test="searchName != null and searchName != ''">
	                	<if test="searchName eq 'TRANING_PROCESS_NAME'">
	                		<if test="searchWord != null and searchWord != ''">
	                			AND AA.TRANING_PROCESS_NAME LIKE '%' || #{searchWord  } || '%'
	                		</if>
	                	</if>
	                	<if test="searchName eq 'COMPANY_NAME'">
	                		<if test="searchWord != null and searchWord != ''">
	                			AND AA.COMPANY_NAME LIKE '%' || #{searchWord  } || '%'
	                		</if>
	                	</if>
	            </when>
	            <otherwise>
	            	<if test="searchWord != null and searchWord != ''">
	            		AND (  AA.TRANING_PROCESS_NAME LIKE '%' || #{searchWord  } || '%' OR AA.COMPANY_NAME LIKE '%' || #{searchWord  } || '%' )
	            	</if>
	            </otherwise>
	        </choose>
				
	</select>
	
	<update id="updateTraningPrt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningVO">
	    /* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.updateTraningPrt ====== */
	       UPDATE LMS_TRANING_PROCESS
	       		   SET PRT_GRADE = #{prtGrade}, 
			       PRT_BIGO = #{prtBigo}
			 WHERE TRANING_PROCESS_MANAGE_ID = #{traningProcessManageId} 
	</update>
	
	<update id="updateTraningCcn" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningVO">
	    /* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.updateTraningCcn ====== */
	       UPDATE LMS_TRANING_PROCESS
	       		   SET CCN_GRADE = #{ccnGrade}, 
			       CCN_BIGO = #{ccnBigo}
			 WHERE TRANING_PROCESS_MANAGE_ID = #{traningProcessManageId} 
	</update>

</mapper>
