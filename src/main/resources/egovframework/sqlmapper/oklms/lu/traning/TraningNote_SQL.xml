<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
  ~ *******************************************************************************
  ~  * COPYRIGHT(C) 2016 SMART INFORMATION TECHNOLOGY. ALL RIGHTS RESERVED.
  ~  * This software is the proprietary information of SMART INFORMATION TECHNOLOGY..
  ~  *
  ~  * Revision History
  ~  * Author   Date            Description
  ~  * ======   =========      ====================================
  ~  * 
  ~  *
  ~  *******************************************************************************
  -->

<mapper namespace="kr.co.gocle.oklms.lu.traning.service.impl.TraningNoteMapper">
  
	<select id="getTraningNote" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningNote ====== */
		SELECT      
	       (
	       SELECT MIN(LSWT.TRANING_DATE)
	       FROM    LMS_SUBJ_WEEK_TIME LSWT
	       WHERE   LSWT.DELETE_YN    = 'N'
	       AND     SUBJ.YYYY         = LSWT.YYYY
	       AND     SUBJ.TERM         = LSWT.TERM
	       AND     SUBJ.SUBJECT_CODE = LSWT.SUBJECT_CODE
	       AND     SUBJ.CLASS        = LSWT.CLASS
	       )
	       AS TRANING_ST_DATE ,
	       (
	       SELECT MAX(LSWT.TRANING_DATE)
	       FROM    LMS_SUBJ_WEEK_TIME LSWT
	       WHERE   LSWT.DELETE_YN    = 'N'
	       AND     SUBJ.YYYY         = LSWT.YYYY
	       AND     SUBJ.TERM         = LSWT.TERM
	       AND     SUBJ.SUBJECT_CODE = LSWT.SUBJECT_CODE
	       AND     SUBJ.CLASS        = LSWT.CLASS
	       )
	       AS TRANING_END_DATE ,
	       (
		   SELECT  SUM(  SWT.LEAD_TIME )
	       FROM    LMS_SUBJ_WEEK_TIME SWT
	       WHERE    SWT.DELETE_YN    = 'N'
	       AND     SUBJ.YYYY         = SWT.YYYY
	       AND     SUBJ.TERM         = SWT.TERM
	       AND     SUBJ.SUBJECT_CODE = SWT.SUBJECT_CODE
	       AND     SUBJ.CLASS        = SWT.CLASS
	       AND     WEK.WEEK_ID       = SWT.WEEK_ID
			 ) AS TIME_HOUR,
	       
	       <!-- 
			CASE WHEN  SUBJ.SUBJECT_TRANING_TYPE = 'OJT'
			THEN 
			(
			SELECT GROUP_CONCAT(NCS_UNIT_NAME)
			FROM LMS_SUBJ_WEEK_TIME SWT
			 WHERE    SWT.DELETE_YN    = 'N'
		       AND     SUBJ.YYYY         = SWT.YYYY
		       AND     SUBJ.TERM         = SWT.TERM
		       AND     SUBJ.SUBJECT_CODE = SWT.SUBJECT_CODE
		       AND     SUBJ.CLASS        = SWT.CLASS
		       AND     WEK.WEEK_ID       = SWT.WEEK_ID
			)
			ELSE UNIT.NCS_UNIT_NAME
			END NCS_UNIT_NAME,
			
			CASE WHEN  SUBJ.SUBJECT_TRANING_TYPE = 'OJT'
			THEN 
			(
			SELECT GROUP_CONCAT(NCS_ELEM_NAME)
			FROM LMS_SUBJ_WEEK_TIME SWT
			 WHERE    SWT.DELETE_YN    = 'N'
		       AND     SUBJ.YYYY         = SWT.YYYY
		       AND     SUBJ.TERM         = SWT.TERM
		       AND     SUBJ.SUBJECT_CODE = SWT.SUBJECT_CODE
		       AND     SUBJ.CLASS        = SWT.CLASS
		       AND     WEK.WEEK_ID       = SWT.WEEK_ID
			)
			ELSE ELEM.NCS_ELEM_NAME
			END NCS_ELEM_NAME,  
			-->
			
			CASE WHEN  SUBJ.SUBJECT_TRANING_TYPE = 'OJT'
			THEN
                     (SELECT  LISTAGG(NCS_UNIT_NAME, ',') WITHIN GROUP (ORDER BY NCS_UNIT_NAME)
                     FROM     (SELECT DISTINCT NCS_UNIT_NAME,WEEK_ID
                              FROM             LMS_SUBJ_WEEK_TIME 
                              ) A
                     WHERE    WEEK_ID   = WEK.WEEK_ID
                     )
			ELSE UNIT.NCS_UNIT_NAME
			END NCS_UNIT_NAME,
			
			CASE WHEN  SUBJ.SUBJECT_TRANING_TYPE = 'OJT'
			THEN SWT.NCS_ELEM_NAME
			ELSE ELEM.NCS_ELEM_NAME
			END NCS_ELEM_NAME,  
	       
	       
	       CASE WHEN  SUBJ.NCS_YN = 'N'
			THEN
                     (
                     	SELECT LISTAGG(LRN.LESSON_CN, ',') WITHIN GROUP (ORDER BY LRN.LESSON_CN) 
							  FROM KUT_HAK.VH_OKLMS_TH_STUDY_LRN_CN LRN 
							 WHERE LRN.ESTBL_YY = WEK.YYYY 
							       AND DECODE(LRN.ESTBL_SEMSTR_CD,'101','1','102','2','103','3','4') = WEK.TERM 
							       AND LRN.COURSE_NO = WEK.SUBJECT_CODE 
							       AND LRN.PARTITN_CLAS_SE_CD = WEK.CLASS 
							       AND LRN.WEEK_NUM = WEK.WEEK_CNT 
							       AND ROWNUM <![CDATA[< 11 ]]>	
                     
                     )
			ELSE (
						
						NVL(
			                     	(SELECT LISTAGG(LRN.LESSON_CN, ',') WITHIN GROUP (ORDER BY LRN.LESSON_CN) 
										  FROM KUT_MOB2.VH_OKLMS_TH_STUDY_LRN_NCS LRN
										 WHERE LRN.ESTBL_YY = WEK.YYYY 
										       AND DECODE(LRN.ESTBL_SEMSTR_CD,'101','1','102','2','103','3','4') = WEK.TERM 
										       AND LRN.COURSE_NO = WEK.SUBJECT_CODE 
										       AND LRN.PARTITN_CLAS_SE_CD = WEK.CLASS 
										       AND LRN.WEEK_NUM = WEK.WEEK_CNT 
			                     			   AND ROWNUM <![CDATA[< 11 ]]>
			                     	),
		                     		(SELECT LISTAGG(LRN.LESSON_CN, ',') WITHIN GROUP (ORDER BY LRN.LESSON_CN) 
										  FROM TEMP_OKLMS_TH_STUDY_LRN_NCS LRN
										 WHERE LRN.ESTBL_YY = WEK.YYYY 
										       AND DECODE(LRN.ESTBL_SEMSTR_CD,'101','1','102','2','103','3','4') = WEK.TERM 
										       AND LRN.COURSE_NO = WEK.SUBJECT_CODE 
										       AND LRN.PARTITN_CLAS_SE_CD = WEK.CLASS 
										       AND LRN.WEEK_NUM = WEK.WEEK_CNT 
			                     			   AND ROWNUM <![CDATA[< 11 ]]>		
			                     	)		   	   
	                     		)
						
					)
			END LESSON_CN,
			
			
			(
                 	SELECT LISTAGG(LRN.LESSON_CN, ',') WITHIN GROUP (ORDER BY LRN.LESSON_CN) 
					  FROM KUT_HAK.VH_OKLMS_TH_STUDY_LRN_CN LRN 
					 WHERE LRN.ESTBL_YY = WEK.YYYY 
					       AND DECODE(LRN.ESTBL_SEMSTR_CD,'101','1','102','2','103','3','4') = WEK.TERM 
					       AND LRN.COURSE_NO = WEK.SUBJECT_CODE 
					       AND LRN.PARTITN_CLAS_SE_CD = WEK.CLASS 
					       AND LRN.WEEK_NUM = WEK.WEEK_CNT 
					       AND ROWNUM <![CDATA[< 11 ]]>	
            ) AS LESSON_CN_MST,
	         
	       <!-- (
	       
       			SELECT 
		              LRN.LESSON_CN AS LESSON_CN
		         FROM KUT_HAK.VH_OKLMS_TH_STUDY_LRN_CN LRN
		         WHERE LRN.ESTBL_YY = WEK.YYYY
			       AND DECODE(LRN.ESTBL_SEMSTR_CD,'101','1','102','2','103','3','4') = WEK.TERM
			       AND LRN.COURSE_NO = WEK.SUBJECT_CODE
			       AND LRN.PARTITN_CLAS_SE_CD = WEK.CLASS
			       AND LRN.WEEK_NUM = WEK.WEEK_CNT
			       AND ROWNUM = 1
	       
	       ) AS LESSON_CN, -->
	       
	       SUBJ.traning_hour ,
	       WEK.WEEK_ID ,
	       SUBJ.SUBJECT_NAME ,
	       SUBJ.CLASS AS CLASS_ID ,
	       SUBJ.YYYY,
	       SUBJ.SUBJECT_CODE ,
	       SUBJ.ONLINE_TYPE,
	       SUBJ.SUBJECT_TRANING_TYPE ,
	       SUBJ.SUBJECT_TYPE ,
	       SUBJ.TERM,
	       WEK.WEEK_CNT,
	       LTPM.COMPANY_ID,
	        
	       <!-- 
	        OFF-JT 강+실 * 15 / 주차 
          	SUBJ.LCTRE_TIME+SUBJ.TEST_EXEC_TIME * 15 / 촣 주차
	        -->
	       
	       
	       CASE
	           WHEN SUBJ.SUBJECT_TRANING_TYPE = 'OFF'
	           THEN FLOOR((SUBJ.LCTRE_TIME+SUBJ.TEST_EXEC_TIME) * 15 / 
	       FLOOR((SELECT COUNT(*) 
	         FROM LMS_SUBJ_WEEK WEEK 
	        WHERE DELETE_YN = 'N' 
	              AND WEEK.YYYY = SUBJ.YYYY 
	              AND WEEK.TERM = SUBJ.TERM 
	              AND WEEK.SUBJECT_CODE = SUBJ.SUBJECT_CODE 
	              AND WEEK.CLASS = SUBJ.CLASS 
	       ))) 
	           ELSE 0
	       END OFF_TIME_HOUR,
	       
	      <!--  FLOOR((SUBJ.LCTRE_TIME+SUBJ.TEST_EXEC_TIME) * 15 / 
	       FLOOR((SELECT COUNT(*) 
	         FROM LMS_SUBJ_WEEK WEEK 
	        WHERE DELETE_YN = 'N' 
	              AND WEEK.YYYY = SUBJ.YYYY 
	              AND WEEK.TERM = SUBJ.TERM 
	              AND WEEK.SUBJECT_CODE = SUBJ.SUBJECT_CODE 
	              AND WEEK.CLASS = SUBJ.CLASS 
	       )))  AS OFF_TIME_HOUR , -->
	       
	       
	       FN_GETCOMPAYNAME(LTPM.COMPANY_ID) as COMPANY_NAME      
	FROM   LMS_SUBJECT SUBJ
	
	       INNER JOIN LMS_SUBJ_WEEK WEK
	       ON     SUBJ.SUBJECT_CODE = WEK.SUBJECT_CODE
	       AND 	  SUBJ.CLASS = WEK.CLASS
	       AND    WEK.DELETE_YN           ='N'
	       AND    WEK.YYYY          = SUBJ.YYYY
	       AND    WEK.TERM          = SUBJ.TERM
	       
	       LEFT OUTER JOIN LMS_SUBJ_WEEK_TIME SWT
	       ON     SWT.DELETE_YN    = 'N'
	       AND     SUBJ.YYYY         = SWT.YYYY
	       AND     SUBJ.TERM         = SWT.TERM
	       AND     SUBJ.SUBJECT_CODE = SWT.SUBJECT_CODE
	       AND     SUBJ.CLASS        = SWT.CLASS
	       AND     WEK.WEEK_ID       = SWT.WEEK_ID	    
	          
	       LEFT JOIN lms_subj_ncs_unit UNIT
	       ON     SUBJ.SUBJECT_CODE = UNIT.SUBJECT_CODE
	       AND    UNIT.DELETE_YN           ='N'
	       AND    WEK.WEEK_ID       = UNIT.WEEK_ID
	       AND    SUBJ.YYYY         = UNIT.YYYY
	       AND    SUBJ.TERM         = UNIT.TERM
	       
	       LEFT JOIN lms_subj_ncs_elem ELEM
	       ON     SUBJ.SUBJECT_CODE = ELEM.SUBJECT_CODE
		   AND    ELEM.DELETE_YN           ='N'
	       AND    WEK.WEEK_ID       = ELEM.WEEK_ID
	       AND    SUBJ.YYYY         = ELEM.YYYY
	       AND    SUBJ.TERM         = ELEM.TERM
	       
	       LEFT OUTER JOIN LMS_TRANING_PROCESS_MAPPING  LTPM
	       ON    LTPM.DELETE_YN='N'
		   AND     SUBJ.YYYY         = LTPM.YYYY
	       AND     SUBJ.TERM         = LTPM.TERM
	       AND     SUBJ.SUBJECT_CODE = LTPM.SUBJECT_CODE
	       AND     SUBJ.CLASS        = LTPM.CLASS	 
	             
	WHERE      SUBJ.DELETE_YN           ='N'
		AND    SUBJ.YYYY                = #{yyyy}
		AND    SUBJ.TERM                = #{term}
		AND    SUBJ.SUBJECT_CODE        = #{subjectCode}
		AND    WEK.WEEK_CNT =#{weekCnt}
		<if test="classId != null and classId != ''">
		AND    SUBJ.CLASS  =#{classId}
		</if>
 		AND ROWNUM = 1
	</select>
	
	
	<select id="getSubject" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningNote ====== */
		SELECT  
	      
	       SUBJ.traning_hour ,
	       SUBJ.SUBJECT_NAME ,
	       SUBJ.CLASS AS CLASS_ID ,
	       SUBJ.YYYY,
	       SUBJ.SUBJECT_CODE ,
	       SUBJ.SUBJECT_TRANING_TYPE ,
	       SUBJ.SUBJECT_TYPE ,
	       SUBJ.TERM
	FROM   LMS_SUBJECT SUBJ
	WHERE      SUBJ.DELETE_YN           ='N'
		AND    SUBJ.YYYY                = #{yyyy}
		AND    SUBJ.TERM                = #{term}
		AND    SUBJ.SUBJECT_CODE        = #{subjectCode}
		AND    SUBJ.CLASS  =#{classId}

	</select>
	
	<select id="getTraningRegularClassMemberCnt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="java.lang.Integer" >
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningRegularClassMemberCnt ====== */
		SELECT COUNT(*) AS CNT FROM LMS_TRANING_NOTE_DETAIL
		WHERE 1=1
		AND SUBJECT_CODE        = #{subjectCode}
		AND DELETE_YN           ='N'
		AND YYYY                =  #{yyyy}
		AND TERM                =  #{term}
		AND WEEK_CNT = #{weekCnt}
		AND TIME_ID = #{timeId}
	</select>
	<select id="listTraningRegularClassMember" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningRegularClassMember ====== */
		<!-- 
		SELECT LESS.LESSON_ID ,
		       MEMB.MEM_NAME ,
		       MEMB.MEM_ID ,
		       MEMB.mem_seq ,
		       MEMB.COMPANY_ID ,
		       DET.STUDY_TIME ,
		       NVL(DET.ACHIEVEMENT,0 ) AS ACHIEVEMENT,
		       DET.BIGO ,
		       DET.TRANINING_NOTE_DETAIL_ID ,
		       DET.TRANINING_NOTE_MASTER_ID ,
		       MAS.REVIEW ,
		       MAS.STATE ,
		       MAS.STATUS ,
		       MAS.RETURN_COMMENT ,
		       NVL(OLES.WEEK_ON_PROGRESS_RATE,0) AS ATTEND_PROGRESS ,
		       FN_GETCOMPAYNAME(MEMB.COMPANY_ID)                                                                       AS COMPANY_NAME,
		       
		       
		      (SELECT 
              CASE 
                  WHEN WEEK.WEEK_CNT = '1' 
                  THEN ATN_RST1 
                  WHEN WEEK.WEEK_CNT = '2' 
                  THEN ATN_RST2 
                  WHEN WEEK.WEEK_CNT = '3' 
                  THEN ATN_RST3 
                  WHEN WEEK.WEEK_CNT = '4' 
                  THEN ATN_RST4 
                  WHEN WEEK.WEEK_CNT = '5' 
                  THEN ATN_RST5 
                  WHEN WEEK.WEEK_CNT = '6' 
                  THEN ATN_RST6 
                  WHEN WEEK.WEEK_CNT = '7' 
                  THEN ATN_RST7 
                  WHEN WEEK.WEEK_CNT = '8' 
                  THEN ATN_RST8 
                  WHEN WEEK.WEEK_CNT = '9' 
                  THEN ATN_RST9 
                  WHEN WEEK.WEEK_CNT = '10' 
                  THEN ATN_RST10 
                  WHEN WEEK.WEEK_CNT = '11' 
                  THEN ATN_RST11 
                  WHEN WEEK.WEEK_CNT = '12' 
                  THEN ATN_RST12 
                  WHEN WEEK.WEEK_CNT = '13' 
                  THEN ATN_RST13 
                  WHEN WEEK.WEEK_CNT = '14' 
                  THEN ATN_RST14 
                  WHEN WEEK.WEEK_CNT = '15' 
                  THEN ATN_RST15 
                  END
                 FROM KUT_MOB2.VH_OKLMS_LCTRE_ATTEND_DTL 
                WHERE STUD_ID= MEMB.MEM_ID 
                      AND YR = WEEK.YYYY 
                      AND DECODE(TERM_DIV,'10','1','20','2','11','3','4') = WEEK.TERM
                      AND CORS_CD = WEEK.SUBJECT_CODE 
                      AND CLS_NO = WEEK.CLASS 
               ) AS ATTEND 
		       
		FROM   LMS_LESSON LESS
		       INNER JOIN COM_MEMBER  MEMB
		       ON     LESS.MEM_SEQ = MEMB.MEM_SEQ AND MEMB.DELETE_YN='N'
		       		
		       INNER JOIN LMS_SUBJ_WEEK WEEK
		       ON     LESS.SUBJECT_CODE = WEEK.SUBJECT_CODE
		       AND    WEEK.YYYY         = LESS.YYYY
		       AND    WEEK.TERM         = LESS.TERM
		       AND    WEEK.CLASS        = LESS.CLASS
		       
		       LEFT OUTER JOIN LMS_WEEK_ON_LESSON OLES 
                     ON OLES.LESSON_ID = LESS.LESSON_ID 
                   AND OLES.WEEK_ID = WEEK.WEEK_ID
		       
		       LEFT OUTER JOIN LMS_SUBJ_WEEK_TIME  WEET
		       ON     LESS.SUBJECT_CODE = WEET.SUBJECT_CODE
		       AND    WEEK.WEEK_ID      = WEET.WEEK_ID
		       AND    WEET.YYYY         = LESS.YYYY
		       AND    WEET.TERM         = LESS.TERM
		       AND    WEET.CLASS        = LESS.CLASS
		       
		       LEFT OUTER JOIN LMS_TRANING_NOTE_DETAIL DET
		       ON     LESS.SUBJECT_CODE = DET.SUBJECT_CODE
		       AND    MEMB.MEM_ID       = DET.MEM_ID
		       AND    DET.DELETE_YN     = 'N'
		       AND    DET.ADDYN         = 'N'
		       AND    DET.WEEK_CNT      = WEEK.WEEK_CNT
		  	   AND    DET.TIME_ID       = WEET.TIME_ID
		       AND    DET.YYYY          = LESS.YYYY
		       AND    DET.TERM          = LESS.TERM
		       AND    DET.CLASS         = LESS.CLASS
		       
		       LEFT OUTER JOIN LMS_TRANING_NOTE_MASTER MAS
		       ON     MAS.TRANINING_NOTE_MASTER_ID = DET.TRANINING_NOTE_MASTER_ID
		       AND    MAS.DELETE_YN                = 'N'
		       AND    MAS.ADDYN                    = 'N'
			   AND    MAS.TIME_ID                  = WEET.TIME_ID
		WHERE    LESS.SUBJECT_CODE        = #{subjectCode}
		AND LESS.DELETE_YN           ='N'
		AND LESS.YYYY                =  #{yyyy}
		AND LESS.TERM                =  #{term}
		AND WEEK.WEEK_CNT = #{weekCnt}
		<if test="memSeq != null and memSeq != ''">
		AND MEMB.MEM_SEQ = #{memSeq}
		</if>
		<if test="classId != null and classId != ''">
		AND LESS.CLASS  =#{classId}
		</if>
		<if test="timeId != null and timeId != ''">
		AND WEET.TIME_ID = #{timeId}
		</if>
		
		ORDER BY MEMB.MEM_ID 
		 -->
		
		
		SELECT LESS.LESSON_ID ,
		       MEMB.MEM_NAME ,
		       MEMB.MEM_ID ,
		       MEMB.mem_seq ,
		       MEMB.COMPANY_ID ,
		       MEMB.OUT_YN,
		       DET.STUDY_TIME ,
		       NVL(DET.ACHIEVEMENT,0 ) AS ACHIEVEMENT,
		       DET.BIGO ,
		       DET.TRANINING_NOTE_DETAIL_ID ,
		       DET.TRANINING_NOTE_MASTER_ID ,
		       MAS.REVIEW ,
		       MAS.STATE ,
		       MAS.STATUS ,
		       MAS.RETURN_COMMENT ,
		       NVL(OLES.WEEK_ON_PROGRESS_RATE,0) AS ATTEND_PROGRESS ,
		       FN_GETCOMPAYNAME(MEMB.COMPANY_ID)                                                                       AS COMPANY_NAME,
		       
		       
		      (SELECT 
              CASE 
                  WHEN WEEK.WEEK_CNT = '1' 
                  THEN ATN_RST1 
                  WHEN WEEK.WEEK_CNT = '2' 
                  THEN ATN_RST2 
                  WHEN WEEK.WEEK_CNT = '3' 
                  THEN ATN_RST3 
                  WHEN WEEK.WEEK_CNT = '4' 
                  THEN ATN_RST4 
                  WHEN WEEK.WEEK_CNT = '5' 
                  THEN ATN_RST5 
                  WHEN WEEK.WEEK_CNT = '6' 
                  THEN ATN_RST6 
                  WHEN WEEK.WEEK_CNT = '7' 
                  THEN ATN_RST7 
                  WHEN WEEK.WEEK_CNT = '8' 
                  THEN ATN_RST8 
                  WHEN WEEK.WEEK_CNT = '9' 
                  THEN ATN_RST9 
                  WHEN WEEK.WEEK_CNT = '10' 
                  THEN ATN_RST10 
                  WHEN WEEK.WEEK_CNT = '11' 
                  THEN ATN_RST11 
                  WHEN WEEK.WEEK_CNT = '12' 
                  THEN ATN_RST12 
                  WHEN WEEK.WEEK_CNT = '13' 
                  THEN ATN_RST13 
                  WHEN WEEK.WEEK_CNT = '14' 
                  THEN ATN_RST14 
                  WHEN WEEK.WEEK_CNT = '15' 
                  THEN ATN_RST15 
                  END
                 FROM KUT_MOB2.VH_OKLMS_LCTRE_ATTEND_DTL 
                WHERE STUD_ID= MEMB.MEM_ID 
                      AND YR = WEEK.YYYY 
                      AND DECODE(TERM_DIV,'10','1','20','2','11','3','4') = WEEK.TERM
                      AND CORS_CD = WEEK.SUBJECT_CODE 
                      AND CLS_NO = WEEK.CLASS 
               ) AS ATTEND 
		       
		FROM   LMS_LESSON LESS
		       INNER JOIN COM_MEMBER  MEMB
		       ON     LESS.MEM_SEQ = MEMB.MEM_SEQ AND MEMB.DELETE_YN='N'
		       		
		       INNER JOIN LMS_SUBJ_WEEK WEEK
		       ON     LESS.SUBJECT_CODE = WEEK.SUBJECT_CODE
		       AND    WEEK.YYYY         = LESS.YYYY
		       AND    WEEK.TERM         = LESS.TERM
		       AND    WEEK.CLASS        = LESS.CLASS
		       
		       LEFT OUTER JOIN LMS_WEEK_ON_LESSON OLES 
                     ON OLES.LESSON_ID = LESS.LESSON_ID 
                   AND OLES.WEEK_ID = WEEK.WEEK_ID
		       
		       LEFT OUTER JOIN LMS_SUBJ_WEEK_TIME  WEET
		       ON     LESS.SUBJECT_CODE = WEET.SUBJECT_CODE
		       AND    WEEK.WEEK_ID      = WEET.WEEK_ID
		       AND    WEET.YYYY         = LESS.YYYY
		       AND    WEET.TERM         = LESS.TERM
		       AND    WEET.CLASS        = LESS.CLASS
		       
		       LEFT OUTER JOIN LMS_TRANING_NOTE_DETAIL DET
		       ON     LESS.SUBJECT_CODE = DET.SUBJECT_CODE
		       AND    MEMB.MEM_ID       = DET.MEM_ID
		       AND    DET.DELETE_YN     = 'N'
		       AND    DET.ADDYN         = 'N'
		       AND    DET.WEEK_CNT      = WEEK.WEEK_CNT
		  	   AND    DET.TIME_ID       = WEET.TIME_ID
		       AND    DET.YYYY          = LESS.YYYY
		       AND    DET.TERM          = LESS.TERM
		       AND    DET.CLASS         = LESS.CLASS
		       
		       LEFT OUTER JOIN LMS_TRANING_NOTE_MASTER MAS
		       ON     MAS.TRANINING_NOTE_MASTER_ID = DET.TRANINING_NOTE_MASTER_ID
		       AND    MAS.DELETE_YN                = 'N'
		       AND    MAS.ADDYN                    = 'N'
			   AND    MAS.TIME_ID                  = WEET.TIME_ID
		WHERE    LESS.SUBJECT_CODE        = #{subjectCode}
		AND LESS.DELETE_YN           ='N'
		AND LESS.YYYY                =  #{yyyy}
		AND LESS.TERM                =  #{term}
		AND WEEK.WEEK_CNT = #{weekCnt}
		<if test="memSeq != null and memSeq != ''">
		AND MEMB.MEM_SEQ = #{memSeq}
		</if>
		<if test="classId != null and classId != ''">
		AND LESS.CLASS  =#{classId}
		</if>
		<if test="timeId != null and timeId != ''">
		AND WEET.TIME_ID = #{timeId}
		</if>
		
		ORDER BY MEMB.MEM_ID 
		 
		 
	</select>
	
	
	<select id="listTraningRegularClassHsMember" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningRegularClassMember ====== */
		SELECT 
		       MEMB.MEM_NAME ,
		       MEMB.MEM_ID ,
		       MEMB.mem_seq ,
		       DET.STUDY_TIME ,
		       NVL(DET.ACHIEVEMENT,0 ) AS ACHIEVEMENT,
		       DET.BIGO ,
		       DET.TRANINING_NOTE_DETAIL_ID ,
		       DET.TRANINING_NOTE_MASTER_ID ,
		       MAS.REVIEW ,
		       MAS.STATE ,
		       MAS.STATUS ,
		       MAS.RETURN_COMMENT 
		    
		FROM   LMS_LESSON LESS
		       INNER JOIN COM_MEMBER  MEMB
		       ON     LESS.MEM_SEQ = MEMB.MEM_SEQ AND MEMB.DELETE_YN='N'
		       		
		       INNER JOIN LMS_SUBJ_WEEK WEEK
		       ON     LESS.SUBJECT_CODE = WEEK.SUBJECT_CODE
		       AND    WEEK.YYYY         = LESS.YYYY
		       AND    WEEK.TERM         = LESS.TERM
		       AND    WEEK.CLASS        = LESS.CLASS
		       
		       LEFT OUTER JOIN LMS_WEEK_ON_LESSON OLES 
                     ON OLES.LESSON_ID = LESS.LESSON_ID 
                   AND OLES.WEEK_ID = WEEK.WEEK_ID
		       
		       LEFT OUTER JOIN LMS_SUBJ_WEEK_TIME  WEET
		       ON     LESS.SUBJECT_CODE = WEET.SUBJECT_CODE
		       AND    WEEK.WEEK_ID      = WEET.WEEK_ID
		       AND    WEET.YYYY         = LESS.YYYY
		       AND    WEET.TERM         = LESS.TERM
		       AND    WEET.CLASS        = LESS.CLASS
		       
		       LEFT OUTER JOIN LMS_TRANING_NOTE_DETAIL DET
		       ON     LESS.SUBJECT_CODE = DET.SUBJECT_CODE
		       AND    MEMB.MEM_ID       = DET.MEM_ID
		       AND    DET.DELETE_YN     = 'N'
		       AND    DET.ADDYN         = 'N'
		       AND    DET.WEEK_CNT      = WEEK.WEEK_CNT
		  	   AND    DET.TIME_ID       = WEET.TIME_ID
		       AND    DET.YYYY          = LESS.YYYY
		       AND    DET.TERM          = LESS.TERM
		       AND    DET.CLASS         = LESS.CLASS
		       
		       LEFT OUTER JOIN LMS_TRANING_NOTE_MASTER MAS
		       ON     MAS.TRANINING_NOTE_MASTER_ID = DET.TRANINING_NOTE_MASTER_ID
		       AND    MAS.DELETE_YN                = 'N'
		       AND    MAS.ADDYN                    = 'N'
			   AND    MAS.TIME_ID                  = WEET.TIME_ID
		WHERE    LESS.SUBJECT_CODE        = #{subjectCode}
		AND LESS.DELETE_YN           ='N'
		AND LESS.YYYY                =  #{yyyy}
		AND LESS.TERM                =  #{term}
		AND WEEK.WEEK_CNT = #{weekCnt}
		<if test="memSeq != null and memSeq != ''">
		AND MEMB.MEM_SEQ = #{memSeq}
		</if>
		<if test="classId != null and classId != ''">
		AND LESS.CLASS  =#{classId}
		</if>
		<if test="timeId != null and timeId != ''">
		AND WEET.TIME_ID = #{timeId}
		</if>
		
		GROUP BY MEMB.MEM_NAME ,
		       MEMB.MEM_ID ,
		       MEMB.mem_seq ,
		       DET.STUDY_TIME ,
		       DET.ACHIEVEMENT,
		       DET.BIGO ,
		       DET.TRANINING_NOTE_DETAIL_ID ,
		       DET.TRANINING_NOTE_MASTER_ID ,
		       MAS.REVIEW ,
		       MAS.STATE ,
		       MAS.STATUS ,
		       MAS.RETURN_COMMENT
		
		ORDER BY MEMB.MEM_ID 

	</select>
	
	
	 
	<select id="listTraningClassMember" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningClassMember ====== */
		<include refid="kr.co.gocle.include.paging-start"/>
		SELECT MEMB.COMPANY_ID,
			   FN_GETCOMPAYNAME(MEMB.COMPANY_ID)  AS COMPANY_NAME,
			   MEMB.MEM_NAME ,
		       MEMB.MEM_ID ,
		       MEMB.MEM_SEQ  
		FROM   LMS_LESSON LESS
		       INNER JOIN COM_MEMBER  MEMB
		       ON     LESS.MEM_SEQ = MEMB.MEM_SEQ AND MEMB.DELETE_YN='N'
		       		
		       INNER JOIN LMS_SUBJ_WEEK WEEK
		       ON     LESS.SUBJECT_CODE = WEEK.SUBJECT_CODE
		       AND    WEEK.YYYY         = LESS.YYYY
		       AND    WEEK.TERM         = LESS.TERM
		       AND    WEEK.CLASS        = LESS.CLASS
		       
		WHERE    LESS.SUBJECT_CODE        = #{subjectCode}
		AND LESS.DELETE_YN           ='N'
		AND LESS.YYYY                =  #{yyyy}
		AND LESS.TERM                =  #{term}
		AND WEEK.WEEK_CNT = #{weekCnt}
		
		<if test="classId != null and classId != ''">
		AND LESS.CLASS  =#{classId}
		</if>
		<if test="timeId != null and timeId != ''">
		AND WEET.TIME_ID = #{timeId}
		</if>
		ORDER BY MEMB.MEM_ID 
		
		
		<include refid="kr.co.gocle.include.paging-end"/>
		
		
		
	</select>	
	
	
	
	<select id="listTraningRegularClassMember2" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningRegularClassMember2 ====== */
		SELECT LESS.LESSON_ID ,
		       MEMB.MEM_NAME ,
		       MEMB.MEM_ID ,
		       MEMB.mem_seq ,
		       MEMB.COMPANY_ID ,
		       DET.STUDY_TIME ,
		       NVL(DET.ACHIEVEMENT,0 ) AS ACHIEVEMENT,
		       DET.BIGO ,
		       DET.TRANINING_NOTE_DETAIL_ID ,
		       DET.TRANINING_NOTE_MASTER_ID ,
		       MAS.REVIEW ,
		       WEEK.WEEK_CNT ,
		       NVL(OLES.WEEK_ON_PROGRESS_RATE,0) AS ATTEND_PROGRESS ,
		       FN_GETCOMPAYNAME(MEMB.COMPANY_ID) AS COMPANY_NAME
		FROM   LMS_LESSON LESS
		
		       LEFT JOIN LMS_SUBJ_WEEK WEEK
		       ON  LESS.SUBJECT_CODE = WEEK.SUBJECT_CODE
	           AND WEEK.YYYY = LESS.YYYY
		       AND WEEK.TERM = LESS.TERM
		       AND WEEK.CLASS = LESS.CLASS
		       AND WEEK.DELETE_YN='N'
		       
		       LEFT OUTER JOIN LMS_WEEK_ON_LESSON OLES 
                     ON OLES.LESSON_ID = LESS.LESSON_ID 
                   AND OLES.WEEK_ID = WEEK.WEEK_ID 
		       
		       LEFT JOIN COM_MEMBER MEMB
		       ON     LESS.MEM_SEQ = MEMB.MEM_SEQ AND MEMB.DELETE_YN='N'
		       
		       LEFT OUTER JOIN LMS_TRANING_NOTE_DETAIL DET
			   ON     LESS.SUBJECT_CODE = DET.SUBJECT_CODE
			   AND MEMB.MEM_ID = DET.MEM_ID
			   AND DET.DELETE_YN = 'N'
			   AND DET.ADDYN = 'N'
			   AND DET.WEEK_CNT = #{weekCnt}
			   AND DET.YYYY = LESS.YYYY
			   AND DET.TERM = LESS.TERM
			   AND DET.CLASS = LESS.CLASS
			   AND DET.TIME_ID = #{timeId}
			   
		       LEFT OUTER JOIN LMS_TRANING_NOTE_MASTER MAS
		       ON  MAS.TRANINING_NOTE_MASTER_ID = DET.TRANINING_NOTE_MASTER_ID		        
		       AND MAS.DELETE_YN = 'N'
		       AND MAS.ADDYN = 'N'
			   AND MAS.TIME_ID                  = DET.TIME_ID
		WHERE  LESS.SUBJECT_CODE        = #{subjectCode}
		AND LESS.DELETE_YN           ='N'
		AND LESS.YYYY                =  #{yyyy}
		AND LESS.TERM                =  #{term}
		AND WEEK.WEEK_CNT = #{weekCnt}
		<if test="memSeq != null and memSeq != ''">
		AND MEMB.MEM_SEQ = #{memSeq}
		</if>
		<if test="classId != null and classId != ''">
		AND LESS.CLASS  =#{classId}
		</if>


	</select>


	<select id="listTraningEnrichmentClassMember" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningEnrichmentClassMember ====== */
		SELECT LESS.LESSON_ID ,
	        MEMB.MEM_NAME ,
	        MEMB.MEM_ID ,
	        MEMB.mem_seq ,
	        MEMB.COMPANY_ID ,
	        DET.STUDY_TIME ,
	        NVL(DET.ACHIEVEMENT,0 ) AS ACHIEVEMENT,
	        DET.BIGO ,
	        DET.TRANINING_NOTE_DETAIL_ID ,
	        DET.TRANINING_NOTE_MASTER_ID ,
	        MAS.REVIEW ,
	        WEEK.WEEK_CNT ,
	        WEET.TRANING_ST_HOUR ,
	        STA.ATTEND_PROGRESS ,
	        FN_GETCOMPAYNAME(MEMB.COMPANY_ID) AS COMPANY_NAME
	 FROM   LMS_LESSON LESS
	 
	        INNER JOIN LMS_SUBJ_WEEK WEEK
	        ON     LESS.SUBJECT_CODE = WEEK.SUBJECT_CODE
	        AND    WEEK.YYYY         = LESS.YYYY
	        AND    WEEK.TERM         = LESS.TERM
	        AND    WEEK.CLASS        = LESS.CLASS
	        AND    WEEK.DELETE_YN    = 'N'
	        
	        INNER JOIN LMS_SUBJ_WEEK_TIME_ENRICHMENT WEET
	        ON     LESS.SUBJECT_CODE = WEET.SUBJECT_CODE
	        AND    WEET.YYYY         = LESS.YYYY
	        AND    WEET.TERM         = LESS.TERM
	        AND    WEET.CLASS        = LESS.CLASS
	        AND    WEET.DELETE_YN    = 'N'
	        
	        INNER JOIN COM_MEMBER MEMB
	        ON     LESS.MEM_SEQ = MEMB.MEM_SEQ  AND MEMB.DELETE_YN='N'
	        
	        INNER JOIN LMS_TRANING_NOTE_DETAIL DET
	        ON     LESS.SUBJECT_CODE = DET.SUBJECT_CODE
	        AND    MEMB.MEM_ID       = DET.MEM_ID
	        AND    DET.DELETE_YN     = 'N'
	        AND    DET.ADDYN         = 'Y'
	        AND    DET.WEEK_CNT      = WEEK.WEEK_CNT
	        AND    DET.YYYY          = LESS.YYYY
	        AND    DET.TERM          = LESS.TERM
	        AND    DET.CLASS         = LESS.CLASS
	        
	        INNER JOIN LMS_TRANING_NOTE_MASTER MAS
	        ON     MAS.TRANINING_NOTE_MASTER_ID = DET.TRANINING_NOTE_MASTER_ID
	        AND    MAS.DELETE_YN                = 'N'
	        AND    MAS.ADDYN                    = 'Y'
	        AND    MAS.TIME_ID                  = WEET.TIME_ID
		<if test="traniningNoteMasterId != null and traniningNoteMasterId != ''">	        
	        AND    MAS.TRANINING_NOTE_MASTER_ID = #{traniningNoteMasterId}
	    </if>    
	        LEFT OUTER JOIN LMS_SUBJ_ON_STAND  STA
	        ON     LESS.SUBJECT_CODE = STA.SUBJECT_CODE
	        AND    STA.YYYY          = LESS.YYYY
	        AND    STA.TERM          = LESS.TERM
	        AND    STA.CLASS         = LESS.CLASS
	        AND    STA.DELETE_YN    = 'N'
	        
 		WHERE   LESS.SUBJECT_CODE        = #{subjectCode}
			AND LESS.DELETE_YN           = 'N'
			AND LESS.YYYY                = #{yyyy}
			AND LESS.TERM                = #{term}
			AND WEEK.WEEK_CNT 			 = #{weekCnt}
		<if test="memSeq != null and memSeq != ''">
			AND MEMB.MEM_SEQ = #{memSeq}
		</if>
		<if test="classId != null and classId != ''">
			AND LESS.CLASS  =#{classId}
		</if>

	</select>


	<select id="getTraningRegularTime" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningRegularTime ====== */
		SELECT
			 TO_CHAR(TO_DATE(WEET.TRANING_DATE,'YYYY.MM.DD'), 'dy', 'NLS_DATE_LANGUAGE=korean') AS DAY_OF_WEEK
			,WEET.TRANING_DATE
			,WEET.TRANING_ST_HOUR ||':'|| WEET.TRANING_ST_MIN as TRANING_ST
			,WEET.TRANING_ED_HOUR ||':'|| WEET.TRANING_ED_MIN as TRANING_ED
			,WEET.LEAD_TIME AS TIME_HOUR
			,MOD(TRIM(WEET.TRANING_ED_MIN), TRIM(WEET.TRANING_ST_MIN) ) AS TIME_MIN
            ,WEET.TRANING_ST_HOUR
            ,WEET.TRANING_ST_MIN
            ,WEET.TRANING_ED_HOUR
            ,WEET.TRANING_ED_MIN
            ,WEET.WEEK_ID
            ,WEET.TIME_ID
            ,WEET.NCS_UNIT_NAME
            ,MAS.REVIEW
            ,MAS.STATE
            ,MAS.STATUS
            ,MAS.RETURN_COMMENT
            ,WEET.CLASS AS CLASS_ID
            ,WEET.LEAD_TIME
            
		FROM LMS_SUBJ_WEEK WEEK
		
		LEFT JOIN LMS_SUBJ_WEEK_TIME WEET
		ON WEEK.SUBJECT_CODE = WEET.SUBJECT_CODE
		AND WEET.DELETE_YN = 'N'
		AND WEEK.WEEK_ID = WEET.WEEK_ID
		
		LEFT OUTER JOIN LMS_TRANING_NOTE_MASTER MAS
        ON     MAS.SUBJECT_CODE  			= WEET.SUBJECT_CODE
        AND    MAS.DELETE_YN                = 'N'
        AND    MAS.ADDYN                    = 'N'
        AND    MAS.WEEK_CNT                 = WEEK.WEEK_CNT
        AND    MAS.TIME_ID                  = WEET.TIME_ID
        AND    MAS.YYYY                     = WEET.YYYY
        AND    MAS.TERM                     = WEET.TERM
        AND    MAS.CLASS                    = WEET.CLASS				
			
		
		
		WHERE WEEK.SUBJECT_CODE = #{subjectCode}
		AND WEEK.WEEK_CNT = #{weekCnt}
		AND WEEK.DELETE_YN ='N'
		AND WEEK.YYYY=  #{yyyy}
		AND WEET.TIME_ID         = #{timeId}
		<if test="classId != null and classId != ''">
		AND WEEK.CLASS  =#{classId}
		</if>
		
		AND ROWNUM = 1

	</select>

	<select id="getTraningNowWeekCnt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningNowWeekCnt ====== */
		SELECT
			NVL(MAX(TO_NUMBER(WEEK.WEEK_CNT)),'1') AS WEEK_CNT   
		FROM LMS_SUBJ_WEEK WEEK
		
		LEFT JOIN LMS_SUBJ_WEEK_TIME WEET
		ON WEEK.SUBJECT_CODE = WEET.SUBJECT_CODE
		AND WEET.DELETE_YN = 'N'
		AND WEEK.WEEK_ID = WEET.WEEK_ID
		
		WHERE WEEK.SUBJECT_CODE = #{subjectCode}
		AND WEEK.DELETE_YN ='N'
		AND WEEK.YYYY=  #{yyyy}
		AND WEEK.TERM =  #{term}
		<if test="classId != null and classId != ''">
		AND WEEK.CLASS  =#{classId}
		</if>
<![CDATA[
		AND WEET.TRANING_DATE <= TO_CHAR(SYSDATE,'YYYY.MM.DD')
]]>	
	</select>
	
	<select id="listTraningRegularTime" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningRegularTime ====== */
		SELECT
			TO_CHAR(TO_DATE(WEET.TRANING_DATE,'YYYY.MM.DD'), 'dy', 'NLS_DATE_LANGUAGE=korean') AS DAY_OF_WEEK
			,WEET.TRANING_DATE
			,WEET.TRANING_ST_HOUR ||':'|| WEET.TRANING_ST_MIN as TRANING_ST
			,WEET.TRANING_ED_HOUR ||':'|| WEET.TRANING_ED_MIN as TRANING_ED
			,WEET.LEAD_TIME AS TIME_HOUR
			,MOD(TRIM(WEET.TRANING_ED_MIN), TRIM(WEET.TRANING_ST_MIN) ) AS TIME_MIN
            ,WEET.TRANING_ST_HOUR
            ,WEET.TRANING_ST_MIN
            ,WEET.TRANING_ED_HOUR
            ,WEET.TRANING_ED_MIN
            ,WEET.WEEK_ID
            ,WEET.TIME_ID
            ,WEET.NCS_UNIT_NAME
            ,WEET.NCS_UNIT_ID
            ,WEET.LEAD_TIME
            ,MAS.REVIEW
            ,MAS.STATE
            ,MAS.RETURN_COMMENT
            ,MAS.STATUS
            ,WEET.CLASS AS CLASS_ID
		FROM LMS_SUBJ_WEEK WEEK
		
		LEFT JOIN LMS_SUBJ_WEEK_TIME WEET
		ON WEEK.SUBJECT_CODE = WEET.SUBJECT_CODE
		AND WEET.DELETE_YN = 'N'
		AND WEEK.WEEK_ID = WEET.WEEK_ID
		
		LEFT OUTER JOIN LMS_TRANING_NOTE_MASTER MAS
	        ON     MAS.SUBJECT_CODE  			= WEET.SUBJECT_CODE
	        AND    MAS.DELETE_YN                = 'N'
	        AND    MAS.ADDYN                    = 'N'
	        AND    MAS.WEEK_CNT                 = WEEK.WEEK_CNT
	        AND    MAS.TIME_ID                  = WEET.TIME_ID
	        AND    MAS.YYYY                     = WEET.YYYY
	        AND    MAS.TERM                     = WEET.TERM
	        AND    MAS.CLASS                    = WEET.CLASS				
				
		
		WHERE WEEK.SUBJECT_CODE = #{subjectCode}
		AND WEEK.WEEK_CNT = #{weekCnt}
		AND WEEK.DELETE_YN ='N'
		AND WEEK.YYYY=  #{yyyy}
		AND WEEK.TERM=  #{term}
		<if test="classId != null and classId != ''">
		AND WEEK.CLASS  =#{classId}
		</if>
		ORDER BY WEET.TIME_ID
	</select>
	
	
	<select id="listHsTraningRegularTime" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listHsTraningRegularTime ====== */
		SELECT
			TO_CHAR(TO_DATE(WEET.TRANING_DATE,'YYYY.MM.DD'), 'dy', 'NLS_DATE_LANGUAGE=korean') AS DAY_OF_WEEK
			,WEET.TRANING_DATE
			,WEET.TRANING_ST_HOUR ||':'|| WEET.TRANING_ST_MIN as TRANING_ST
			,WEET.TRANING_ED_HOUR ||':'|| WEET.TRANING_ED_MIN as TRANING_ED
			,WEET.LEAD_TIME AS TIME_HOUR
			,MOD(TRIM(WEET.TRANING_ED_MIN), TRIM(WEET.TRANING_ST_MIN) ) AS TIME_MIN
            ,WEET.TRANING_ST_HOUR
            ,WEET.TRANING_ST_MIN
            ,WEET.TRANING_ED_HOUR
            ,WEET.TRANING_ED_MIN
            ,WEET.WEEK_ID
            ,WEET.TIME_ID
            ,WEET.NCS_UNIT_NAME
            ,WEET.NCS_UNIT_ID
            ,WEET.LEAD_TIME
            ,MAS.REVIEW
            ,MAS.STATE
            ,MAS.RETURN_COMMENT
            ,MAS.STATUS
            ,WEET.CLASS AS CLASS_ID
		FROM LMS_SUBJ_WEEK WEEK
		
		LEFT JOIN LMS_SUBJ_WEEK_TIME WEET
		ON WEEK.SUBJECT_CODE = WEET.SUBJECT_CODE
		AND WEET.DELETE_YN = 'N'
		AND WEEK.WEEK_ID = WEET.WEEK_ID
		
		LEFT OUTER JOIN LMS_TRANING_NOTE_MASTER MAS
	        ON     MAS.SUBJECT_CODE  			= WEET.SUBJECT_CODE
	        AND    MAS.DELETE_YN                = 'N'
	        AND    MAS.ADDYN                    = 'N'
	        AND    MAS.WEEK_CNT                 = WEEK.WEEK_CNT
	        AND    MAS.TIME_ID                  = WEET.TIME_ID
	        AND    MAS.YYYY                     = WEET.YYYY
	        AND    MAS.TERM                     = WEET.TERM
	        AND    MAS.CLASS                    = WEET.CLASS	
	        AND    MAS.INSERT_USER = #{sessionMemSeq}			
				
		
		WHERE WEEK.SUBJECT_CODE = #{subjectCode}
		AND WEEK.WEEK_CNT = #{weekCnt}
		AND WEEK.DELETE_YN ='N'
		AND WEEK.YYYY=  #{yyyy}
		AND WEEK.TERM=  #{term}
		<if test="classId != null and classId != ''">
		AND WEEK.CLASS  =#{classId}
		</if>
		ORDER BY WEET.TIME_ID
	</select>
	
	

	<select id="getTraningEnrichmentTime" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getTraningEnrichmentTime ====== */
		SELECT
			 TO_CHAR(TO_DATE(WEET.TRANING_DATE,'YYYY.MM.DD'), 'dy', 'NLS_DATE_LANGUAGE=korean') AS DAY_OF_WEEK
			,WEET.TRANING_DATE
			,WEET.TRANING_ST_HOUR ||':'|| WEET.TRANING_ST_MIN as TRANING_ST
			,WEET.TRANING_ED_HOUR ||':'|| WEET.TRANING_ED_MIN as TRANING_ED
			,MOD(TRIM(WEET.TRANING_ST_HOUR), TRIM(WEET.TRANING_ST_MIN)) AS TIME_HOUR
			,MOD(TRIM(WEET.TRANING_ED_MIN), TRIM(WEET.TRANING_ST_MIN) ) AS TIME_MIN
            ,WEET.TRANING_ST_HOUR
            ,WEET.TRANING_ST_MIN
            ,WEET.TRANING_ED_HOUR
            ,WEET.TRANING_ED_MIN
            ,WEET.WEEK_ID
            ,WEET.TIME_ID
            ,MAS.REVIEW
            ,WEET.CLASS AS CLASS_ID
            ,MAS.TRANINING_NOTE_MASTER_ID
		FROM LMS_SUBJ_WEEK WEEK
		INNER JOIN LMS_SUBJ_WEEK_TIME_ENRICHMENT  WEET
				ON WEEK.SUBJECT_CODE = WEET.SUBJECT_CODE
				AND WEET.DELETE_YN = 'N'
				AND WEEK.WEEK_ID = WEET.WEEK_ID
				
	    LEFT OUTER JOIN LMS_TRANING_NOTE_MASTER MAS
	        ON     MAS.SUBJECT_CODE  			= WEET.SUBJECT_CODE
	        AND    MAS.DELETE_YN                = 'N'
	        AND    MAS.ADDYN                    = 'Y'
	        AND    MAS.WEEK_CNT                 = WEEK.WEEK_CNT
	        AND    MAS.TIME_ID                  = WEET.TIME_ID
	        AND    MAS.YYYY                     = WEET.YYYY
	        AND    MAS.TERM                     = WEET.TERM
	        AND    MAS.CLASS                    = WEET.CLASS				
				
		WHERE WEEK.SUBJECT_CODE = #{subjectCode}
			AND WEEK.WEEK_CNT = #{weekCnt}
			AND WEEK.DELETE_YN ='N'
			AND WEEK.YYYY=  #{yyyy}
		<if test="classId != null and classId != ''">
			AND WEEK.CLASS  =#{classId}
		</if>
	</select>

	<insert id="goInsertTraningNoteDetail" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" >

	<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.goInsertTraningNoteDetail ====== */
		]]>
			INSERT INTO LMS_TRANING_NOTE_DETAIL (
					TRANINING_NOTE_DETAIL_ID
					,TRANINING_NOTE_MASTER_ID
					,YYYY
					,TERM
					,SUBJECT_CODE

					,CLASS
					,WEEK_CNT
					,ADDYN
					,STUDY_DATE
					,START_TIME

					,FINISH_TIME
					,MEM_ID
					,MEM_NM
					,PLAN_TIME
					,STUDY_TIME

					,ACHIEVEMENT
					,BIGO
					,DELETE_YN
					,INSERT_USER
					,INSERT_DATE
					,TIME_ID

				)
				VALUES
				(
					#{traniningNoteDetailId}
					,#{traniningNoteMasterId}
					,#{yyyy}
					,#{term}
					,#{subjectCode}

					,#{classId}
					,#{weekCnt}
					,#{addyn}
					,#{studyDate}
					,#{traningEdHour}

					,#{traningEdHour}
					,#{memId}
					,#{memNm}
					,#{startTime}
					,#{startTime}
			<if test="achievement == null or achievement == ''">
					, '0'
			</if>	
			<if test="achievement != null and achievement != ''">
					,#{achievement}
			</if>				 
					,#{bigo}
					,'N'
					,#{sessionMemSeq}
					,SYSDATE
					,#{timeId}
				)

	</insert>

	<insert id="goInsertTraningNoteMaster" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" >

	<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.goInsertTraningNoteMaster ====== */
		]]>
			INSERT INTO LMS_TRANING_NOTE_MASTER (
					TRANINING_NOTE_MASTER_ID
					,YYYY
					,TERM
					,SUBJECT_CODE
					,CLASS
					,WEEK_CNT
					,ADDYN
					,STUDY_DATE
					,TRANING_TYPE
					,STATE
					,START_DATE
					,FINISH_DATE
					,FEEDBACK
					,DELETE_YN
					,REVIEW
					,INSERT_USER
					,INSERT_DATE
					,TIME_ID
					,STATUS
				)
				VALUES
				(
					#{traniningNoteMasterId}
					,#{yyyy}
					,#{term}
					,#{subjectCode}
					,#{classId}
					,#{weekCnt}
					,#{addyn}
					,#{studyDate}
					,#{traningType}
					,#{state}
					,#{traningEdHour}
					,#{traningEdHour}
					,#{feedback}
					,'N'
					,#{review}
					,#{sessionMemSeq}
					,SYSDATE
					,#{timeId}
					,'1'
				)

	</insert>

	<insert id="goInsertEnrichmentTraningTime" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" >

		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.goInsertEnrichmentTraningTime ====== */
		]]>
			insert
				into   LMS_SUBJ_WEEK_TIME_ENRICHMENT
				       (
				              WEEK_ID,
				              TIME_ID,
				              YYYY,
				              TERM,
				              SUBJECT_CODE,

				              CLASS,
				              TRANING_DATE,
				              TRANING_ST_HOUR,
				              TRANING_ED_HOUR,
				              TRANING_ED_MIN,

				              INSERT_DATE,
				              INSERT_USER,
				              DELETE_YN,
				              TRANING_ST_MIN,
				              REVIEW


				       )
				       values
				       (
							#{weekId}
							,#{timeId}
							,#{yyyy}
							,#{term}
							,#{subjectCode}

							,#{classId}
							,#{studyDate}
							,#{traningStHour}
							,#{traningEdHour}
							,#{traningEdMin}

							,SYSDATE
							,#{sessionMemSeq}
							,'N'
							,#{traningStMin}
							,#{review}
				       )


	</insert>

	<update id="goUpdateEnrichmentTraningTime" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.goUpdateEnrichmentTraningTime ====== */
		]]>
			update LMS_SUBJ_WEEK_TIME_ENRICHMENT
				set
				       TRANING_DATE    = #{studyDate},
				       TRANING_ST_HOUR = #{traningStHour},
				       TRANING_ED_HOUR = #{traningEdHour},
				       TRANING_ED_MIN  = #{traningEdMin},
				       UPDATE_DATE     = SYSDATE,
				       UPDATE_USER     = #{sessionMemSeq},
				       DELETE_YN       = 'N',
				       TRANING_ST_MIN  = #{traningStMin},
				       REVIEW 		   = #{review}

			WHERE   1=1
				AND	WEEK_ID         = #{weekId}
				AND TIME_ID         = #{timeId}

	</update>

	<update id="goUpdateTraningTime" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.goUpdateTraningTime ====== */
		]]>
			UPDATE LMS_SUBJ_WEEK_TIME
			SET
				       UPDATE_DATE     = SYSDATE,
				       UPDATE_USER     = #{sessionMemSeq},
				       REVIEW 		   = #{review}

			WHERE   1=1
				AND	WEEK_ID         = #{weekId}
				AND TIME_ID         = #{timeId}

	</update>

	<update id="goUpdateTraningNoteMaster" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.goUpdateTraningNoteMaster ====== */
		]]>
			UPDATE  LMS_TRANING_NOTE_MASTER
			SET
			       <if test="review != null and review != ''">			
			       REVIEW                   = #{review},
			       </if>
			       <if test="deleteYn != null and deleteYn != ''">
			       DELETE_YN  =#{deleteYn},
			       </if>
			       <if test="state != null and state != ''">
			       STATE  =#{state},
			       </if>
			       <if test="returnComment != null and returnComment != ''">
			       RETURN_COMMENT  =#{returnComment},
			       </if>
			       <if test="subjectCode != null and subjectCode != ''">			       
			       SUBJECT_CODE    = #{subjectCode},
			       </if>
			       UPDATE_USER              = #{sessionMemSeq},
			       UPDATE_DATE              = SYSDATE
			WHERE
				TRANINING_NOTE_MASTER_ID = #{traniningNoteMasterId}
	</update>

	<update id="goUpdateTraningNoteDetail" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.goUpdateTraningNoteDetail ====== */
		]]>
			UPDATE LMS_TRANING_NOTE_DETAIL
			SET
			<if test="achievement != null and achievement != ''">
			       ACHIEVEMENT              = #{achievement},
			</if>
			<if test="achievement == null or achievement == ''">
					ACHIEVEMENT              = '0',
			</if>
			<!-- <if test="bigo != null and bigo != ''">
			       BIGO                     = #{bigo},
			</if>  -->      
			 BIGO                     = #{bigo},
			<if test="deleteYn != null and deleteYn != ''">
			       DELETE_YN 				= #{deleteYn},
			</if>
			<if test="startTime != null and startTime != ''">
			       STUDY_TIME				=#{startTime},
			</if>
			<if test="subjectCode != null and subjectCode != ''">
			       SUBJECT_CODE    			= #{subjectCode},
			</if>
			       UPDATE_USER              = #{sessionMemSeq},
			       UPDATE_DATE              = SYSDATE       
			WHERE
				TRANINING_NOTE_MASTER_ID = #{traniningNoteMasterId}
				AND TRANINING_NOTE_DETAIL_ID = #{traniningNoteDetailId}
	</update>
	
	<update id="applovalOjtTraningNote" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.applovalOjtTraningNote ====== */
		]]>
			UPDATE LMS_TRANING_NOTE_MASTER
			SET
			       STATUS    			= #{status},
			       <if test="returnComment != null and returnComment != ''">
              	   RETURN_COMMENT  = #{returnComment},
              	   </if>
			       STATUS_USER              = #{sessionMemSeq},
			       STATUS_DATE              = SYSDATE       
			WHERE
				TRANINING_NOTE_MASTER_ID = #{traniningNoteMasterId}
	</update>
	
	<update id="saveTraningNoteTime" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.saveTraningNoteTime ====== */
		]]>
			INSERT 
				  INTO LMS_SUBJ_WEEK_TIME 
				       (
				         WEEK_ID,
				         TIME_ID,
				         YYYY,
				         TERM,
				         SUBJECT_CODE,
				         CLASS,
				         TRANING_DATE,
				         TRANING_ST_HOUR,
				         TRANING_ST_MIN,
				         TRANING_ED_HOUR,
				         TRANING_ED_MIN,
				         INSERT_DATE,
				         INSERT_USER,
				         WEEK_CNT,
				         LEAD_TIME,
				         NCS_UNIT_NAME,
				         NCS_UNIT_ID
				       )  
				       VALUES
				       (
				         (SELECT WEEK_ID FROM LMS_SUBJ_WEEK WHERE YYYY = #{yyyy} AND TERM = #{term} AND SUBJECT_CODE = #{subjectCode} AND CLASS = #{subjectClass} AND WEEK_CNT = #{weekCnt} AND DELETE_YN = 'N' AND ROWNUM = 1),
				         #{timeId},
				         #{yyyy},
				         #{term},
				         #{subjectCode},
				         #{subjectClass},
				         #{traningDate},
				         #{traningStHour},
				         #{traningStMin},
				         #{traningEdHour},
				         #{traningEdMin},
				         SYSDATE,
				         #{sessionMemSeq},
				         #{weekCnt},
				         #{leadTime},
				         #{ncsUnitName},
				         #{ncsUnitId}
				      )  
	</update>
	
	<update id="updateTraningNoteTime" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.updateTraningNoteTime ====== */
		]]>
		   UPDATE LMS_SUBJ_WEEK_TIME
		   SET    TRANING_DATE    =#{traningDate},
		          TRANING_ST_HOUR =#{traningStHour},
		          TRANING_ST_MIN  =#{traningStMin},
		          TRANING_ED_HOUR =#{traningEdHour},
		          TRANING_ED_MIN  =#{traningEdMin},
		          UPDATE_DATE     = SYSDATE,
		          UPDATE_USER     = #{sessionMemSeq},
		          LEAD_TIME       = #{leadTime},
		          NCS_UNIT_NAME   = #{ncsUnitName},
		          NCS_UNIT_ID     = #{ncsUnitId}
		   WHERE  WEEK_ID         = #{weekId}
		   AND    TIME_ID         = #{timeId}
	</update>
	
	<update id="deleteTraningNoteTime" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.updateTraningNoteTime ====== */
		]]>
		   UPDATE LMS_SUBJ_WEEK_TIME
		   SET  DELETE_YN = 'Y',
		    	  UPDATE_DATE     = SYSDATE,
		          UPDATE_USER     = #{sessionMemSeq}
		   WHERE  WEEK_ID         = #{weekId}
		   AND    TIME_ID         = #{timeId}
	</update>
	
	<update id="deleteActivity" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.deleteActivity ====== */
		]]>
		   UPDATE LMS_ACTIVITY_NOTE
		   SET  DELETE_YN = 'Y',
		    	  UPDATE_DATE     = SYSDATE,
		          UPDATE_USER     = #{sessionMemSeq}
		   WHERE  MEM_ID         = #{sessionMemId}
		   AND    TIME_ID         = #{timeId}
	</update>

 

	<select id="listSubjcetName" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listSubjcetName ====== */
		]]>
		
		
		SELECT INSM.SUBJECT_CODE , 
			       INSM.CLASS AS CLASS_ID , 
			       MAPP.COMPANY_ID,   
			       FN_GETCOMPAYNAME(MAPP.COMPANY_ID) AS COMPANY_NAME  
			  FROM LMS_SUBJ_INS_MAPPING INSM 
			     LEFT OUTER JOIN LMS_TRANING_PROCESS_MAPPING MAPP  
			         ON INSM.SUBJECT_CODE = MAPP.SUBJECT_CODE 
			       AND INSM.YYYY = MAPP.YYYY 
			       AND INSM.TERM = MAPP.TERM 
			       AND INSM.CLASS = MAPP.CLASS  
			       AND MAPP.DELETE_YN='N' 
			 WHERE INSM.SUBJECT_CODE = #{subjectCode} 
			       AND INSM.YYYY = #{yyyy}
			       AND INSM.TERM = #{term} 
			       AND INSM.MEM_SEQ = #{sessionMemSeq} 
			       AND INSM.DELETE_YN='N' 
			ORDER BY INSM.CLASS
			
		<!-- SELECT INSM.SUBJECT_CODE , 
			       INSM.CLASS AS CLASS_ID , 
			       COMP.COMPANY_ID, 
			       FN_GETCOMPAYNAME (COMP.COMPANY_ID) AS COMPANY_NAME 
			  FROM LMS_SUBJ_INS_MAPPING INSM 
			     LEFT OUTER JOIN
			       (SELECT MAPP.SUBJECT_CODE , 
			              MAPP.YYYY , 
			              MAPP.TERM , 
			              MAPP.CLASS , 
			              PROC.COMPANY_ID, 
			              FN_GETCOMPAYNAME (PROC.COMPANY_ID) AS COMPANY_NAME 
			         FROM LMS_TRANING_PROCESS PROC 
			            LEFT OUTER JOIN LMS_TRANING_PROCESS_MAPPING MAPP 
			                ON PROC.TRANING_PROCESS_ID = MAPP.TRANING_PROCESS_ID 
			              AND PROC.COMPANY_ID = MAPP.COMPANY_ID 
			              AND MAPP.DELETE_YN='N' 
			        WHERE PROC.DELETE_YN='N' 
			       ) COMP 
			         ON INSM.SUBJECT_CODE = COMP.SUBJECT_CODE 
			       AND INSM.YYYY = COMP.YYYY 
			       AND INSM.TERM = COMP.TERM 
			       AND INSM.CLASS = COMP.CLASS 
			 WHERE INSM.SUBJECT_CODE = #{subjectCode} 
			       AND INSM.YYYY = #{yyyy}
			       AND INSM.TERM = #{term} 
			       AND INSM.MEM_SEQ = #{sessionMemSeq} 
			       AND INSM.DELETE_YN='N' 
			ORDER BY INSM.CLASS  -->

			<!-- SELECT MAPP.SUBJECT_CODE ,
			       MAPP.CLASS AS CLASS_ID ,
			       PROC.COMPANY_ID,
			       FN_GETCOMPAYNAME (PROC.COMPANY_ID) AS COMPANY_NAME
			FROM   LMS_TRANING_PROCESS  PROC
			       LEFT OUTER JOIN LMS_TRANING_PROCESS_MAPPING  MAPP
			       ON     PROC.TRANING_PROCESS_ID = MAPP.TRANING_PROCESS_ID
			       AND    PROC.COMPANY_ID         = MAPP.COMPANY_ID
			       AND    PROC.DELETE_YN='N'
			WHERE    MAPP.SUBJECT_CODE =  #{subjectCode}
		 	AND MAPP.YYYY = #{yyyy}
			AND MAPP.TERM = #{term}
			AND MAPP.DELETE_YN='N' -->
 
	</select>
	
	<select id="listOjtTraningNoteApproval" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listOjtTraningNoteApproval ====== */
		]]>
		
		<!-- SELECT DET.TRANINING_NOTE_MASTER_ID , 
			       DET.TRANINING_NOTE_DETAIL_ID , 
			       LS.SUBJECT_NAME,
			       LESS.CLASS AS SUBJECT_CLASS, 
			       FN_GETCOMPAYNAME(MEMB.COMPANY_ID) AS COMPANY_NAME , 
			       WEEK.WEEK_CNT , 
			       WEET.NCS_UNIT_NAME, 
			       TO_CHAR(MAS.INSERT_DATE,'YYYY.MM.DD') AS INSERT_DATE, 
			       LESS.LESSON_ID , 
			       MEMB.MEM_NAME , 
			       MEMB.MEM_ID , 
			       MEMB.mem_seq , 
			       MEMB.COMPANY_ID , 
			       DET.STUDY_TIME , 
			       NVL(DET.ACHIEVEMENT,0 ) AS ACHIEVEMENT, 
			       DET.BIGO , 
			       MAS.REVIEW , 
			       WEEK.WEEK_CNT , 
			       WEET.TRANING_ST_HOUR, 
			       (SELECT LISTAGG(FN_GETUSERNAME(TUT.MEM_SEQ), ',') WITHIN 
			       GROUP( 
			     ORDER BY FN_GETUSERNAME(TUT.MEM_SEQ)) 
			         FROM lms_subj_tut_mapping TUT 
			        WHERE TUT.YYYY = LESS.YYYY 
			              AND TUT.TERM = LESS.TERM 
			              AND TUT.SUBJECT_CODE = LESS.SUBJECT_CODE 
			              AND TUT.CLASS = LESS.CLASS 
			              AND TUT.DELETE_YN = 'N' 
			              AND ROWNUM = 1
			       ) AS TUT_NAMES,
			       ROW_NUMBER() OVER (PARTITION BY DET.TRANINING_NOTE_MASTER_ID ORDER BY DET.TRANINING_NOTE_MASTER_ID , DET.TRANINING_NOTE_DETAIL_ID ASC) RN, 
       			   COUNT(*) OVER(PARTITION BY DET.TRANINING_NOTE_MASTER_ID ORDER BY DET.TRANINING_NOTE_MASTER_ID ASC) ROWSPAN
			  FROM LMS_LESSON LESS 
			   INNER JOIN LMS_SUBJ_WEEK WEEK 
			       ON LESS.SUBJECT_CODE = WEEK.SUBJECT_CODE 
			       AND WEEK.YYYY = LESS.YYYY 
			       AND WEEK.TERM = LESS.TERM 
			       AND WEEK.CLASS = LESS.CLASS 
			       AND WEEK.DELETE_YN = 'N' 
			   INNER JOIN LMS_SUBJ_WEEK_TIME WEET 
			       ON LESS.SUBJECT_CODE = WEET.SUBJECT_CODE 
			       AND WEET.YYYY = LESS.YYYY 
			       AND WEET.TERM = LESS.TERM 
			       AND WEET.CLASS = LESS.CLASS 
			       AND WEET.WEEK_ID = WEEK.WEEK_ID 
			       AND WEET.DELETE_YN = 'N' 
			   INNER JOIN COM_MEMBER MEMB 
			       ON LESS.MEM_SEQ = MEMB.MEM_SEQ 
			       AND MEMB.DELETE_YN='N' 
			   INNER JOIN LMS_TRANING_NOTE_DETAIL DET 
			       ON LESS.SUBJECT_CODE = DET.SUBJECT_CODE 
			       AND MEMB.MEM_ID = DET.MEM_ID 
			       AND DET.DELETE_YN = 'N' 
			       AND DET.WEEK_CNT = WEEK.WEEK_CNT 
			       AND DET.YYYY = LESS.YYYY 
			       AND DET.TERM = LESS.TERM 
			       AND DET.CLASS = LESS.CLASS 
			   INNER JOIN LMS_TRANING_NOTE_MASTER MAS 
			       ON MAS.TRANINING_NOTE_MASTER_ID = DET.TRANINING_NOTE_MASTER_ID 
			       AND MAS.DELETE_YN = 'N' 
			       AND MAS.TIME_ID = WEET.TIME_ID 
			       AND MAS.STATUS = #{searchStatus}
			       <if test="noteSearchStatus != null and noteSearchStatus != ''">
				 		AND MAS.STATUS =  #{noteSearchStatus}
				 	</if>
			       
			   INNER JOIN LMS_SUBJECT LS 
			       ON LS.YYYY = LESS.YYYY 
			       AND LS.TERM = LESS.TERM 
			       AND LS.SUBJECT_CODE = LESS.SUBJECT_CODE 
			       AND LS.CLASS = LESS.CLASS 
			       AND LS.DELETE_YN = 'N' 
			       AND LS.SUBJECT_TRANING_TYPE = 'OJT' 
			   INNER JOIN LMS_SUBJ_INS_MAPPING INS 
			       ON INS.YYYY = LESS.YYYY 
			       AND INS.TERM = LESS.TERM 
			       AND INS.SUBJECT_CODE = LESS.SUBJECT_CODE 
			       AND INS.CLASS = LESS.CLASS 
			       AND INS.DELETE_YN = 'N' 
			       AND INS.MEM_SEQ = #{sessionMemSeq}
			 WHERE LESS.DELETE_YN = 'N' 
			       AND 
			       ( 
			           LESS.YYYY, 
			           LESS.TERM 
			       ) 
			       IN 
			       (SELECT H.* 
			         FROM 
			              (SELECT HAK.YYYY, 
			                     HAK.TERM 
			                FROM HAK_SCHEDULE HAK 
			               WHERE TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN HAK.START_DATE AND HAK.END_DATE 
			                     AND ROWNUM = 1 
			              ) H 
			       ) 
			       
			        <if test="searchSubjectCode != null and searchSubjectCode != ''">
				 		AND LESS.SUBJECT_CODE =  #{searchSubjectCode}
				 	</if>
			       
			ORDER BY MAS.TRANINING_NOTE_MASTER_ID DESC, 
			       DET.TRANINING_NOTE_DETAIL_ID -->  
			       
			SELECT MAS.TRANINING_NOTE_MASTER_ID , 
					   LS.YYYY, 
					   LS.TERM, 
					   LS.SUBJECT_CODE, 
				       LS.SUBJECT_NAME, 
				       LS.CLASS AS SUBJECT_CLASS, 
				       FN_GETCOMPAYNAME(MEMB.COMPANY_ID) AS COMPANY_NAME , 
				       WEEK.WEEK_CNT , 
				       WEET.NCS_UNIT_NAME, 
				       TO_CHAR(MAS.INSERT_DATE,'YYYY.MM.DD') AS INSERT_DATE, 
				       MAS.REVIEW , 
				       WEEK.WEEK_CNT , 
				       FN_GETUSERNAME(MAS.INSERT_USER) AS TUT_NAMES,
				       FN_GETUSERID(MAS.INSERT_USER) AS MEM_ID,
				       MAS.RETURN_COMMENT,
				       MAS.STATUS,
				       WEET.TIME_ID,
				       LS.SUBJECT_TYPE
				  FROM LMS_TRANING_NOTE_MASTER MAS 
				   INNER JOIN LMS_SUBJ_WEEK WEEK 
				       ON WEEK.SUBJECT_CODE = MAS.SUBJECT_CODE 
				       AND WEEK.YYYY = MAS.YYYY 
				       AND WEEK.TERM = MAS.TERM 
				       AND WEEK.CLASS = MAS.CLASS 
				       AND WEEK.DELETE_YN = 'N' 
				   INNER JOIN LMS_SUBJ_WEEK_TIME WEET 
				       ON WEET.SUBJECT_CODE = MAS.SUBJECT_CODE 
				       AND WEET.YYYY = MAS.YYYY 
				       AND WEET.TERM = MAS.TERM 
				       AND WEET.CLASS = MAS.CLASS 
				       AND WEET.WEEK_ID = WEEK.WEEK_ID 
				       AND WEET.TIME_ID = MAS.TIME_ID 
				       AND WEET.DELETE_YN = 'N' 
				   INNER JOIN LMS_SUBJECT LS 
				       ON LS.YYYY = MAS.YYYY 
				       AND LS.TERM = MAS.TERM 
				       AND LS.SUBJECT_CODE = MAS.SUBJECT_CODE 
				       AND LS.CLASS = MAS.CLASS 
				       AND LS.DELETE_YN = 'N' 
				       AND LS.SUBJECT_TRANING_TYPE = 'OJT' 
				   INNER JOIN COM_MEMBER MEMB 
				       ON MAS.INSERT_USER = MEMB.MEM_SEQ 
				       AND MEMB.DELETE_YN='N' 
				   INNER JOIN LMS_SUBJ_INS_MAPPING INS 
				       ON INS.YYYY = MAS.YYYY 
				       AND INS.TERM = MAS.TERM 
				       AND INS.SUBJECT_CODE = MAS.SUBJECT_CODE 
				       AND INS.CLASS = MAS.CLASS 
				       AND INS.DELETE_YN = 'N' 
				       AND INS.MEM_SEQ = #{sessionMemSeq} 
				 WHERE MAS.DELETE_YN = 'N' 
				    
				   AND MAS.YYYY = #{yyyy}
				   AND MAS.TERM = #{term}
				       
				     <if test="searchSubjectCode != null and searchSubjectCode != ''">
				 		AND LS.SUBJECT_CODE =  #{searchSubjectCode}
				 	</if>
				 	 <if test="noteSearchStatus != null and noteSearchStatus != ''">
				 		AND MAS.STATUS =  #{noteSearchStatus}
				 	</if>
				 	
			            <if test="searchName != null and searchName != ''">
		                	<if test="searchName eq 'COMPANY_NAME'">
		                		<if test="searchWord != null and searchWord != ''">
		                			AND FN_GETCOMPAYNAME(MEMB.COMPANY_ID) LIKE '%' || #{searchWord  } || '%'
		                		</if>
		                	</if>
			            </if>
				       
				ORDER BY MAS.TRANINING_NOTE_MASTER_ID DESC   
			       
			
		
 
	</select>
	
	<select id="getMonthTraningNoteOt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.getMonthTraningNoteOt ====== */
		]]>
		
		SELECT 
		       (SELECT FN_GETTRANING_PROCESS_NAME(A.TRANING_PROCESS_ID) AS TRANING_PROCESS_NAME 
		         FROM LMS_TRANING_PROCESS_MAPPING A 
		        WHERE A.YYYY = MAS.YYYY 
		              AND A.TERM = MAS.TERM 
		              AND A.SUBJECT_CODE = MAS.SUBJECT_CODE 
		              AND A.CLASS = MAS.CLASS 
		              AND A.DELETE_YN = 'N' 
		              AND ROWNUM = 1 
		       ) AS TRANING_PROCESS_NAME, 
		       (SELECT LISTAGG(FN_GETUSERNAME(INS.MEM_SEQ), ',') WITHIN 
		       GROUP( 
		     ORDER BY FN_GETUSERNAME(INS.MEM_SEQ)) 
		         FROM LMS_SUBJ_INS_MAPPING INS 
		        WHERE INS.YYYY = MAS.YYYY 
		              AND INS.TERM = MAS.TERM 
		              AND INS.SUBJECT_CODE = MAS.SUBJECT_CODE 
		              AND INS.CLASS = MAS.CLASS 
		              AND DELETE_YN = 'N' 
		       ) AS INS_NAMES, 
		       (SELECT LISTAGG(FN_GETUSERNAME(TUT.MEM_SEQ), ',') WITHIN 
		       GROUP( 
		     ORDER BY FN_GETUSERNAME(TUT.MEM_SEQ)) 
		         FROM lms_subj_tut_mapping TUT 
		        WHERE TUT.YYYY = MAS.YYYY 
		              AND TUT.TERM = MAS.TERM 
		              AND TUT.SUBJECT_CODE = MAS.SUBJECT_CODE 
		              AND TUT.CLASS = MAS.CLASS 
		              AND TUT.DELETE_YN = 'N' 
		       ) AS TUT_NAMES, 
		       (SELECT LISTAGG(FN_GETUSERNAME(LES.MEM_SEQ), ',') WITHIN 
		       GROUP( 
		     ORDER BY FN_GETUSERNAME(LES.MEM_SEQ)) 
		         FROM LMS_LESSON LES 
		        WHERE LES.YYYY = MAS.YYYY 
		              AND LES.TERM = MAS.TERM 
		              AND LES.SUBJECT_CODE = MAS.SUBJECT_CODE 
		              AND LES.CLASS = MAS.CLASS 
		              AND LES.DELETE_YN = 'N' 
		       ) AS STD_NAMES, 
		       
		         REGEXP_REPLACE(LISTAGG( WEET.NCS_UNIT_NAME , ',' ) WITHIN 
				GROUP ( 
				ORDER BY WEET.NCS_UNIT_NAME), '([^,]+)(,\1)+', '\1') AS NCS_UNIT_NAMES, 
		       
		       LS.SUBJECT_NAME, 
		       TO_CHAR(TRUNC(TO_DATE(#{searchMonth},'MM'),'MM'),'YYYY.MM.DD') AS MONTH_STR_DATE, 
		       TO_CHAR(LAST_DAY(TO_DATE(#{searchMonth},'MM')),'YYYY.MM.DD') AS MONTH_END_DATE, 
		       SUM(DET.STUDY_TIME) AS MAS_TOT_STUDY_TIME,
		       AVG(DET.ACHIEVEMENT) AS AVG_ACHIEVEMENT 
		  FROM LMS_TRANING_NOTE_MASTER MAS 
		   INNER JOIN LMS_SUBJ_WEEK WEEK 
		       ON WEEK.SUBJECT_CODE = MAS.SUBJECT_CODE 
		       AND WEEK.YYYY = MAS.YYYY 
		       AND WEEK.TERM = MAS.TERM 
		       AND WEEK.CLASS = MAS.CLASS 
		       AND WEEK.DELETE_YN = 'N' 
		   INNER JOIN LMS_TRANING_NOTE_DETAIL DET 
		       ON DET.TRANINING_NOTE_MASTER_ID = MAS.TRANINING_NOTE_MASTER_ID 
		       AND DET.DELETE_YN = 'N' 
		   INNER JOIN LMS_SUBJ_WEEK_TIME WEET 
		       ON WEET.SUBJECT_CODE = MAS.SUBJECT_CODE 
		       AND WEET.YYYY = MAS.YYYY 
		       AND WEET.TERM = MAS.TERM 
		       AND WEET.CLASS = MAS.CLASS 
		       AND WEET.WEEK_ID = WEEK.WEEK_ID 
		       AND WEET.TIME_ID = MAS.TIME_ID 
		       AND WEET.DELETE_YN = 'N' 
		       AND TO_CHAR(TO_DATE(WEET.TRANING_DATE,'YYYY.MM.DD'),'MM') = #{searchMonth}
		   INNER JOIN LMS_SUBJECT LS 
		       ON LS.YYYY = MAS.YYYY 
		       AND LS.TERM = MAS.TERM 
		       AND LS.SUBJECT_CODE = MAS.SUBJECT_CODE 
		       AND LS.CLASS = MAS.CLASS 
		       AND LS.DELETE_YN = 'N' 
		       AND LS.SUBJECT_TRANING_TYPE = 'OJT' 
	        WHERE MAS.DELETE_YN = 'N' 
		       AND MAS.YYYY = #{yyyy}
		       AND MAS.TERM = #{term} 
		       AND MAS.SUBJECT_CODE = #{subjectCode} 
		       AND MAS.CLASS = #{subjectClass}
		 GROUP BY MAS.YYYY, 
		       MAS.TERM, 
		       MAS.SUBJECT_CODE, 
		       MAS.CLASS, 
		       LS.SUBJECT_NAME    
			       
			
		
 
	</select>
	
	<select id="listMonthTraningNoteOt" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listMonthTraningNoteOt ====== */
		]]>
		
		SELECT MAS.TRANINING_NOTE_MASTER_ID , 
			       WEEK.WEEK_CNT , 
			       MAS.REVIEW , 
			       WEET.TRANING_DATE, 
			       MAS.STATUS, 
			       SUM(DET.STUDY_TIME) AS DET_TOT_STUDY_TIME
			  FROM LMS_TRANING_NOTE_MASTER MAS 
			   INNER JOIN LMS_SUBJ_WEEK WEEK 
			       ON WEEK.SUBJECT_CODE = MAS.SUBJECT_CODE 
			       AND WEEK.YYYY = MAS.YYYY 
			       AND WEEK.TERM = MAS.TERM 
			       AND WEEK.CLASS = MAS.CLASS 
			       AND WEEK.DELETE_YN = 'N' 
			   INNER JOIN LMS_TRANING_NOTE_DETAIL DET 
			       ON DET.TRANINING_NOTE_MASTER_ID = MAS.TRANINING_NOTE_MASTER_ID 
			       AND DET.DELETE_YN = 'N' 
			   INNER JOIN LMS_SUBJ_WEEK_TIME WEET 
			       ON WEET.SUBJECT_CODE = MAS.SUBJECT_CODE 
			       AND WEET.YYYY = MAS.YYYY 
			       AND WEET.TERM = MAS.TERM 
			       AND WEET.CLASS = MAS.CLASS 
			       AND WEET.WEEK_ID = WEEK.WEEK_ID 
			       AND WEET.TIME_ID = MAS.TIME_ID 
			       AND WEET.DELETE_YN = 'N' 
			       AND TO_CHAR(TO_DATE(WEET.TRANING_DATE,'YYYY.MM.DD'),'MM') = #{searchMonth}
			   INNER JOIN LMS_SUBJECT LS 
			       ON LS.YYYY = MAS.YYYY 
			       AND LS.TERM = MAS.TERM 
			       AND LS.SUBJECT_CODE = MAS.SUBJECT_CODE 
			       AND LS.CLASS = MAS.CLASS 
			       AND LS.DELETE_YN = 'N' 
			       AND LS.SUBJECT_TRANING_TYPE = 'OJT' 
			 WHERE MAS.DELETE_YN = 'N' 
			       AND MAS.YYYY = #{yyyy}
			       AND MAS.TERM = #{term} 
			       AND MAS.SUBJECT_CODE = #{subjectCode} 
			       AND MAS.CLASS = #{subjectClass}
			 GROUP BY MAS.TRANINING_NOTE_MASTER_ID , 
			       WEEK.WEEK_CNT , 
			       WEET.NCS_UNIT_NAME, 
			       MAS.REVIEW , 
			       WEET.TRANING_DATE, 
			       MAS.STATUS 
			ORDER BY TO_NUMBER(WEEK.WEEK_CNT),MAS.TRANINING_NOTE_MASTER_ID  
		
 
	</select>
	
	
	
	<select id="listTraningNoteCcn" parameterType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO" resultType="kr.co.gocle.oklms.lu.traning.vo.TraningNoteVO">
		<![CDATA[
		/* ====== kr.co.gocle.oklms.lu.traning.service.impl.TraningMapper.listTraningNoteCcn ====== */
		]]>
		
		SELECT TO_CHAR(TO_DATE(WEET.TRANING_DATE,'YYYY.MM.DD'), 'dy', 'NLS_DATE_LANGUAGE=korean') AS DAY_OF_WEEK , 
			       WEEK.WEEK_CNT, 
			       WEET.TRANING_DATE , 
			       WEET.TRANING_ST_HOUR ||':'|| WEET.TRANING_ST_MIN AS TRANING_ST , 
			       WEET.TRANING_ED_HOUR ||':'|| WEET.TRANING_ED_MIN AS TRANING_ED , 
			       WEET.LEAD_TIME AS TIME_HOUR , 
			       MOD(TRIM(WEET.TRANING_ED_MIN), TRIM(WEET.TRANING_ST_MIN) ) AS TIME_MIN , 
			       WEET.TRANING_ST_HOUR , 
			       WEET.TRANING_ST_MIN , 
			       WEET.TRANING_ED_HOUR , 
			       WEET.TRANING_ED_MIN , 
			       WEET.WEEK_ID , 
			       WEET.TIME_ID , 
			       WEET.NCS_UNIT_NAME , 
			       WEET.NCS_UNIT_ID , 
			       WEET.LEAD_TIME , 
			       MAS.REVIEW , 
			       MAS.STATE , 
			       MAS.RETURN_COMMENT , 
			       MAS.STATUS , 
			       DET.MEM_NM,
			       DET.MEM_ID,
			       DET.STUDY_TIME,
			       DET.ACHIEVEMENT,
			       DET.BIGO, 
			       LS.YYYY,
			       LS.TERM,
			       LS.CLASS AS SUBJECT_CLASS,
			       LS.SUBJECT_CODE,
			       LS.SUBJECT_NAME,
			       LS.SUBJECT_TRANING_TYPE,
			       ROW_NUMBER() OVER (PARTITION BY DET.TRANINING_NOTE_MASTER_ID ORDER BY DET.TRANINING_NOTE_MASTER_ID , DET.TRANINING_NOTE_DETAIL_ID ASC) RN, 
			       COUNT(*) OVER(PARTITION BY DET.TRANINING_NOTE_MASTER_ID ORDER BY DET.TRANINING_NOTE_MASTER_ID ASC) ROWSPAN 
			  FROM LMS_SUBJ_WEEK WEEK 
			   INNER JOIN LMS_SUBJ_WEEK_TIME WEET 
			       ON WEEK.SUBJECT_CODE = WEET.SUBJECT_CODE 
			       AND WEET.DELETE_YN = 'N' 
			       AND WEEK.WEEK_ID = WEET.WEEK_ID 
			   INNER JOIN LMS_TRANING_NOTE_MASTER MAS 
			       ON MAS.SUBJECT_CODE = WEET.SUBJECT_CODE 
			       AND MAS.DELETE_YN = 'N' 
			       AND MAS.ADDYN = 'N' 
			       AND MAS.WEEK_CNT = WEEK.WEEK_CNT 
			       AND MAS.TIME_ID = WEET.TIME_ID 
			       AND MAS.YYYY = WEET.YYYY 
			       AND MAS.TERM = WEET.TERM 
			       AND MAS.CLASS = WEET.CLASS 
			   INNER JOIN LMS_TRANING_NOTE_DETAIL DET 
			       ON DET.TRANINING_NOTE_MASTER_ID = MAS.TRANINING_NOTE_MASTER_ID 
			       AND DET.DELETE_YN = 'N' 
			    INNER JOIN LMS_SUBJECT LS 
			       ON LS.YYYY = WEEK.YYYY 
			       AND LS.TERM = WEEK.TERM 
			       AND LS.SUBJECT_CODE = WEEK.SUBJECT_CODE 
			       AND LS.CLASS = WEEK.CLASS 
			       AND LS.DELETE_YN = 'N'    
			 WHERE WEEK.DELETE_YN ='N' 
			       AND WEEK.YYYY = #{yyyy}
			       AND WEEK.TERM = #{term} 
			       AND WEEK.SUBJECT_CODE = #{subjectCode} 
			       AND WEEK.CLASS = #{classId}
			       
			ORDER BY MAS.TRANINING_NOTE_MASTER_ID DESC, 
			       DET.TRANINING_NOTE_DETAIL_ID 
		
 
	</select>

</mapper>
